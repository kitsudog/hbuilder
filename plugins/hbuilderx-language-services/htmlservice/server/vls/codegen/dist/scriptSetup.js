"use strict";var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};exports.__esModule=!0,exports.parseScriptSetups=void 0;var utils_1=require("./utils"),path=require("path");function parseScriptSetups(e){var t,n,r,a,d,i,o,s,l=e.ts,p=e.baseFileName,u=e.script,x=e.scriptCodegen,c=e.vueLibName,f=e.baseName,T=!1,_=0,v={start:0,end:0},y=[],g=l.createSourceFile(p+".ts",u.text,l.ScriptTarget.Latest);if(y.push({typeBindings:(0,utils_1.parseBindingRanges)(l,g,!0),bindings:(0,utils_1.parseBindingRanges)(l,g,!1),content:u.text}),g.forEachChild((function(e){var t,n=(l.isTypeAliasDeclaration(e)||l.isInterfaceDeclaration(e))&&(null===(t=e.modifiers)||void 0===t?void 0:t.some((function(e){return e.kind===l.SyntaxKind.ExportKeyword})));T||n||l.isImportDeclaration(e)||l.isEmptyStatement(e)||l.isImportEqualsDeclaration(e)||(_=e.getStart(g),T=!0)})),g.forEachChild((function(e){return D(e,g)})),x.addCode2(u.text.substring(0,_),_,void 0),x.addText("export default await (async () => {\n"),x.addCode2(u.text.substring(_),_,void 0),x.addText("const __VLS_Component = (await import('".concat(c,"')).defineComponent({\n")),x.addText("props: ("),x.addText("{} as "),x.addText("__VLS_TypePropsToRuntimeProps<"),x.addCode2(u.text.substring(v.start,v.end),v.start,void 0),x.addText(">"),x.addText("),\n"),x.addText("setup() {\n"),x.addText("return {\n"),y&&y.length>0)try{for(var m=__values(y),S=m.next();!S.done;S=m.next()){var h=S.value,b=h.bindings,C=h.content;try{for(var E=(r=void 0,__values(b)),L=E.next();!L.done;L=E.next()){var w=L.value,P=C.substring(w.start,w.end);x.addText(P),x.addText(": "),x.addCode2(P,w.start,void 0),x.addText(",\n")}}catch(e){r={error:e}}finally{try{L&&!L.done&&(a=E.return)&&a.call(E)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{S&&!S.done&&(n=m.return)&&n.call(m)}finally{if(t)throw t.error}}x.addText("};\n"),x.addText("},\n"),x.addText("});\n"),x.addText("return __VLS_Component;\n"),x.addText("})();"),x.addText("\n"),x.addText("type __VLS_NonUndefinedable<T> = T extends undefined ? never : T;\n"),x.addText("type __VLS_TypePropsToRuntimeProps<T> = { [K in keyof T]-?: {} extends Pick<T, K> ? { type: import('".concat(c,"').PropType<__VLS_NonUndefinedable<T[K]>> } : { type: import('").concat(c,"').PropType<T[K]>, required: true } };\n")),x.addText("\n"),x.addText("export const __VLS_options = {\n"),x.addText("props: ({} as "),x.addCode2(u.text.substring(v.start,v.end),v.start,void 0),x.addText("),\n"),x.addText("};\n"),x.addText("\n"),x.addText("export declare const __VLS_name: '".concat(path.basename(f.substring(0,f.lastIndexOf("."))),"';\n")),x.addText("export {\n");try{for(var V=__values(y),K=V.next();!K.done;K=V.next()){b=K.value;try{for(var I=(o=void 0,__values(b.typeBindings)),N=I.next();!N.done;N=I.next()){var q=N.value,B=b.content.substring(q.start,q.end);x.addCode2(B,q.start,void 0),x.addText("  as __VLS_types_".concat(B,",\n"))}}catch(e){o={error:e}}finally{try{N&&!N.done&&(s=I.return)&&s.call(I)}finally{if(o)throw o.error}}}}catch(e){d={error:e}}finally{try{K&&!K.done&&(i=V.return)&&i.call(V)}finally{if(d)throw d.error}}function D(e,t){var n;if(l.isCallExpression(e)&&l.isIdentifier(e.expression)){var r=e.expression.getText(g);if(("defineProps"===r||"defineEmits"===r||"defineExpose"===r)&&(null===(n=e.typeArguments)||void 0===n?void 0:n.length)){var a=e.typeArguments[0];"defineProps"===r&&(v=(0,utils_1.getStartEnd)(a,g))}}e.forEachChild((function(t){return D(t,e)}))}x.addText("};\n")}exports.parseScriptSetups=parseScriptSetups;