"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.walkIdentifiers=exports.walkInterpolationFragment=exports.writeInterpolation=exports.colletVars=void 0;const ts=__importStar(require("typescript/lib/tsserverlibrary")),GLOBALS_WHITE_LISTED="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt";function colletVars(e,t,i){if(e.isIdentifier(t))i.push(t.text);else if(e.isObjectBindingPattern(t))for(const n of t.elements)colletVars(e,n.name,i);else if(e.isArrayBindingPattern(t))for(const n of t.elements)e.isBindingElement(n)&&colletVars(e,n.name,i);else t.forEachChild((t=>colletVars(e,t,i)))}function writeInterpolation(e,t,i,n,r,o,s){walkInterpolationFragment(ts,i+e+n,((n,o,s)=>{if(void 0===o)r.addText(n);else{let s="",a="__VLS_ctx.";const l=(o-=i.length)+n.length-e.length;l>0&&(s=n.substring(n.length-l),n=n.substring(0,n.length-l)),o<0&&(r.addText(n.substring(0,-o)),n=n.substring(-o),o=0),void 0!==t?""===n?r.addCode3(n,t+o,void 0,a.length):r.addCode2(n,t+o,void 0):r.addText(n),r.addText(s)}}),o,s)}function walkInterpolationFragment(e,t,i,n,r){const o=makeMap(GLOBALS_WHITE_LISTED);let s=[];const a=e.createSourceFile("/foo.ts",t,e.ScriptTarget.ESNext),l=(e,t)=>{!!n[e.text]||o(e.text)||"require"===e.text||e.text.startsWith("__VLS_")||(s.push({text:e.text,isShorthand:t,offset:e.getStart(a)}),r.add(e.text))};if(a.forEachChild((t=>walkIdentifiers(e,t,l,n))),s=s.sort(((e,t)=>e.offset-t.offset)),s.length){s[0].isShorthand?(i(t.substring(0,s[0].offset+s[0].text.length),0),i(": ",void 0)):i(t.substring(0,s[0].offset),0);for(let e=0;e<s.length-1;e++)i("",s[e+1].offset,!0),i("__VLS_ctx.",void 0),s[e+1].isShorthand?(i(t.substring(s[e].offset,s[e+1].offset+s[e+1].text.length),s[e].offset),i(": ",void 0)):i(t.substring(s[e].offset,s[e+1].offset),s[e].offset);i("",s[s.length-1].offset,!0),i("__VLS_ctx.",void 0),i(t.substring(s[s.length-1].offset),s[s.length-1].offset)}else i(t,0)}function walkIdentifiers(e,t,i,n){var r,o;const s=[];if(e.isIdentifier(t))i(t,!1);else if(e.isShorthandPropertyAssignment(t))i(t.name,!0);else if(e.isPropertyAccessExpression(t))walkIdentifiers(e,t.expression,i,n);else if(e.isVariableDeclaration(t)){colletVars(e,t.name,s);for(const e of s)n[e]=(null!==(r=n[e])&&void 0!==r?r:0)+1;t.initializer&&walkIdentifiers(e,t.initializer,i,n)}else if(e.isArrowFunction(t)){const r=[];for(const o of t.parameters)colletVars(e,o.name,r),o.type&&walkIdentifiers(e,o.type,i,n);for(const e of r)n[e]=(null!==(o=n[e])&&void 0!==o?o:0)+1;walkIdentifiers(e,t.body,i,n);for(const e of r)n[e]--}else if(e.isObjectLiteralExpression(t))for(const r of t.properties)e.isPropertyAssignment(r)?(e.isComputedPropertyName(r.name)&&walkIdentifiers(e,r.name.expression,i,n),walkIdentifiers(e,r.initializer,i,n)):e.isShorthandPropertyAssignment(r)?walkIdentifiers(e,r,i,n):e.isSpreadAssignment(r)&&walkIdentifiers(e,r.expression,i,n);else t.forEachChild((t=>walkIdentifiers(e,t,i,n)));for(const e of s)n[e]--}function makeMap(e){const t=Object.create(null),i=e.split(",");for(let e=0;e<i.length;e++)t[i[e]]=!0;return e=>!!t[e]}exports.colletVars=colletVars,exports.writeInterpolation=writeInterpolation,exports.walkInterpolationFragment=walkInterpolationFragment,exports.walkIdentifiers=walkIdentifiers;