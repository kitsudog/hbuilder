"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,i)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&__createBinding(e,t,r);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEmbeddedPositionInHtml=exports.getModeAtEmbeddedFile=exports.vueVirtualToRealityFromRange=exports.realityOffsetToVirtual=exports.virtualToRealityFromRange=exports.initializeModeData=exports.htmlVirtualToRealityFromRange=void 0;const path=__importStar(require("path"));function htmlVirtualToRealityFromRange(t,e,r,o){if("html"===r)return o;const i=t.getUpToDateInfo(e);if(!i)return;let n=i.getEmbeddedDocument(r);if(!o)return;let a=n.positionAt(o.start),s=i.htmlDocument.offsetAt(a),l={start:o.start,length:o.length};return l.start=s,l}function virtualToRealityFromRange(t,e){if(!t.scriptDocument||!e)return e;let r=t.scriptDocument.positionAt(e.start);return{start:t.htmlDocument.offsetAt(r),length:e.length}}function realityOffsetToVirtual(t,e){if(!t.scriptDocument)return e;let r=t.htmlDocument.positionAt(e);return t.scriptDocument.offsetAt(r)}function initializeModeData(t,e,r,o,i){if(!t.tsinfo.project.getScriptInfo(o))return;const n=e.getUpToDateInfo(o);if(!n)return;let a=n.allEmbedFiles,s=n.htmlDocument.positionAt(i),l=n.getLanguageAtPosition(s);if(!l)return;let u=r.get(l);if(!u)return;let c=i,d=n.htmlDocument.positionAt(i);if("css"===l){c=n.getEmbeddedDocument("css").offsetAt(d)}else if("javascript"===l){c=n.getEmbeddedDocument("javascript").offsetAt(d)}return{modeLang:l,modeOffset:c,modeServer:u,embeddedList:a}}function vueVirtualToRealityFromRange(t,e){let r;if(!e)return r;let o=t.getSourceRange(e.start,e.start+e.length);return o||(o=t.getSourceRange(e.start),o&&(o[0].end=o[0].start+e.length)),o?(r={start:o[0].start,length:o[0].end-o[0].start},r):r}function getModeLang(t){let e;switch(path.extname(t)){case".html":e="html";break;case".scss":case".less":case".stylus":e="style";break;case".js":case".jsx":case".ts":case".tsx":e="javascript";break;case".css":e="css"}return e}function getModeAtEmbeddedFile(t,e){let r=getModeLang(t);if(r)return e.get(r)}function getEmbeddedPositionInHtml(t){let e=[];return accept((t=>{let r=t.tag;return"style"!=r&&"script"!=r||!t.startTagEnd||e.push(t.startTagEnd),!0}),t.roots[0]),e}function accept(t,e){if(t(e)&&e.children)for(const r of e.children)accept(t,r)}exports.htmlVirtualToRealityFromRange=htmlVirtualToRealityFromRange,exports.virtualToRealityFromRange=virtualToRealityFromRange,exports.realityOffsetToVirtual=realityOffsetToVirtual,exports.initializeModeData=initializeModeData,exports.vueVirtualToRealityFromRange=vueVirtualToRealityFromRange,exports.getModeAtEmbeddedFile=getModeAtEmbeddedFile,exports.getEmbeddedPositionInHtml=getEmbeddedPositionInHtml;