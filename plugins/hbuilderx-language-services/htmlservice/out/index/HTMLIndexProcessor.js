"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFileIndexProcessor=void 0;const core_1=require("../../../core"),vscode_html_languageservice_1=require("../../../packages/vscode-html-languageservice"),embeddedSupport_1=require("../modes/embeddedSupport"),scriptIndex_1=require("./scriptIndex"),styleIndex_1=require("./styleIndex"),tagIndex_1=require("./tagIndex");class HTMLFileIndexProcessor extends core_1.IndexProcessor{constructor(){super(...arguments),this._languageServer=(0,vscode_html_languageservice_1.getLanguageService)()}getProcessorID(){return"html"}isSupportIndexer(e,t){let s=!1;return("html"===t.languageId||"html_es6"===t.languageId||t.uri.endsWith(".html"))&&(s=!0),s}getLangType(e){e.startsWith("vue:")&&(e=e.substring(4));let t={lang:e,type:""};return["css","less","sass","scss"].includes(e)?(t.type="Style",e.includes("vue:")&&(t.lang=e.substring(4))):["javascript","typescript","uts"].includes(e)&&(t.type="Script"),t}async createIndexData(e,t,s){const r=(0,vscode_html_languageservice_1.getLanguageService)({}),n=(0,embeddedSupport_1.getDocumentRegions)(r,t),a=n.allRegions;let c=[],d=[];for(let r=0;r<a.length;r++){const g=a[r];if(!g.languageId)continue;if(d.includes(g.languageId))continue;d.push(g.languageId);let u=this.getLangType(g.languageId),l=n.getEmbeddedDocument(g.languageId,!1);if("Style"===u.type){const t=await(0,styleIndex_1.getStyleIndex)(e,l,s,u.lang);t&&c.push(t)}else if("Script"===u.type){s.sourceDocument=t;const r=await(0,scriptIndex_1.getScriptIndex)(e,l,s,u.lang);r&&c.push(r)}}const g=new tagIndex_1.TagIndex(!1).createTagIndex(e,t,s);g&&c.push(g);return(0,core_1.mergeIndexData)(c)}}function createFileIndexProcessor(){return new HTMLFileIndexProcessor}exports.createFileIndexProcessor=createFileIndexProcessor;