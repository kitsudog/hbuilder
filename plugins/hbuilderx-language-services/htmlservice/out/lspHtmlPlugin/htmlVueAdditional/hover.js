"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AdditionalHover=void 0;const core_1=require("../../../../core"),specialStringPlugin_1=require("../../../../specialStringPlugin"),plugins_1=require("../../plugins");function specialNormalizationIndexData(t,e){return e=t===specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE?(0,core_1.tagNormalizedData)(e):t===specialStringPlugin_1.StringLocationInfoKind.IN_CSS_LIKE?(0,core_1.styleNormalizedData)(e):t===specialStringPlugin_1.StringLocationInfoKind.IN_JS_LIKE?(0,core_1.tagNormalizedData)(e):(0,core_1.normalizationIndexData)(e)}class AdditionalHover{constructor(t,e,n){this.ls=t,this.allInfo=e,this.dataProviders=n}async doExtraHover(t,e,n,r){let i=this.ls.getLocationInfoAtPosition(e,n,r);if(!i||!e)return t;switch(i.kind){case plugins_1.LocationInfoKind.AttributeName:t=await this.vueHoverDefinition(t,e,n,i);break;case plugins_1.LocationInfoKind.StartTag:t=await this.vueComponentHover(t,e,n,i)}return t}async vueHoverDefinition(t,e,n,r){if(!r||!e)return t;if(!r.activeTag)return t;let i=r.activeAttribute;if(!i)return t;let o=(0,core_1.getContextData)(e,e.offsetAt(n)," \t\n\r'\":{[()]},*>+");if(!o)return t;let a={range:o.contextRange,kind:specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project};const c=(0,core_1.noTsToNormalizedUri)(a.project.fsPath);if(!c)return t;const l=[{projectUri:c,kind:"VUE_DIRECTIVE"}];let s;if(s=await a.project.indexPipeHandler.getIndexDataRequest(l,!1),!s)return t;if(0===s.length)return t;if(s.forEach((t=>{t=specialNormalizationIndexData(a.kind,t)})),!s)return t;const u=[];s.forEach((t=>{u.push(...(0,core_1.creatorVueHoverFromIndexData)(t))}));let d=u.find((t=>`v-${t.name}`===i));const g={language:"markdown",value:(null==d?void 0:d.contents)||""};return g.value?t={contents:g,range:a.range}:t}async vueComponentHover(t,e,n,r){if(!r)return t;let i=r.activeTag;if(!i)return t;let o=(0,core_1.getContextData)(e,e.offsetAt(n)," \t\n\r'\":{[()]},*>+");if(!o)return t;let a={range:o.contextRange,kind:specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project};const c=(0,core_1.noTsToNormalizedUri)(a.project.fsPath);if(!c)return t;const l=[{projectUri:c,kind:"VUE_COMPONENT"}];let s;if(s=await a.project.indexPipeHandler.getIndexDataRequest(l,!1),!s)return t;if(0===s.length)return t;if(s.forEach((t=>{t=specialNormalizationIndexData(a.kind,t)})),!s)return t;const u=[];s.forEach((t=>{u.push(...(0,core_1.creatorVueHoverFromIndexData)(t))}));let d=u.find((t=>t.name===i));if(!d)return t;const g={language:"markdown",value:(null==d?void 0:d.contents)||""};return g.value?t={contents:g,range:a.range}:t}}exports.AdditionalHover=AdditionalHover;