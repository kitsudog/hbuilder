"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AdditionalDefinition=void 0;const core_1=require("../../../../core"),specialStringPlugin_1=require("../../../../specialStringPlugin"),plugins_1=require("../../plugins");function specialNormalizationIndexData(t,i){return i=t===specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE?(0,core_1.tagNormalizedData)(i):t===specialStringPlugin_1.StringLocationInfoKind.IN_CSS_LIKE?(0,core_1.styleNormalizedData)(i):t===specialStringPlugin_1.StringLocationInfoKind.IN_JS_LIKE?(0,core_1.tagNormalizedData)(i):(0,core_1.normalizationIndexData)(i)}class AdditionalDefinition{constructor(t,i,e){this.ls=t,this.allInfo=i,this.dataProviders=e}async doExtraDefinition(t,i,e,n){let r=this.ls.getLocationInfoAtPosition(i,e,n);if(!r)return t;switch(t||(t=[]),r.kind){case plugins_1.LocationInfoKind.AttributeName:t=await this.vueDirectiveDefinition(t,i,e,r);break;case plugins_1.LocationInfoKind.StartTag:t=await this.vueComponentDefinition(t,i,e,r)}return t}async vueDirectiveDefinition(t,i,e,n){if(!n||!i)return t;if(!n.activeAttribute)return t;if(!n.activeTag)return t;let r=n.activeAttribute;if(!r)return t;let o=(0,core_1.getContextData)(i,i.offsetAt(e)," \t\n\r'\":{[()]},*>+");if(!o)return t;let a={range:o.contextRange,kind:specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project};const c=(0,core_1.noTsToNormalizedUri)(a.project.fsPath);if(!c)return t;const s=[{projectUri:c,kind:"VUE_DIRECTIVE"}];let l;if(l=await a.project.indexPipeHandler.getIndexDataRequest(s,!1),!l)return t;if(0===l.length)return t;if(l.forEach((t=>{t=specialNormalizationIndexData(a.kind,t)})),!l)return t;const f=[];l.forEach((t=>{f.push(...(0,core_1.creatorExtLocationLinksFromIndexData)(t,a.range))}));let u=f.find((t=>`v-${t.extRefItems.name}`===r));return u&&t.push(u),t}async vueComponentDefinition(t,i,e,n){if(!n||!i)return t;let r=n.activeTag;if(!r)return t;let o=(0,core_1.getContextData)(i,i.offsetAt(e)," \t\n\r'\":{[()]},*>+");if(!o)return t;let a={range:o.contextRange,kind:specialStringPlugin_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project};const c=(0,core_1.noTsToNormalizedUri)(a.project.fsPath);if(!c)return t;const s=[{projectUri:c,kind:"VUE_COMPONENT"}];let l;if(l=await a.project.indexPipeHandler.getIndexDataRequest(s,!1),!l)return t;if(0===l.length)return t;if(l.forEach((t=>{t=specialNormalizationIndexData(a.kind,t)})),!l)return t;const f=[];l.forEach((t=>{f.push(...(0,core_1.creatorExtLocationLinksFromIndexData)(t,a.range))}));let u=f.find((t=>t.extRefItems.name===r));return u&&t.push(u),t}}exports.AdditionalDefinition=AdditionalDefinition;