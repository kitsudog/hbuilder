"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AdditionalCompletion=void 0;const core_1=require("../../../../core"),plugins_1=require("../../plugins");class AdditionalCompletion{constructor(e,t,o){this.ls=e,this.allInfo=t,this.dataProviders=o}async doExtraCompletion(e,t,o,i){let n=this.ls.getLocationInfoAtPosition(t,o,i);if(!n)return e;switch(n.kind){case plugins_1.LocationInfoKind.StartTagOpen:e=await this.vueComponentCompletion(e,t,o,n);break;case plugins_1.LocationInfoKind.AttributeName:e=await this.vueDirectiveCompletion(e,t,o,n)}return e}async vueComponentCompletion(e,t,o,i){const n=this.allInfo.project,r=(0,core_1.noTsToNormalizedUri)(n.fsPath);if(!r)return e;const a=(0,core_1.noTsToNormalizedUri)(t.uri);if(!a)return e;const s=[{projectUri:r,kind:"VUE_COMPONENT",fileUri:a,limit:1e3}];let c;if(c=await n.indexPipeHandler.getIndexDataRequest(s,!1),!c||0===c.length)return e;c.forEach((e=>{e=(0,core_1.tagNormalizedData)(e)}));const l=t.offsetAt(o),d={replaceRange:(0,core_1.getContextData)(t,l," \t\n\r'\":{[()]},*<>+").contextRange,needFilePath:!1},u=[];return c.forEach((e=>{u.push(...(0,core_1.creatorVueComponentFromIndexData)(e,d))})),e.items.push(...u),e}async vueDirectiveCompletion(e,t,o,i){const n=this.allInfo.project,r=(0,core_1.noTsToNormalizedUri)(n.fsPath);if(!r)return e;const a=(0,core_1.noTsToNormalizedUri)(t.uri);if(!a)return e;const s=[{projectUri:r,kind:"VUE_DIRECTIVE",fileUri:a,limit:1e3}];let c;if(c=await n.indexPipeHandler.getIndexDataRequest(s,!1),!c||0===c.length)return e;c.forEach((e=>{e=(0,core_1.tagNormalizedData)(e)}));const l=t.offsetAt(o),d={replaceRange:(0,core_1.getContextData)(t,l," \t\n\r'\":{[()]},*<>+=").contextRange,needFilePath:!1},u=[];return c.forEach((e=>{u.push(...(0,core_1.creatorVueDirectiveFromIndexData)(e,d))})),e.items.push(...u),e}}exports.AdditionalCompletion=AdditionalCompletion;