"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createVueThisTypeChecker=void 0;const core_1=require("../../../core"),utils_1=require("../../../utils");function getCallSignatures(e,t,r,s){let i=findFunctionDeclaration(e,core_1.ts,r);if(!i)return;let n=s.getSymbolOfNode(i);return n?s.getTypeOfSymbolAtLocation(n,i).getCallSignatures():void 0}function findFunctionDeclaration(e,t,r){let s;return function e(t){if(core_1.ts.isVariableStatement(t)&&t.declarationList&&t.declarationList.declarations){let e=t.declarationList.declarations[0];core_1.ts.isObjectBindingPattern(e.name)&&e.name.elements&&(s=e.name.elements.find((e=>core_1.ts.isBindingElement(e)&&e.getText()===r)))}s||core_1.ts.forEachChild(t,e)}(e),s}function getVueOptions(e,t,r,s,i,n){let o;return function e(r){var i;let n=r.parent;if(n)if(core_1.ts.isObjectLiteralExpression(n)&&n.properties&&n.properties.find((e=>core_1.ts.isPropertyAssignment(e)&&"el"===e.name.getText())))o=n;else if(core_1.ts.isObjectLiteralExpression(n)&&n.properties&&core_1.ts.isCallExpression(n.parent)&&core_1.ts.isPropertyAccessExpression(n.parent.expression)&&"component"===n.parent.expression.name.getText())o=n;else{if(core_1.ts.isCallExpression(n)&&"createApp"===n.expression.getText()){const e=n.arguments[0];if(core_1.ts.isObjectLiteralExpression(e)){let r=getCallSignatures(t,core_1.ts,n.expression.getText(),s);r&&r[0].parameters.find((e=>"rootComponent"===e.name))&&(o=e)}if(o)return}if(core_1.ts.isCallExpression(n)&&core_1.ts.isPropertyAccessExpression(n.expression)&&"createApp"===n.expression.name.getText()){const e=n.arguments[0];if(core_1.ts.isObjectLiteralExpression(e)&&(o=e),o)return}if(core_1.ts.isFunctionLike(n)){if("setup"===(null===(i=n.name)||void 0===i?void 0:i.getText())&&core_1.ts.isObjectLiteralExpression(n.parent)&&core_1.ts.isCallExpression(n.parent.parent)&&"createApp"===n.parent.parent.expression.getText())return void(o=void 0)}n&&n.kind!==core_1.ts.SyntaxKind.NewExpression&&e(n)}}(e),o}function createVueThisTypeChecker(e){return{checkExpression(t,r,s,i,n,o){var c;const a=i.kind;let p=i.getSourceFile().fileName;if(p.endsWith("html.__VLS_script.ts")){let t=null===(c=e.languageService.getProgram())||void 0===c?void 0:c.getSourceFile(p);if(!(null==t?void 0:t.getChildAt(0))||!t)return;let r=getVueOptions(i,t,e.ts,s,n,o);if(a===e.ts.SyntaxKind.ThisKeyword&&r){if(r&&e.ts.isObjectLiteralExpression(r)&&s){const t=["data","props","methods","computed","setup"];let i=(0,utils_1.getVueNodes)(t,r.properties,e),n=(0,utils_1.getMembersAtProperty)(t,i,e,s);return s.createAnonymousType(void 0,n,[],[],[])}return}}else;}}}exports.createVueThisTypeChecker=createVueThisTypeChecker;