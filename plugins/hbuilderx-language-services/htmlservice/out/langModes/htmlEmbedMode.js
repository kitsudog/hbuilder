"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlEmbedMode=void 0;const vscode_uri_1=require("vscode-uri"),core_1=require("../../../core");class HtmlEmbedMode{constructor(t,e,i){this.info=t,this.htmlCachesInProjectScope=e,this.htmlLanguageService=i}initialize(t,e){const i=this.htmlCachesInProjectScope.getUpToDateInfo(t);if(!i)return;const n=i.htmlDocument,o=this.htmlLanguageService;if(!o)return;const s=o.parseHTMLDocument(n),r=n.positionAt(e);return{document:n,htmlDocument:s,position:r}}async getCompletionsAtPositionAsync(t,e,i,n){const o=this.info,s=this.initialize(e,i);if(!s)return;const r=this.htmlLanguageService,c=s.document,m=s.htmlDocument,u=s.position,a=await r.doCompleteAsync(c,u,m);return(0,core_1.fromLspCompletions)(a,c,o.ts)}getCompletionEntryDetails(t,e,i,n,o,s,r,c){if(!s)return;const m=vscode_uri_1.URI.parse(s).query,u=JSON.parse(m),a=this.info,h=this.initialize(e,i);if(!h)return;const l=this.htmlLanguageService,f=h.document,p=h.htmlDocument,d=h.position,g={label:n,...u},D=l.doResolve(g,f,d,p);return(0,core_1.fromLspCompletionDetail)(D,f,a.ts)}async getQuickInfoAtPositionAsync(t,e,i){this.info;const n=this.initialize(e,i);if(!n)return;const o=this.htmlLanguageService,s=n.document,r=n.htmlDocument,c=n.position,m=await o.doHoverAsync(s,c,r);if(null===m)return;return(0,core_1.fromLspHover)(m,s,this.info.ts)}getSignatureHelpItems(t,e,i,n){}async getDefinitionAndBoundSpanAsync(t,e,i){const n=this.info,o=this.initialize(e,i);if(!o)return;const s=this.htmlLanguageService,r=o.document,c=o.htmlDocument,m=o.position,u=await s.findDefinitionAsync(r,m,c);return(0,core_1.fromLspDefinition)(u,r,n,void 0)}getNavigationTree(t,e){const i=this.htmlCachesInProjectScope.getUpToDateInfo(e);if(!i)return;const n=this.htmlLanguageService,o=i.htmlDocument,s=n.parseHTMLDocument(i.htmlDocument),r=n.findDocumentSymbols(o,s);return(0,core_1.fromLspNavigation)(r,o,this.info.ts,!0)}async findReferencesAsync(t,e,i){this.info;const n=this.initialize(e,i);if(!n)return;const o=this.htmlLanguageService,s=n.document,r=n.htmlDocument,c=n.position,m=await o.tsFindReferencesAsync(s,c,r);return(0,core_1.fromLspReferences)(this.info,m)}async getSyntacticDiagnosticsAsync(t,e){return[]}}exports.HtmlEmbedMode=HtmlEmbedMode;