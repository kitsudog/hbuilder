"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StyleEmbedMode=void 0;const vscode_uri_1=require("vscode-uri"),core_1=require("../../../core");class StyleEmbedMode{constructor(e,t,s){this.info=e,this.htmlCachesInProjectScope=t,this.styleLanguageServiceList=s}initialize(e,t,s){const n=this.htmlCachesInProjectScope.getUpToDateInfo(e);if(!n)return;const o=n.htmlDocument,i=n.getEmbeddedDocument("css");let r="css";if(s){const e=s.parseHTMLDocument(o);if(3===e.roots.length){const t=e.roots[2].attributes;t&&t.lang&&(r=t.lang.slice(1,-1))}}["css","scss","less"].includes(r)||(r="css");const c=this.styleLanguageServiceList.get(r);if(!c)return;const u=c.parseStylesheet(i),a=i.positionAt(t);return{sourceDocument:o,cssDocument:i,stylesheet:u,position:a,languageServer:c}}async getCompletionsAtPositionAsync(e,t,s,n){const o=this.info,i=this.initialize(t,s);if(!i)return;i.sourceDocument;const r=i.languageServer,c=i.cssDocument,u=i.stylesheet,a=i.position,l=await r.doCompleteAsync(c,a,u);return(0,core_1.fromLspCompletions)(l,c,o.ts)}getCompletionEntryDetails(e,t,s,n,o,i,r,c){if(!i)return;const u=vscode_uri_1.URI.parse(i).query,a=JSON.parse(u),l=this.info,m=this.initialize(t,s);if(!m)return;m.sourceDocument;const f=m.languageServer,g=m.cssDocument,h=m.stylesheet,p=m.position,y={label:n,...a},d=f.doResolve(y,g,p,h);return(0,core_1.fromLspCompletionDetail)(d,g,l.ts)}async getQuickInfoAtPositionAsync(e,t,s){const n=this.info,o=this.initialize(t,s);if(!o)return;o.sourceDocument;const i=o.languageServer,r=o.cssDocument,c=o.stylesheet,u=o.position,a=i.doHover(r,u,c);return(0,core_1.fromLspHover)(a,r,n.ts)}getSignatureHelpItems(e,t,s,n){}async getDefinitionAndBoundSpanAsync(e,t,s){const n=this.info,o=this.initialize(t,s);if(!o)return;o.sourceDocument;const i=o.languageServer,r=o.cssDocument,c=o.stylesheet,u=o.position,a=await i.tsFindDefinitionAsync(r,u,c);return(0,core_1.fromLspDefinition)(a,r,n,void 0)}getNavigationTree(e,t,s){this.info;const n=this.initialize(t,0,s);if(!n)return;n.sourceDocument;const o=n.languageServer,i=n.cssDocument,r=n.stylesheet,c=(n.position,o.findDocumentSymbols(i,r));return(0,core_1.fromLspNavigation)(c,i,this.info.ts,!1)}async findReferencesAsync(e,t,s){this.info;const n=this.initialize(t,s);if(!n)return;n.sourceDocument;const o=n.languageServer,i=n.cssDocument,r=n.stylesheet,c=n.position,u=await o.tsFindReferencesAsync(i,c,r);return(0,core_1.fromLspReferences)(this.info,u)}async getSyntacticDiagnosticsAsync(e,t){return[]}}exports.StyleEmbedMode=StyleEmbedMode;