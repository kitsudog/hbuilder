"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onDiskQuery=void 0;const fs=require("fs-extra"),md5=require("md5"),path=require("path"),utils_1=require("./utils");class IndexDiskHandler{static instance(){return void 0===this._instance&&(this._instance=new IndexDiskHandler),this._instance}constructor(){this._indexMap=new Map,this._projectCache=new Map,this._fileVersionCache=new Map,this._refDataCache=new Map,this._backRefDataCache=new Map,"darwin"===process.platform?(this._oldDiskPath=path.join(process.env.HOME||".","Library","Application Support","HBuilder X","indexdb"),this._newDiskPath=path.join(process.env.HOME||".","Library","Application Support","HBuilder X","newIndexDb")):(this._oldDiskPath=path.join(process.env.APPDATA||".","HBuilder X","indexdb"),this._newDiskPath=path.join(process.env.APPDATA||".","HBuilder X","newIndexDb")),fs.existsSync(this._newDiskPath)||fs.mkdirSync(this._newDiskPath)}loadIndexData(e){const t=e.projectUri,i=md5(t).toLowerCase(),s=path.join(this._newDiskPath,i);if(!fs.existsSync(s))return;const n=(0,utils_1.loadNewIndexDataFromPath)(s);if(!n)return;return(0,utils_1.filterIndexData)(e,n)}loadIndexDataList(e){const t=[];return e.forEach((e=>{const i=this.loadIndexData(e);i&&t.push(i)})),t}}function onDiskQuery(e){return IndexDiskHandler.instance().loadIndexDataList(e)}exports.onDiskQuery=onDiskQuery;