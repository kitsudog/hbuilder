"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vueVersionFroProjectPath=exports.vueVersion=void 0;const md5=require("md5"),path=require("path"),fs=require("fs"),jsonc_1=require("jsonc"),project_1=require("./project"),fileProperties_1=require("./fileProperties"),vue2Library="vue.2.x",vue3Library="vue.3.x";function vueVersion(e){if(e.kind===project_1.HXProjectKind.UniApp||e.kind===project_1.HXProjectKind.UniApp_Cli){if((0,project_1.isUniAppXProject)(e))return 3;let r=path.join(e.sourceRoot,"manifest.json");return(0,fileProperties_1.getFileProperty)(r,"vue.version",uniappProjectUpToDate)||2}let r=e.fsPath,t=path.join(r,"package.json");return(0,fileProperties_1.getFileProperty)(t,"vue.version",upToDate)||2}function vueVersionFroProjectPath(e){const r=(0,project_1.detectProjectKind)(e);if(r===project_1.HXProjectKind.UniApp||r===project_1.HXProjectKind.UniApp_Cli){if((0,project_1.isUniAppXProjectByPath)(e))return 3;let t=path.join(e,""+(r===project_1.HXProjectKind.UniApp_Cli?"src":""),"manifest.json");return(0,fileProperties_1.getFileProperty)(t,"vue.version",uniappProjectUpToDate)||2}let t=e,o=path.join(t,"package.json");return(0,fileProperties_1.getFileProperty)(o,"vue.version",upToDate)||2}function uniappProjectUpToDate(e,r){let t=fs.readFileSync(e).toString();const[o,i]=jsonc_1.jsonc.safe.parse(t);if(!o)return parseInt(i.vueVersion)||2}function upToDate(e,r){let t=fs.readFileSync(e).toString();const[o,i]=jsonc_1.jsonc.safe.parse(t);if(!o){let e=null;if(i.dependencies?e=i.dependencies:i.devDependencies&&(e=i.devDependencies),e&&e.vue){let r=e.vue;if("string"==typeof r)return r.startsWith("3")||r.startsWith("^3")||r.startsWith("~3.")?3:2}}}exports.vueVersion=vueVersion,exports.vueVersionFroProjectPath=vueVersionFroProjectPath;