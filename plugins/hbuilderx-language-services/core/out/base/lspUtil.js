"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.uriToPath=exports.uniPlatformCompletionSupport=exports.retriggerCommand=exports.pathToUri=exports.objToMap=exports.mapToObj=exports.isSameRange=exports.isSamePosition=exports.hxSleep=exports.getType=exports.getSysArgsData=exports.getRightLineTextFromOffset=exports.getRangeFromDocAndOffsetLength=exports.getNullRange=exports.getLineTextFromPosition=exports.getLineTextFromOffset=exports.getLeftLineTextFromOffset=exports.getFragmentString=exports.getContextLineText=exports.getContextData=exports.extLocationToOld=exports.createDocument=exports.SnippetFormat=exports.HxIconKind=void 0;const fs=require("fs"),vscode_languageserver_1=require("vscode-languageserver"),vscode_languageserver_textdocument_1=require("vscode-languageserver-textdocument"),vscode_uri_1=require("vscode-uri"),hxPluginCreateFactory_1=require("../hxPluginCreateFactory"),SnippetFormat=vscode_languageserver_1.InsertTextFormat.Snippet;exports.SnippetFormat=SnippetFormat;const retriggerCommand={title:"Suggest",command:"editor.action.triggerSuggest"};var HxIconKind;function getLineTextFromPosition(e,t){const r=e.getText().length,o=e.positionAt(r),n=e.lineCount,i=vscode_languageserver_1.Position.create(t.line,0);if(n===t.line+1){const t=vscode_languageserver_1.Range.create(i,o);return e.getText(t)}const s=t.line+1,a=vscode_languageserver_1.Position.create(s,0),g=e.offsetAt(a),p=e.positionAt(g-1),c=vscode_languageserver_1.Range.create(i,p);return e.getText(c)}function getLineTextFromOffset(e,t){const r=e.positionAt(t);return getLineTextFromPosition(e,r)}function getRightLineTextFromOffset(e,t){const r=getLineTextFromOffset(e,t),o=e.positionAt(t);return r.substring(o.character)}function getLeftLineTextFromOffset(e,t){const r=e.positionAt(t),o=vscode_languageserver_1.Position.create(r.line,0),n=vscode_languageserver_1.Range.create(o,r);return e.getText(n)}function getContextLineText(e,t){const r=getLineTextFromPosition(e,t.start),o=vscode_languageserver_1.Position.create(t.start.line,0),n=e.offsetAt(o),i=n+r.length,s=e.offsetAt(t.start),a=e.offsetAt(t.end);let g=Math.max(0,s-50),p=vscode_languageserver_1.Range.create(t.start,t.end),c=!1,u=!1;g>n&&(p.start=e.positionAt(g),c=!0),a+50<i&&(p.end=e.positionAt(a+50),u=!0);let f=e.getText(p);return c&&(f="…"+f),u&&(f+="…"),f}function getFragmentString(e,t,r){let o=t-1;const n=e;let i=r;for(r||(i=' \t\n\r":{[()]},*>+');o>=0&&-1===i.indexOf(n.charAt(o));)o--;let s=n.substring(o+1,t),a=t;for(;a!=n.length&&-1===i.indexOf(n.charAt(a));)a++;return s+n.substring(t,a)}function getContextData(e,t,r){let o=t-1;const n=e.getText();let i=r;for(r||(i=' \t\n\r":{[()]},*>+');o>=0&&-1===i.indexOf(n.charAt(o));)o--;let s=n.substring(o+1,t),a=vscode_languageserver_1.Range.create(e.positionAt(o+1),e.positionAt(t)),g=t;for(;g!=n.length&&-1===i.indexOf(n.charAt(g));)g++;let p=n.substring(t,g),c=vscode_languageserver_1.Range.create(e.positionAt(t),e.positionAt(g));return{context:s+p,leftText:s,rightText:p,contextRange:vscode_languageserver_1.Range.create(e.positionAt(o+1),e.positionAt(g)),leftRange:a,rightRange:c}}function isSamePosition(e,t){return e.line===t.line&&e.character===t.character}function isSameRange(e,t){if(!isSamePosition(e.start,t.start))return!1;return!!isSamePosition(e.end,t.end)}function createDocument(e,t){let r=fs.readFileSync(vscode_uri_1.URI.parse(e).fsPath,{encoding:"utf8",flag:"r"});return vscode_languageserver_textdocument_1.TextDocument.create(e,t,0,r)}function getNullRange(){return{start:vscode_languageserver_1.Position.create(0,0),end:vscode_languageserver_1.Position.create(0,0)}}function getType(e){const t=typeof e;return"object"!==t?t:Object.prototype.toString.call(e).replace(/^\[object (\S+)\]$/,"$1")}function uriToPath(e){return vscode_uri_1.URI.parse(e).fsPath.replace(/\\/g,"/")}function pathToUri(e){return vscode_uri_1.URI.file(e).toString()}function mapToObj(e){return Object.fromEntries(e)}function objToMap(e){let t=new Map;return"object"==typeof e&&(t=new Map(Object.entries(e))),t}function hxSleep(e){return new Promise((t=>setTimeout(t,e)))}function getSysArgsData(e,t){if(0===e.sys.args.length)return;let r;const o=e.sys.args,n=o.indexOf(t);return-1===n||(n+1<o.length&&(r=o[n+1]),r&&r.startsWith("--"))?void 0:r}function extLocationToOld(e){const t=[];return e.forEach((e=>{t.push({targetRange:e.targetRange,targetSelectionRange:e.targetSelectionRange,targetUri:e.targetUri,originSelectionRange:e.originSelectionRange})})),t}function platformSupportVer(e){return!!e.unixVer&&"x"!==e.unixVer}function platformSupport(e){const t=e,r=Object.keys(t);for(let e=0;e<r.length;e++){if(platformSupportVer(t[r[e]]))return!0}return!1}function targetSupport(e,t){const r={type:"style"};if(t===hxPluginCreateFactory_1.TargetKind["APP-ANDROID"])e.app&&(r.app={},r.app.android=e.app.android);else if(t===hxPluginCreateFactory_1.TargetKind["APP-IOS"])e.app&&(r.app={},r.app.ios=e.app.ios);else{if(t!==hxPluginCreateFactory_1.TargetKind.WEB)return e;e.web&&(r.web=e.web)}return r}function uniPlatformCompletionSupport(e,t=hxPluginCreateFactory_1.TargetKind.UNKNOWN){let r=!1;const o=targetSupport(e,t),n=Object.keys(o);for(let e=0;e<n.length;e++){const t=n[e];if("app"===t||"app-nvue"===t){r=platformSupport(o[t])}else if("mp"===t){r=platformSupport(o[t])}else if("quickapp"===t||"web"===t){r=platformSupportVer(o[t])}if(r)break}return r}function getRangeFromDocAndOffset(e,t,r){const o=e.positionAt(t),n=e.positionAt(r);return vscode_languageserver_1.Range.create(o,n)}function getRangeFromDocAndOffsetLength(e,t,r){return getRangeFromDocAndOffset(e,t,t+r)}exports.retriggerCommand=retriggerCommand,function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ABC=1]="ABC",e[e.ATTRIBUTE=2]="ATTRIBUTE",e[e.CLASS=3]="CLASS",e[e.CLIPBOARD=4]="CLIPBOARD",e[e.CSS=5]="CSS",e[e.ELEMENT=6]="ELEMENT",e[e.EVENT=7]="EVENT",e[e.FILE=8]="FILE",e[e.FOLDER=9]="FOLDER",e[e.FUNCTION=10]="FUNCTION",e[e.HTML=11]="HTML",e[e.ID=12]="ID",e[e.IMAGE=13]="IMAGE",e[e.JS=14]="JS",e[e.KEYWORD=15]="KEYWORD",e[e.SELECTOR=16]="SELECTOR",e[e.SNIPPET=17]="SNIPPET",e[e.STRING=18]="STRING"}(HxIconKind||(exports.HxIconKind=HxIconKind={})),exports.getLineTextFromPosition=getLineTextFromPosition,exports.getLineTextFromOffset=getLineTextFromOffset,exports.getRightLineTextFromOffset=getRightLineTextFromOffset,exports.getLeftLineTextFromOffset=getLeftLineTextFromOffset,exports.getContextLineText=getContextLineText,exports.getFragmentString=getFragmentString,exports.getContextData=getContextData,exports.isSamePosition=isSamePosition,exports.isSameRange=isSameRange,exports.createDocument=createDocument,exports.getNullRange=getNullRange,exports.getType=getType,exports.uriToPath=uriToPath,exports.pathToUri=pathToUri,exports.mapToObj=mapToObj,exports.objToMap=objToMap,exports.hxSleep=hxSleep,exports.getSysArgsData=getSysArgsData,exports.extLocationToOld=extLocationToOld,exports.uniPlatformCompletionSupport=uniPlatformCompletionSupport,exports.getRangeFromDocAndOffsetLength=getRangeFromDocAndOffsetLength;