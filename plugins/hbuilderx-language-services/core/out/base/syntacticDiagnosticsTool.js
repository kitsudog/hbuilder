"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SyntacticDiagnosticsTool=void 0;const indexlib_1=require("../indexlib"),lspIndexUtils_1=require("./lspIndexUtils"),lspUtil_1=require("./lspUtil"),pathUtils_1=require("./pathUtils"),util_1=require("./util");class SyntacticDiagnosticsTool{constructor(t,e){this.info=t,this.target=t.target,this.project=t.project,this.fileName=e}uniPlatformCompletionSupport(t){return!this.target||!!t&&(0,lspUtil_1.uniPlatformCompletionSupport)(t,this.target)}async getIDIndexData(){let t=new Set;const e=(0,pathUtils_1.noTsToNormalizedUri)(this.project.fsPath);if(!e)return t;let i=await this.project.indexPipeHandler.getIndexDataRequest([{projectUri:e,kind:"ID"}],!1);if(!i||!i.length)return t;i.forEach((t=>{t=(0,lspIndexUtils_1.tagNormalizedData)(t)}));let a=i[0].kindMap.ID;if(!a)return t;for(const e of Object.values(a))e.indexValues.forEach((e=>{e.kind===indexlib_1.IndexItemType.DEF&&t.add(e.value)}));return t}async getClassIndexData(){var t;let e=new Set;const i=(0,pathUtils_1.noTsToNormalizedUri)(this.project.fsPath);if(!i)return e;let a=await(0,lspIndexUtils_1.getAllKindData)(this.project,"REF",!1);if(!a)return e;let n=(null===(t=this.info.languageServiceSourceMap)||void 0===t?void 0:t.getOriginalFileName(this.fileName))||this.fileName,s=await(0,util_1.getRefSortLevel)(a,[n],this.project.fsPath),r=[];for(const t of s.keys())r.push({projectUri:i,kind:"CLASS",fileUri:t});let o=await this.project.indexPipeHandler.getIndexDataRequest(r,!1);if(!o)return e;for(const t of o){let i=t.kindMap.CLASS;if(i)for(const t of Object.values(i))t.indexValues.forEach((t=>{t.kind===indexlib_1.IndexItemType.DEF&&e.add(t.value)}))}return e}static getInstance(){return this.instance}static createInstance(t,e){this.instance=new SyntacticDiagnosticsTool(t,e)}}exports.SyntacticDiagnosticsTool=SyntacticDiagnosticsTool;