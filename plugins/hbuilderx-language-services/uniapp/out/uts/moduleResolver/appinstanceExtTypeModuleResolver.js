"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppinstanceExtTypeModuleResolver=void 0;const fs=require("fs"),path=require("path"),hx=require("../../../../core"),utsLanguageServiceInterface_1=require("../utsLanguageServiceInterface");class AppinstanceExtTypeModuleResolver{constructor(e){var t;this._info=e;const i=Date.now(),r=fs.existsSync(utsLanguageServiceInterface_1.UtsPluginLanguageService.Constants.APP_INSTANCE_EXT_TEYP_FILE_PATH)&&null!==(t=hx.readFileToString(utsLanguageServiceInterface_1.UtsPluginLanguageService.Constants.APP_INSTANCE_EXT_TEYP_FILE_PATH))&&void 0!==t?t:"";this._virtualFile={name:hx.toNormalizedPath(path.join(e.project.sourceRoot,`${i}-options.d.ts`),e.ts),getText:()=>r},this.overwriteSysApi(this._info)}resolveModuleName(e,t,i,r,s,a,n,o){if((e.kind==hx.HXProjectKind.UniApp||e.kind==hx.HXProjectKind.UniApp_Cli)&&hx.pathIsPath(i,this._virtualFile.name)&&"@/App.uvue"===t){return{isExternalLibraryImport:!1,resolvedFileName:path.join(e.sourceRoot,"App.uvue.ts"),extension:".ts"}}}getVirtualFile(){return this._virtualFile.name}overwriteSysApi(e){const t=e.ts.sys,i=t.fileExists.bind(t),r=t.readFile.bind(t);t.fileExists=t=>{let r=hx.toNormalizedPath(t,e.ts);return i(t)||hx.pathIsPath(this._virtualFile.name,r)},t.readFile=(t,i)=>{let s=hx.toNormalizedPath(t,e.ts);return hx.pathIsPath(this._virtualFile.name,s)?this._virtualFile.getText():r(t,i)}}}exports.AppinstanceExtTypeModuleResolver=AppinstanceExtTypeModuleResolver;