"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IosPlatformModuleNameResolver=exports.AndroidPlatformModuleNameResolver=exports.CommonPlatformModuleNameResolver=void 0;const fs=require("fs"),path=require("path"),hx=require("../../../../core"),types_1=require("../types"),utsLanguageServiceInterface_1=require("../utsLanguageServiceInterface"),uni_module_uts_plugin_1=require("../uni_module_uts_plugin");class CommonPlatformModuleNameResolver{constructor(e){}resolveModuleName(e,s,t,a,r,l,i,o){if(utsLanguageServiceInterface_1.Global.isUtsFile(t)||utsLanguageServiceInterface_1.Global.isClientUtsFile(t,e)){let a=s;if(e.kind!=hx.HXProjectKind.UniApp&&e.kind!=hx.HXProjectKind.UniApp_Cli||a.startsWith("@/")&&(a=path.join(e.sourceRoot,a.substring(2))),a=path.resolve(path.dirname(t),a),s.endsWith(".uts")||(a+=".uts"),fs.existsSync(a))return{isExternalLibraryImport:!1,resolvedFileName:a,extension:".uts"}}else if(utsLanguageServiceInterface_1.Global.isUtsPluginVueTsFile(t,e)&&"@vue/runtime-dom"==s){const e=path.join(utsLanguageServiceInterface_1.Global.g_extensionPath,"builtin-dts/uts/vueComponent/utsVueCompnent.d.ts");if(fs.existsSync(e))return{resolvedFileName:e,isExternalLibraryImport:!1,extension:".d.ts"}}}}exports.CommonPlatformModuleNameResolver=CommonPlatformModuleNameResolver;class AndroidPlatformModuleNameResolver extends CommonPlatformModuleNameResolver{constructor(e){super(e),this._cache=new Map}resolveModuleName(e,s,t,a,r,l,i,o){if((utsLanguageServiceInterface_1.Global.isUtsFile(t)||utsLanguageServiceInterface_1.Global.isUtsPluginVueTsFile(t,e)||utsLanguageServiceInterface_1.Global.isClientUtsFile(t,e)||utsLanguageServiceInterface_1.Global.resolveUtsPlatformByLibFiles(t,e)===types_1.UtsPluginPlatform.APP_ANDROID)&&uni_module_uts_plugin_1.AndroidLanguageService.isAndroidPackageNameLike(s)){if(this._cache.has(s))return this._cache.get(s);const e=uni_module_uts_plugin_1.AndroidLanguageService.getAndroidLibFilePathFromPackageName(s);if(e&&fs.existsSync(e)){let t={resolvedFileName:e,isExternalLibraryImport:!1,extension:".d.ts",lazyload:!0};return this._cache.set(s,t),t}}return super.resolveModuleName(e,s,t,a,r,l,i,o)}resolveModuleNameDependOnUtsLsInstance(e,s,t,a,r,l,i,o,n){if((utsLanguageServiceInterface_1.Global.isUtsFile(a)||utsLanguageServiceInterface_1.Global.isUtsPluginVueTsFile(a,s)||utsLanguageServiceInterface_1.Global.isClientUtsFile(a,s)||utsLanguageServiceInterface_1.Global.resolveUtsPlatformByLibFiles(a,s)===types_1.UtsPluginPlatform.APP_ANDROID)&&uni_module_uts_plugin_1.AndroidLanguageService.isAndroidPackageNameLike(t)){if(this._cache.has(t))return this._cache.get(t);const s=e.getAndroidLibFilePathFromPackageName(t,void 0);if(s&&fs.existsSync(s)){let e={resolvedFileName:s,isExternalLibraryImport:!1,extension:".d.ts",lazyload:!0};return this._cache.set(t,e),e}}return super.resolveModuleName(s,t,a,r,l,i,o,n)}}exports.AndroidPlatformModuleNameResolver=AndroidPlatformModuleNameResolver;class IosPlatformModuleNameResolver extends CommonPlatformModuleNameResolver{constructor(e){super(e)}resolveModuleName(e,s,t,a,r,l,i,o){if((utsLanguageServiceInterface_1.Global.isUtsFile(t)||utsLanguageServiceInterface_1.Global.isUtsPluginVueTsFile(t,e)||utsLanguageServiceInterface_1.Global.isClientUtsFile(t,e)||utsLanguageServiceInterface_1.Global.resolveUtsPlatformByLibFiles(t,e)===types_1.UtsPluginPlatform.APP_IOS)&&uni_module_uts_plugin_1.IosLanguageService.isIosPackageNameLike(s)){const e=uni_module_uts_plugin_1.IosLanguageService.getIosLibFilePathFromPackageName(s);if(e&&fs.existsSync(e)){return{resolvedFileName:e,isExternalLibraryImport:!1,lazyload:!0,extension:".d.ts"}}}return super.resolveModuleName(e,s,t,a,r,l,i,o)}resolveModuleNameDependOnUtsLsInstance(e,s,t,a,r,l,i,o,n){if((utsLanguageServiceInterface_1.Global.isUtsFile(a)||utsLanguageServiceInterface_1.Global.isUtsPluginVueTsFile(a,s)||utsLanguageServiceInterface_1.Global.isClientUtsFile(a,s)||utsLanguageServiceInterface_1.Global.resolveUtsPlatformByLibFiles(a,s)===types_1.UtsPluginPlatform.APP_IOS)&&uni_module_uts_plugin_1.IosLanguageService.isIosPackageNameLike(t)){let r=e.getIosLibFilePathFromPackageName(t,utsLanguageServiceInterface_1.Global.resolveUtsPluginName(a,s));if(!r){const l=utsLanguageServiceInterface_1.Global.resolveUtsPluginName(a,s);l&&e.thirdLibInfoProvider.hasModuleName(l,t)&&(r=e.thirdLibInfoProvider.getModulePath(l,t)[0])}if(r&&fs.existsSync(r)){return{resolvedFileName:r,isExternalLibraryImport:!1,lazyload:!0,extension:".d.ts"}}}return super.resolveModuleName(s,t,a,r,l,i,o,n)}}exports.IosPlatformModuleNameResolver=IosPlatformModuleNameResolver;