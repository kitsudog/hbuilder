"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UtsPluginLanguageService=exports.parseServerMode=exports.Global=void 0;const fs=require("fs"),path=require("path"),hx=require("../../../core"),core_1=require("../../../core"),timeWatcher_1=require("../utils/timeWatcher"),common_1=require("../utils/common"),types_1=require("./types"),uniCloudServerTsServerPluign_1=require("../uniCloud/uniCloudServerTsServerPluign"),utsUniModulePluginModuleNameResolever_1=require("./moduleResolver/utsUniModulePluginModuleNameResolever"),IPlatformModuleNameResolver_1=require("./moduleResolver/IPlatformModuleNameResolver"),easycome_1=require("../utils/easycome"),appinstanceExtTypeModuleResolver_1=require("./moduleResolver/appinstanceExtTypeModuleResolver"),extApi_1=require("../utils/extApi");var Global,UtsPluginLanguageService;function parseServerMode(){const e=core_1.ts.server.findArgument("--serverMode");if(e)switch(e.toLowerCase()){case"semantic":return core_1.ts.LanguageServiceMode.Semantic;case"partialsemantic":return core_1.ts.LanguageServiceMode.PartialSemantic;case"syntactic":return core_1.ts.LanguageServiceMode.Syntactic;default:return}}!function(e){const t=new Map;function o(e){return hx.fileEndsWith(e,[".uts"])}function s(e,t){var o,s,n;if((0,common_1.isUniModule)(e)){const t=(0,common_1.getUniModuleRoot)(e);if(t){let n=path.join(t,"utssdk");if(n=null!==(o=hx.noTsToNormalizedPath(n))&&void 0!==o?o:n,e=null!==(s=hx.noTsToNormalizedPath(e))&&void 0!==s?s:e,fs.existsSync(n)&&fs.statSync(n).isDirectory())return hx.fileStartsWith(e,[n])}}else{let o=path.join(t.sourceRoot,"utssdk");if(fs.existsSync(o)){let t=fs.readdirSync(o);for(let s of t){const t=null!==(n=hx.noTsToNormalizedPath(path.join(o,s)))&&void 0!==n?n:path.join(o,s);if(e.startsWith(t))return!0}}}return!1}function n(e,t){var o,s;if((0,common_1.isUniModule)(e))return(0,common_1.getUniModuleRoot)(e);let n=path.join(t.sourceRoot,"utssdk");if(fs.existsSync(n)){let t=fs.readdirSync(n);for(let i of t){let t=null!==(o=hx.noTsToNormalizedPath(path.join(n,i)))&&void 0!==o?o:path.join(n,i);if(e=null!==(s=hx.noTsToNormalizedPath(e))&&void 0!==s?s:e,hx.fileStartsWith(e,[t]))return t}}}e.registerPlatformApiLibsObject=function(e,o){t.has(e)||t.set(e,o)},e.getLibFiles=function(e){var o;let s=null===(o=t.get(e))||void 0===o?void 0:o.libs;return s?[...s]:[]},e.getLibFilesVersion=function(e){var o;return(null===(o=t.get(e))||void 0===o?void 0:o.version)||0},e.resolveUtsPluginPlatform=function(t,o){if(e.isUtsPluginFile(t,o)&&(e.isUtsFile(t)||e.isUtsPluginVueTsFile(t,o)))return new RegExp(`utssdk/${types_1.UtsPluginPlatform.APP_ANDROID}/`).test(t)?types_1.UtsPluginPlatform.APP_ANDROID:new RegExp(`utssdk/${types_1.UtsPluginPlatform.APP_IOS}/`).test(t)?types_1.UtsPluginPlatform.APP_IOS:new RegExp(`utssdk/${types_1.UtsPluginPlatform.WEB}/`).test(t)?types_1.UtsPluginPlatform.WEB:new RegExp(`utssdk/${types_1.UtsPluginPlatform.APP_JS}/`).test(t)?types_1.UtsPluginPlatform.APP_JS:types_1.UtsPluginPlatform.COMMON},e.resolveUtspluginPlatformRootPath=function(t,o,s){if(!e.isUtsPluginFile(t,s))return;const n=e.resolveUtsPluginRootPath(t,s);if(n){let e;return e=(0,common_1.isUniModule)(t)?path.join(n,"utssdk",o):path.join(n,o),fs.existsSync(e)?e:void 0}},e.isClientUtsFile=function(e,t){return!s(e,t)&&(o(e)||e.endsWith(".uvue.ts")||e.endsWith(".uvue.js")||e.endsWith(".uvue.__VLS_template.tsx")||e.endsWith(".uvue.1.__VLS_template.tsx")||(e.endsWith(".vue.ts")||e.endsWith(".vue.__VLS_template.tsx")||e.endsWith(".vue.1.__VLS_template.tsx")||e.endsWith(".vue.js")||e.endsWith(".vue.__VLS_template.jsx")||e.endsWith(".vue.1.__VLS_template.jsx")||hx.fileStartsWith(e,[t.sourceRoot])&&hx.fileEndsWith(e,[".ts"]))&&hx.isUniAppXProject(t))},e.isUtsFile=o,e.isUtsPluginVueTsFile=function(e,t){return s(e,t)&&(e.endsWith(".vue.ts")||e.endsWith(".vue.js"))},e.isUtsPluginFile=s,e.isUtsPluginRoot=function(e,t){if((0,common_1.isUniModule)(e)){let t=path.join(e,"utssdk");return fs.existsSync(t)&&fs.statSync(t).isDirectory()}let o=path.basename(e),s=path.join(t.sourceRoot,"utssdk",o);return hx.pathIsPath(s,e)},e.resolveUtsPluginRootPath=n,e.resolveUtsPluginName=function(e,t){const o=n(e,t);if(o)return path.basename(o)},e.getSymbol=function e(t,o,s){var n;if(!o)return o;let i=new Array(...t);for(let s=0;s<t.length;++s){if(i.shift(),""===t[s])return o;if(null===(n=o.exports)||void 0===n?void 0:n.has(t[s])){let n=o.exports.get(t[s]);return n.flags==core_1.ts.SymbolFlags.ValueModule||(n.flags&core_1.ts.SymbolFlags.ValueModule)===core_1.ts.SymbolFlags.ValueModule?e(i,n,core_1.ts):n}}return o},e.getSymbols=function e(t,o,s,n){let i=[];return t.forEach((t=>{var s;if(t==n)return;let r=t.escapedName;r=r.toLocaleLowerCase();let a=o.toLocaleLowerCase();if(r.startsWith(a)&&(t.flags!==core_1.ts.SymbolFlags.Class&&(t.flags&core_1.ts.SymbolFlags.Class)!=core_1.ts.SymbolFlags.Class||i.push(t)),t.flags!==core_1.ts.SymbolFlags.ValueModule&&(t.flags&core_1.ts.SymbolFlags.ValueModule)!==core_1.ts.SymbolFlags.ValueModule)return;let l=[];null===(s=t.exports)||void 0===s||s.forEach((e=>{l.push(e)})),i.push(...e(l,o,core_1.ts,t))})),i},e.g_extensionPath=hx.getExtensionRootPath();const i=new Map;e.registLibFilesPlatformResolver=function(e,t){if(i.has(e)){i.get(e).push(t)}const o=[t];i.set(e,o)},e.resolveUtsPlatformByLibFiles=function(e,t,o=!0){for(let[t,s]of i)for(let n of s)if(n(e,o))return t};const r=new timeWatcher_1.TimeWatcher("uts plugin");e.getTimeWatcher=function(){return r},e.localizedDiagnosticMessages={}}(Global||(exports.Global=Global={})),exports.parseServerMode=parseServerMode,function(e){function t(){return{entries:[],isGlobalCompletion:!0,isMemberCompletion:!0,isNewIdentifierLocation:!0}}function o(e,t,o,s){var n;const i=new Map,r=e.getSymbolAtLocation(t);if(r){const e=null===(n=r.exports)||void 0===n?void 0:n.get("default");if(e&&e.valueDeclaration&&core_1.ts.isExportAssignment(e.valueDeclaration)){const t=e.valueDeclaration,o=t.expression&&core_1.ts.isCallExpression(t.expression)?t.expression:void 0;if(o){const e=o.arguments.length>0?o.arguments[0]:void 0;if(e&&core_1.ts.isObjectLiteralExpression(e)){e.properties.forEach((e=>{if(core_1.ts.isMethodDeclaration(e)){const t=e;s.includes(t.name.escapedText)&&i.set(t.name.escapedText,e)}else if(core_1.ts.isPropertyAssignment(e)){const t=e;s.includes(t.name.escapedText)&&i.set(t.name.escapedText,e)}}))}}}}return i}function s(e,t,s,n){const i=path.join(Global.g_extensionPath,"builtin-dts/uts/vueComponent/utsVueCompnent.d.ts");let r=null==e?void 0:e.getProgram(),a=null==r?void 0:r.getTypeChecker(),l=null==r?void 0:r.getSourceFile(i);if(a&&l){let e=a.getSymbolsInScope(l,core_1.ts.SymbolFlags.Interface).find((e=>e.escapedName===n));if(e){let t=Object.assign({},e);if(t&&t.declarations){const e=["data","props","methods","computed"],n=o(a,s,core_1.ts,e);return e.forEach((e=>{var o;if(n.has(e)){const s=n.get(e);if(s)if(core_1.ts.isMethodDeclaration(s)){const e=null===(o=s.body)||void 0===o?void 0:o.statements.find((e=>core_1.ts.isReturnStatement(e)));e&&e.expression&&core_1.ts.isObjectLiteralExpression(e.expression)&&e.expression.properties.forEach((e=>{if(core_1.ts.isPropertyAssignment(e)){const o=e.symbol;o&&t.exportSymbol.members.set(o.escapedName,o)}}))}else if(core_1.ts.isPropertyAssignment(s)&&core_1.ts.isObjectLiteralExpression(s.initializer)){s.initializer.properties.forEach((e=>{const o=e.symbol;o&&t.exportSymbol.members.set(o.escapedName,o)}))}}})),a.getTypeAtLocation(t.declarations[0])}}}}function n(t,o,s){let n=null==t?void 0:t.getProgram(),i=null==n?void 0:n.getTypeChecker();if(i){const t="NVLoad",o=e.getExportDefaultPropertiesNode(i,s,core_1.ts,[t]);if(o.has(t)){const e=o.get(t);if(e&&core_1.ts.isMethodDeclaration(e)){const t=e.type;if(t)return i.getTypeAtLocation(t)}}}}e.DefaultUniappXCompilerOptions={allowNonTsExtensions:!0,allowJs:!0,lib:[],target:core_1.ts.ScriptTarget.Latest,moduleResolution:core_1.ts.ModuleResolutionKind.NodeNext,experimentalDecorators:!0,noLib:!0,strictNullChecks:!0,strictPropertyInitialization:!0,skipLibCheck:!0,noImplicitOverride:!0,noResolve:parseServerMode()===core_1.ts.LanguageServiceMode.PartialSemantic},e.createEmptyCompletionInfo=t,e.isVueThisContext=function(e,t){var o;let s=e;for(;s&&s.kind!=core_1.ts.SyntaxKind.SourceFile&&(!core_1.ts.isFunctionLike(s)||core_1.ts.isArrowFunction(s));)s=s.parent;if(core_1.ts.isFunctionLike(s)){if("setup"===(null===(o=s.name)||void 0===o?void 0:o.getText()))return!1;for(s=s.parent;s&&s.kind!=core_1.ts.SyntaxKind.SourceFile&&!core_1.ts.isObjectLiteralExpression(s)&&!core_1.ts.isFunctionLike(s);)s=s.parent;if(!core_1.ts.isObjectLiteralExpression(s))return!1;if(core_1.ts.isCallExpression(s.parent)){let e=s.parent;if(!e.expression.getText().endsWith("."+a.DEFINE_COMPONENT_FUNCTION_CALL_NAME)&&!e.expression.getText().endsWith("."+a.DEFINE_APP_FUNCTION_CALL_NAME))return!1}}return!0},e.getExportDefaultPropertiesNode=o,e.getThisType=s,e.get$ElType=n,e.getCrossType=function(t,o,i,r,a,l,_,c){const u=l.kind;let p=l.getSourceFile(),d=p.fileName;if(Global.isUtsPluginVueTsFile(d,i))return u===core_1.ts.SyntaxKind.ThisKeyword&&e.isVueThisContext(l,core_1.ts)?s(t,core_1.ts,p,"AndroidComponentInstance"):core_1.ts.isPropertyAccessExpression(l)&&"$el"===l.name.escapedText&&l.expression.kind===core_1.ts.SyntaxKind.ThisKeyword?n(t,core_1.ts,p):void 0},e.getImportNodeIndentText=function(e){let t="";try{if(e){const o=e.getFullText();let s=new RegExp(`(.*)(?=${e.getText()})`).exec(o);s&&s.length>1&&(t=s[1])}}catch(e){}return t},e.completionPathFilter=function(e,t){let o={entries:[],isGlobalCompletion:!0,isMemberCompletion:!0,isNewIdentifierLocation:!0};return o.isGlobalCompletion=e.isGlobalCompletion,o.isIncomplete=e.isIncomplete,o.isMemberCompletion=e.isMemberCompletion,o.isNewIdentifierLocation=e.isNewIdentifierLocation,o.optionalReplacementSpan=e.optionalReplacementSpan,e.entries.forEach((e=>{let s=!1;for(let o of t)e.name.endsWith(o)&&(s=!0);s&&o.entries.push(e)})),o},e.findImportNode=function e(t,o){let s=[];return t.forEach((t=>{core_1.ts.isImportDeclaration(t)&&s.push(t),s.push(...e(t.getChildren(),core_1.ts))})),s},e.getLastImportNode=function(e,t){if(0===e.length)return;let o=0,s=e[0];return e.forEach((e=>{if(e.end>o){if(t&&e.end>=t)return;o=e.end,s=e}})),s},e.isImportStringLiteral=function(e,t,o){let s=core_1.ts.getTokenAtPosition(e,t);return core_1.ts.isStringLiteralLike(s)&&core_1.ts.isImportDeclaration(s.parent)};const i=new Map;let r,a,l,_,c;e.getScriptFileNamesAndFileRefrences=function(e,t,o){const s=Global.getTimeWatcher();s.startCollect("get default script file names");let n=o?o():e.tsinfo.project.getScriptFileNames();s.endCollect(),s.startCollect("find file reference d.ts files");const r=[];return n.forEach((o=>{if(!e.project.isProjectOf(o,e.ts))return;let s=e.tsinfo.project.getScriptInfo(o);if(!s)return;if(!s.isScriptOpen())return;let n=i.get(t);n||(n=new Map,i.set(t,n));const a=n.get(o);if(a&&s.getLatestVersion()===a.version)return void r.push(...a.refrence);const l=t(s.getSnapshot());n.set(o,{version:s.getLatestVersion(),refrence:l}),r.push(...l)})),s.endCollect(),r},function(e){e.UTSJSONObjectType=void 0,e.platformDefaultLibs=new Map,e.utsPluginModuleNameResolvers=new Map,e.platformModuleNameResolvers=new Map,e.easycom=new Map,e.appinstanceExtTypeModuleResolvers=new Map,e.i18nWords=new Map,e.extApi=new Map}(r||(r={})),function(e){e.UTSJSONObject="UTSJSONObject",e.BASE_ERROR_CODE=110111100,e.WHITE_NAMES_LIST_PATH=path.join(Global.g_extensionPath,"uniapp/static/typeWhiteList.json"),e.UNI_APP_X_BASE_LIB_PATH=path.join(Global.g_extensionPath,"builtin-dts/uniappx/node_modules"),e.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_CLIENT_ENTRY_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@dcloudio/uni-app-x/index.d.ts"),e.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_PLUGIN_ENTRY_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@dcloudio/uni-app-x/uts-plugin.d.ts"),e.VUE_PUBLIC_TYPES_LIB_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@vue/global.d.ts"),e.VUE_LIB_ENTRY_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@vue/index.d.ts"),e.SPECIAL_STRING_BASE_LIB_PATH=path.join(Global.g_extensionPath,"builtin-dts/common/HBuilderX.d.ts"),e.UTS_BASE_LIBS_ENTRY_PATH=path.join(Global.g_extensionPath,"builtin-dts/uts-types"),e.DEFINE_COMPONENT_FUNCTION_CALL_NAME="defineComponent",e.DEFINE_MIXIN="defineMixin",e.DEFINE_APP_FUNCTION_CALL_NAME="defineApp",e.UTS_COMPONENT_TYPE_LIB_PATH=path.join(Global.g_extensionPath,"builtin-dts/uts/vueComponent/utsVueCompnent.d.ts"),e.UTS_JSON_OBJECT_TYPE_FILE_PATH=path.join(Global.g_extensionPath,"builtin-dts/uts-types/common/UTSJSONObject.d.ts"),e.I18N_FILE_PATH=path.join(Global.g_extensionPath,"uniapp/data"),e.APP_INSTANCE_EXT_TEYP_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@dcloudio/uni-app-x/options.d.ts"),e.GLOBAL_PROPERTIES_CONFIG_TYPE_FILE_PATH=path.join(e.UNI_APP_X_BASE_LIB_PATH,"@vue/runtime-core/index.d.ts"),e.GLOBAL_PROPERTIES_CONFIG_TYPE_NAME="EditorVueAppConfig",e.UNI_CLOUD_OBJECT_METHOD_HELPER_FILE_PATH=path.join(Global.g_extensionPath,"builtin-dts/uts/uni_cloud_helper/uni_cloud_object_method_signature.ts")}(a=e.Constants||(e.Constants={})),function(t){t.getDeclarationNodeFromSymbol=function(e){if(e)return e.valueDeclaration?e.valueDeclaration:e.declarations&&e.declarations.length>0?e.declarations[0]:void 0},t.getSouceFileFromType=function(t,o){const s=e.Utils.getDeclarationNodeFromSymbol(t.symbol);if(s)return s.getSourceFile()},t.getUTSJSONObjectType=function(t,o,s){if(t.cacheUTSJSONObjectType)return t.cacheUTSJSONObjectType;const n=t.getProgram();if(!n)return;const i=n.getTypeChecker();if(!i)return;let r=o?i.getSymbolsInScope(o,core_1.ts.SymbolFlags.Class).find((e=>e.escapedName===a.UTSJSONObject)):void 0;if(!r){s.tsinfo.project.log("[error] [uts] cannot find utsjsonobject global symbol,try get symbol from type file");const e=n.getSourceFile(a.UTS_JSON_OBJECT_TYPE_FILE_PATH);e&&(r=i.getSymbolsInScope(e,core_1.ts.SymbolFlags.Class).find((e=>e.escapedName===a.UTSJSONObject)))}if(r){const o=e.Utils.getDeclarationNodeFromSymbol(r);if(o){const e=i.getTypeAtLocation(o);if(e)return t.cacheUTSJSONObjectType=e,e}}},t.checkNodeLinkIs=function(e,t,o=!1){let s=o?e:e.parent,n=!0;for(let e=0;e<t.length;++e){if(!s||!t[e](s)){n=!1;break}s=s.parent}return n},t.createLanguageServiceHost=function(e,t,o){const s=hx.createLanguageServiceHost(e,t,o);return s.useCaseSensitiveFileNames||(s.useCaseSensitiveFileNames=()=>!1),s},t.createUnicloudTypeChecker=function(e){return uniCloudServerTsServerPluign_1.uniCloud.uniCloudPlugin.createTypeCheckerPlugins(e)||[]},t.getPlatformDefaultLibs=function(e,t){let o=r.platformDefaultLibs.get(n());if(o)return o;o=[],r.platformDefaultLibs.set(n(),o);const s=path.join(a.UTS_BASE_LIBS_ENTRY_PATH,t||e);return fs.readdirSync(s).forEach((e=>{const t=path.join(s,e);hx.fileEndsWith(t,[".d.ts"])&&o.push(t)})),o;function n(){return`${e}${t||""}`}},t.getUtsUniModPluginModuleNameResolver=function(e){const t=hx.toNormalizedPath(e.project.sourceRoot,e.ts);if(r.utsPluginModuleNameResolvers.has(t))return r.utsPluginModuleNameResolvers.get(t);const o=new utsUniModulePluginModuleNameResolever_1.UtsUniModulePluginModuleNameResolever(e);return r.utsPluginModuleNameResolvers.set(t,o),o},t.getEasycom=function(e){const t=hx.toNormalizedPath(e.project.sourceRoot,e.ts);if(r.easycom.has(t))return r.easycom.get(t);const o=new easycome_1.EasycomInfo(e);return r.easycom.set(t,o),o},t.getPlatformModuleNameResolver=function e(t,o){if(r.platformModuleNameResolvers.has(t))return r.platformModuleNameResolvers.get(t);switch(t){case types_1.UtsPluginPlatform.COMMON:r.platformModuleNameResolvers.set(t,new IPlatformModuleNameResolver_1.CommonPlatformModuleNameResolver(o));break;case types_1.UtsPluginPlatform.APP_ANDROID:r.platformModuleNameResolvers.set(t,new IPlatformModuleNameResolver_1.AndroidPlatformModuleNameResolver(o));break;case types_1.UtsPluginPlatform.APP_IOS:r.platformModuleNameResolvers.set(t,new IPlatformModuleNameResolver_1.IosPlatformModuleNameResolver(o));default:throw new Error("got invalid platform:"+t)}return e(t,o)},t.isDefineCallName=function(e){return e===a.DEFINE_COMPONENT_FUNCTION_CALL_NAME||e===a.DEFINE_APP_FUNCTION_CALL_NAME||e===a.DEFINE_MIXIN},t.getAppinstanceExtTypeModuleNameResolver=function(e){const t=hx.toNormalizedPath(e.project.sourceRoot,e.ts);if(r.appinstanceExtTypeModuleResolvers.has(t))return r.appinstanceExtTypeModuleResolvers.get(t);const o=new appinstanceExtTypeModuleResolver_1.AppinstanceExtTypeModuleResolver(e);return r.appinstanceExtTypeModuleResolvers.set(t,o),o},t.getEntriesByObjectKey=function(e,t,o){if(!e)return[];let s=Object.keys(e).map((e=>({name:e,kind:t,sortText:e})));return o&&(s=s.filter((e=>new RegExp(`${o}`,"gi").test(e.name)))),s},t.checkNodeIs=function(e,t){if(e.length<=t.length){for(let o=0;o<e.length;++o){const s=e[o];if(!s||!t[o](s))return!1}return!0}return!1},t.getExtApi=function(e){const t=hx.toNormalizedPath(e.project.sourceRoot,e.ts);if(r.extApi.has(t))return r.extApi.get(t);const o=new extApi_1.ExtApi(e);return r.extApi.set(t,o),o}}(l=e.Utils||(e.Utils={})),function(e){e.getSyntacticDiagnostics=function(e,t,o,s,n){var i;const r=null===(i=e.getProgram())||void 0===i?void 0:i.getSourceFile(t);if(!r)return s;const a=r,l=[],_=new Map;if(a){function u(e){if(core_1.ts.isVariableDeclaration(e)&&core_1.ts.isVariableDeclarationList(e.parent)){const t=e.type;if(t&&core_1.ts.isTypeLiteralNode(t)){const t={pos:e.pos+1,end:e.end};let o=c.createDiagnosticFromMessage(a,t,c.UTS_DIANOSTICS_I18N.direct_declaration_of_object_literal_type_is_not_supported);l.push(o)}}if((core_1.ts.isFunctionExpression(e)||core_1.ts.isArrowFunction(e)||core_1.ts.isFunctionDeclaration(e)||core_1.ts.isFunctionLike(e))&&e.parameters.forEach((e=>{})),n!==hx.TargetKind.WEB&&core_1.ts.isUnionTypeNode(e)){let t=[];if(e.types.forEach((e=>{core_1.ts.isLiteralTypeNode(e)&&e.literal.kind===core_1.ts.SyntaxKind.NullKeyword||t.push(e)})),t.length>1){const o=new Map;for(let e=0;e<t.length;++e){const s=t[e];core_1.ts.isLiteralTypeNode(s)?o.set(`${s.literal.kind}`,s):core_1.ts.isArrayTypeNode(s)?s.elementType.getText().trim().startsWith("string.")?o.set(`${s.kind}-${core_1.ts.SyntaxKind.StringKeyword}`,s):o.set(`${s.kind}-${s.elementType.kind}`,s):core_1.ts.isTypeReferenceNode(s)&&s.getText().trim().startsWith("string.")?o.set(`${core_1.ts.SyntaxKind.StringKeyword}`,s):o.set(`${s.kind}`,s)}if(o.size>1)for(let[,e]of o){const t={pos:e.getStart(),end:e.getEnd()};let o=c.createDiagnosticFromMessage(a,t,c.UTS_DIANOSTICS_I18N.only_identical_literal_union_types_are_supported);l.push(o)}else if(1===o.size){let t=[`${core_1.ts.SyntaxKind.NumberKeyword}`,`${core_1.ts.SyntaxKind.StringKeyword}`,`${core_1.ts.SyntaxKind.NumericLiteral}`,`${core_1.ts.SyntaxKind.StringLiteral}`,`${core_1.ts.SyntaxKind.ArrayType}-${core_1.ts.SyntaxKind.NumberKeyword}`,`${core_1.ts.SyntaxKind.ArrayType}-${core_1.ts.SyntaxKind.StringKeyword}`,`${core_1.ts.SyntaxKind.ArrayType}-${core_1.ts.SyntaxKind.NumericLiteral}`,`${core_1.ts.SyntaxKind.ArrayType}-${core_1.ts.SyntaxKind.StringLiteral}`];for(let[s,n]of o)if(!t.includes(s)){const t={pos:e.getStart(),end:e.getEnd()};let o=c.createDiagnosticFromMessage(a,t,c.UTS_DIANOSTICS_I18N.union_types_other_than_null_are_not_supported);l.push(o)}}}}core_1.ts.isArrayLiteralExpression(e)&&e.elements.forEach((e=>{if(core_1.ts.isOmittedExpression(e)){const t={pos:e.pos+1,end:e.end};let o=c.createDiagnosticFromMessage(a,t,c.UTS_DIANOSTICS_I18N.empty_elements_are_not_supported_in_arrays);l.push(o)}})),core_1.ts.forEachChild(e,u)}u(a),s&&s.forEach((e=>{if(e&&e.start&&e.length){let t=`${e.start},${e.start+e.length}`;if(_.get(t)===e.code)return}l.push(e)}))}return l},e.getSemanticDiagnostics=function(e,t,o,s){var n,i;const r=null===(n=e.getProgram())||void 0===n?void 0:n.getSourceFile(t);if(!r)return s;const a=r,l=[],_=null===(i=e.getProgram())||void 0===i?void 0:i.getTypeChecker(),c=new Map;if(a){function u(e){if(core_1.ts.isBinaryExpression(e)&&e.operatorToken.kind===core_1.ts.SyntaxKind.InstanceOfKeyword){const t=e.right,o=null==_?void 0:_.getSymbolsInScope(t,core_1.ts.SymbolFlags.TypeAlias);let s=null==o?void 0:o.find((e=>core_1.ts.isIdentifier(t)&&e.escapedName===t.escapedText));if(s&&s.declarations&&core_1.ts.isTypeAliasDeclaration(s.declarations[0])&&core_1.ts.isIdentifier(t)){let e=`${t.pos+1},${t.end}`;c.set(e,2693)}}if(core_1.ts.isSpreadElement(e)){let t=`${e.expression.pos},${e.expression.end}`;c.set(t,2488)}core_1.ts.forEachChild(e,u)}u(a),s&&s.forEach((e=>{if(e&&e.start&&e.length){let t=`${e.start},${e.start+e.length}`;if(c.get(t)===e.code)return}l.push(e)}))}return l},e.getCompletionEntryDetails=function(e,t,o,s,n){let i=null==e?void 0:e.getProgram(),r=null==i?void 0:i.getTypeChecker(),a=null==i?void 0:i.getSourceFile(t);if(!a||!r)return n;let l=core_1.ts.getTokenAtPosition(a,o),_=r.getContextualType(l);if(_&&_.aliasSymbol&&_.aliasSymbol.declarations&&core_1.ts.isTypeAliasDeclaration(_.aliasSymbol.declarations[0])&&core_1.ts.isUnionTypeNode(_.aliasSymbol.declarations[0].type)){let e=function(e,t,o){const s=new Map;e&&e.forEach((e=>{if(core_1.ts.isLiteralTypeNode(e)&&(e.literal.kind===core_1.ts.SyntaxKind.NumericLiteral||e.literal.kind===core_1.ts.SyntaxKind.StringLiteral)){let o=t.text.substring(e.getFullStart(),e.getStart()).trim(),n=e.literal.text,i=function(e,t){var o;const s={description:"",tags:[]};let n,i=core_1.ts.parseIsolatedJSDocComment(e);i&&i.jsDoc&&(i.jsDoc.comment&&"string"==typeof i.jsDoc.comment&&(s.description=i.jsDoc.comment),null===(o=i.jsDoc.tags)||void 0===o||o.forEach((e=>{let t=e;core_1.ts.isJSDocCommentContainingNode(e)&&t&&t.comment&&"string"==typeof t.comment&&(n={name:t.tagName.text,text:[{text:t.comment,kind:"text"}]},s.tags.push(n))})));return s}(o,core_1.ts);s.set(n,i)}}));if(s.size>0)return s;return}(_.aliasSymbol.declarations[0].type.types,a,core_1.ts),t=null==n?void 0:n.name;if(e&&t&&n){let o=e.get(t);o&&o.description&&(n.documentation=[{text:o.description,kind:"text"}],n.tags=o.tags)}}return n}}(_=e.CommonLogic||(e.CommonLogic={})),function(e){function t(e,t,o,s,n,i,r){return{code:e,category:t,key:o,message:s,reportsUnnecessary:n,elidedInCompatabilityPyramid:i,reportsDeprecated:r}}let o=0;function s(e,t){let o={...e};const s=t||[];for(let e=0;e<s.length;++e){let t=s[e];try{o.message=o.message.replace(new RegExp(`\\{${e}\\}`,"g"),t)}catch(e){}}return o}e.UTS_DIANOSTICS={method_signature_is_incompatible:t(a.BASE_ERROR_CODE+o++,1,"method_signature_is_incompatible","method signature is incompatible."),direct_declaration_of_object_literal_type_is_not_supported:t(a.BASE_ERROR_CODE+o++,1,"direct_declaration_of_object_literal_type_is_not_supported","direct declaration of Object Literal Type is not supported."),union_types_other_than_null_are_not_supported:t(a.BASE_ERROR_CODE+o++,1,"union_types_other_than_null_are_not_supported","union types other than null are not supported."),empty_elements_are_not_supported_in_arrays:t(a.BASE_ERROR_CODE+o++,1,"empty_elements_are_not_supported_in_arrays","empty elements are not supported in arrays."),utsjsonobject_type_can_not_convert_to_type_0:t(a.BASE_ERROR_CODE+o++,1,"utsjsonobject_type_can_not_convert_to_type_0","Convert type 'UTSJSONObject' to type '{0}' faild."),only_identical_literal_union_types_are_supported:t(a.BASE_ERROR_CODE+o++,1,"only_identical_literal_union_types_are_supported","only identical literal union types are supported."),type_0_cannot_be_assigned_to_type_1:t(a.BASE_ERROR_CODE+o++,1,"type_0_cannot_be_assigned_to_type_1","type '{0}' cannot be assigned to type '{1}'."),named_type_assigned_to_named_type_must_be_same:t(a.BASE_ERROR_CODE+o++,1,"named_type_assigned_to_named_type_must_be_same","named type assigned to named type must be same."),return_type_0_can_not_assign_to_return_type_1:t(a.BASE_ERROR_CODE+o++,1,"return_type_0_can_not_assign_to_return_type_1","return type '{0}' can not assign to return type '{1}'."),expected_0_parameters_type_but_got_1_parameters_type:t(a.BASE_ERROR_CODE+o++,1,"expected_0_parameters_type_but_got_1_parameters_type","expected function with {0} parameters type , but got function with {1} parameters type."),paramter_type_0_can_not_assign_to_paramter_type_1:t(a.BASE_ERROR_CODE+o++,1,"paramter_type_0_can_not_assign_to_paramter_type_1","paramter type '{0}' can not assign to paramter type '{1}'"),convert_0_to_native_platform_type:t(a.BASE_ERROR_CODE+o++,2,"convert_0_to_native_platform_type","Convert to native platform type using '{0}'."),convert_0_to_number_type:t(a.BASE_ERROR_CODE+o++,2,"convert_0_to_number_type","Convert to 'number' type using '{0}'."),signature_0_cannot_assign_to_signature_1:t(a.BASE_ERROR_CODE+o++,1,"signature_0_cannot_assign_to_signature_1","signature '{0}' cannot assign to signature '{1}'."),the_parameter_list_of_signature_0_is_not_compatible_with_the_parameter_list_of_signature_1:t(a.BASE_ERROR_CODE+o++,1,"the_parameter_list_of_signature_0_is_not_compatible_with_the_parameter_list_of_signature_1","The parameter list of signature '{0}' is not compatible with the parameter list of signature '{1}'."),target_auto_fix_text:t(a.BASE_ERROR_CODE+o++,core_1.ts.DiagnosticCategory.Message,"target_select_auto_fix","Syntax Completion and Type Check Seletion..."),try_to_use_swift_devlopment_environment_outside_uts_ios_plugin:t(a.BASE_ERROR_CODE+o++,core_1.ts.DiagnosticCategory.Error,"try_to_use_swift_devlopment_environment_outside_uts_ios_plugin","It appears you may be attempting to access the native iOS development environment, please conduct this operation within the iOS platform section of the UTS plugin.")},e.UTS_DIANOSTICS_I18N=new Proxy(e.UTS_DIANOSTICS,{get:(e,t,o)=>{var s;let n={...e[t]};return r.i18nWords.has(n.key)&&(n.message=null!==(s=r.i18nWords.get(n.key))&&void 0!==s?s:n.message),n}}),e.replaceDiagnosticMessage=s,e.mergeDiagnosticMessagesToMesssageChain=function(e){if(!e.length)throw new Error("[error][uts][diagnostic]merge diagnostic messages, but got no message!");const t=e.shift(),o={messageText:t.message,category:t.category,code:t.code,next:[]};let s=o.next;return e.forEach((e=>{let t={messageText:e.message,category:e.category,code:e.code,next:[]};s.push(t),s=t.next})),o},e.mergeDiagnosticMessageChainToMessage=function(e){let t={key:`${e.code}`,category:e.category,code:e.code,message:e.messageText},o=1,s=e.next;for(;s&&s.length;){let e=s[0];t.message+="\n",t.message+=" ".repeat(o),t.message+=e.messageText.split("\n").join(`\n${" ".repeat(o)}`),o++,s=e.next}return t},e.mergeDiagnosticMessages=function(e){if(!e.length)throw new Error("[error][uts][diagnostic]merge diagnostic messages, but got no message!");let t={...e.shift()};return e.forEach((e=>{t.message+="\n",t.message+=e.message})),t},e.createDiagnosticFromMessage=function(e,t,o,n){let i=s(o,null!=n?n:[]);return{file:e,start:t.pos,length:t.end-t.pos,code:i.code,category:i.category,messageText:i.message}},e.removeDiagnosticMessageChianSubChian=function e(t,o){var s,n;let i=t;if(t.code===o[0]&&t.messageText===(null!==(s=o[1])&&void 0!==s?s:t.messageText))return;if(!t.next||!t.next.length)return i;let r=null!==(n=i.next)&&void 0!==n?n:[],a=[];for(let t of r){let s=e(t,o);s&&a.push(s)}return a.length?(i.next=a,i):void 0}}(c=e.Diagnostic||(e.Diagnostic={})),e.init=function(t){fs.existsSync(a.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_CLIENT_ENTRY_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_CLIENT_ENTRY_FILE_PATH}`),fs.existsSync(a.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_PLUGIN_ENTRY_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.DCLOUD_IO_UNI_APP_X_BASE_LIB_PATH_PLUGIN_ENTRY_FILE_PATH}`),fs.existsSync(a.VUE_PUBLIC_TYPES_LIB_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.VUE_PUBLIC_TYPES_LIB_FILE_PATH}`),fs.existsSync(a.VUE_LIB_ENTRY_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.VUE_LIB_ENTRY_FILE_PATH}`),fs.existsSync(a.SPECIAL_STRING_BASE_LIB_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.SPECIAL_STRING_BASE_LIB_PATH}`),fs.existsSync(a.UTS_COMPONENT_TYPE_LIB_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.UTS_COMPONENT_TYPE_LIB_PATH}`),fs.existsSync(a.UTS_JSON_OBJECT_TYPE_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.UTS_JSON_OBJECT_TYPE_FILE_PATH}`),fs.existsSync(a.APP_INSTANCE_EXT_TEYP_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.APP_INSTANCE_EXT_TEYP_FILE_PATH}`),fs.existsSync(a.UNI_CLOUD_OBJECT_METHOD_HELPER_FILE_PATH)||t.tsinfo.project.log(`[ERR] [uts] dep lib file not exists: ${a.UNI_CLOUD_OBJECT_METHOD_HELPER_FILE_PATH}`),function(){var e;let o=t.ts.server.findArgument("--locale");if(o){const s=o.toLowerCase(),n=/^([a-z]+)([_\-]([a-z]+))?$/.exec(s);if(n){const o=n[1],s=n[3];let i=o;s&&(i=o+"-"+s);let l=path.join(a.I18N_FILE_PATH,`${i}/diagnosticMessages.generated.json`),_=null!==(e=hx.getFileProperty(l,"i18n",((e,o)=>{let s={};try{const e=hx.readFileToString(l);s=JSON.parse(e)}catch(e){t.tsinfo.project.log(`[ERR] [uts] parse diagnostic i18n file failed: ${e}`)}return s})))&&void 0!==e?e:{};for(let e in _)r.i18nWords.set(e,_[e])}}}(),e.init=()=>{},l.getExtApi(t)}}(UtsPluginLanguageService||(exports.UtsPluginLanguageService=UtsPluginLanguageService={}));