"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UTSPluginIosPolicy=exports.IosLanguageService=void 0;const fs=require("fs"),path=require("path"),os=require("os"),hx=require("../../../../core"),core_1=require("../../../../core"),tsUtils_1=require("../../utils/tsUtils"),types_1=require("../types"),utsLanguageServiceInterface_1=require("../utsLanguageServiceInterface"),platform_type_checker_plugin_1=require("../typeCheckerPlugin/platform_type_checker_plugin"),common_support_1=require("./common_support"),data_provider_1=require("../data_provider"),uts_plugin_policy_1=require("./uts_plugin_policy");class IosDocumentProvider extends common_support_1.CommonDocumentProvider{constructor(e,t){super(e),this._iosLs=t,this._iosTypeCheckerPlugin=new platform_type_checker_plugin_1.IosTypeChekerPlugin(e,t)}get version(){return this._info.tsinfo.project.getProjectVersion()+utsLanguageServiceInterface_1.Global.getLibFilesVersion(types_1.UtsPluginPlatform.APP_IOS)}_getDocuments(){let e=super._getDocuments();return e.push(...utsLanguageServiceInterface_1.Global.getLibFiles(types_1.UtsPluginPlatform.APP_IOS)),e}resolveModuleNameOverride(e,t,i,s,n,r,o,a){let g;try{const c=utsLanguageServiceInterface_1.UtsPluginLanguageService.Utils.getPlatformModuleNameResolver(types_1.UtsPluginPlatform.APP_IOS,this._info);g=c.resolveModuleNameDependOnUtsLsInstance?c.resolveModuleNameDependOnUtsLsInstance(this._iosLs,e,t,i,s,n,r,o,a):void 0}catch(e){g=void 0}return g||(g=super.resolveModuleNameOverride(e,t,i,s,n,r,o,a)),g}getDefaultLibs(e){return[...super.getDefaultLibs(e),...utsLanguageServiceInterface_1.UtsPluginLanguageService.Utils.getPlatformDefaultLibs(types_1.UtsPluginPlatform.APP_IOS)]}checkExpression(e,t,i,s,n,r){let o=this._iosTypeCheckerPlugin.checkExpression(e,t,i,s,n,r);return o||(o=super.checkExpression(e,t,i,s,n,r)),o}getContextualType(e,t,i,s,n){let r=this._iosTypeCheckerPlugin.getContextualType(e,t,i,s,n);return r||(r=super.getContextualType(e,t,i,s,n)),r}}class IosLanguageService{constructor(e){this._info=e,this._utsPluginLs=void 0,this._sourceFlag="uts-ios://",this._iosThirdLibInfoProvider=new data_provider_1.IosThirdLibInfoProvider(this._info.project,this._info.tsinfo.project.log.bind(this._info.tsinfo.project)),this._originalLs=void 0,utsLanguageServiceInterface_1.Global.registLibFilesPlatformResolver(types_1.UtsPluginPlatform.APP_IOS,((e,t)=>this.libFilesPlatformResolver(e,t))),IosLanguageService.init(this._info.ts)}async getCompletionsAtPosition(e,t,i){var s,n,r,o;let a=this.getUtsLanguageService(),g=a.getCompletionsAtPosition(e,t,i);const c=new Set;IosLanguageService._iosSystemLibTypeMap&&c.add(null===(s=IosLanguageService._iosSystemLibTypeMap)||void 0===s?void 0:s.path);let l=(null==g?void 0:g.entries.filter((e=>{if(e.source){const t=path.join(e.source);for(let e of c)if(t.startsWith(e))return!1}return!0})))||[],u=a.getProgram();if(u){let i=u.getSourceFile(e);if(i){let s=this._info.ts.getTokenAtPosition(i,t);if(utsLanguageServiceInterface_1.UtsPluginLanguageService.isImportStringLiteral(i,t,this._info.ts)){let t=null===(n=s.text)||void 0===n?void 0:n.trim();if(IosLanguageService.isIosPackageNameLike(t)){l.push(...utsLanguageServiceInterface_1.UtsPluginLanguageService.Utils.getEntriesByObjectKey(null===(r=IosLanguageService._iosSystemLibTypeMap)||void 0===r?void 0:r.data.tree,this._info.ts.ScriptElementKind.string,t));const i=utsLanguageServiceInterface_1.Global.resolveUtsPluginName(e,this._info.project);if(i){const e=this._iosThirdLibInfoProvider.getModuleNames(i);for(let i of e)new RegExp(`${t}`,"i").test(i)&&l.push({name:i,kind:this._info.ts.ScriptElementKind.string,sortText:i})}}}else if(!(null==g?void 0:g.isMemberCompletion)&&l.length>0){let n=this._info.ts.getTokenAtPosition(i,t-1);if(n&&this._info.ts.isIdentifier(n)){let t=new Set,i=null===(o=IosLanguageService._iosSystemLibTypeMap)||void 0===o?void 0:o.data.map;if(i)for(let e in i){const s=e.split("."),r=s[s.length-1],o=(0,tsUtils_1.fixTsNodeText)(n.getText());!r.toLocaleLowerCase().startsWith(o.toLocaleLowerCase())||"class"!==i[e].type&&"interface"!==i[e].type&&"enum"!==i[e].type||t.add(i[e])}const r=utsLanguageServiceInterface_1.Global.resolveUtsPluginName(e,this._info.project);if(r){const e=this._iosThirdLibInfoProvider.getTypeNames(r,data_provider_1.TypeKind.ALL),i=(0,tsUtils_1.fixTsNodeText)(n.getText()),s=new RegExp(`${i}`,"i");e.forEach((e=>{s.test(e.name)&&t.add({...e})}))}let a=u.getTypeChecker().getSymbolsInScope(s,core_1.ts.SymbolFlags.All),g=new Map;a.forEach((e=>{g.set(e.escapedName,e)})),t.forEach((e=>{let t=e.name.substring(0,e.name.indexOf(".")),i=e.name.substring(e.name.lastIndexOf("."),e.name.length);i=i.startsWith(".")?i.substring(1):i,g.has(i)||l.push({name:i,kind:e.type,sortText:i,source:this._sourceFlag+i,data:{exportName:i,exportMapKey:t,kind:e.type}})}))}}}}return g&&(g.entries=l),g}getCompletionEntryDetails(e,t,i,s,n,r,o){let a=this.getUtsLanguageService(),g=a.getProgram();if(g){let c=g.getSourceFile(e);if(c){if(null==n?void 0:n.startsWith(this._sourceFlag)){let l=o;if(l){let u,p={name:l.exportName,kind:l.type,kindModifiers:l.type,displayParts:[{kind:"text",text:""}],codeActions:[]},f=l.exportMapKey,h=e=>{let t=[];return e.forEach((e=>{this._info.ts.isImportDeclaration(e)&&t.push(e),t.push(...h(e.getChildren()))})),t},d=h(c.getChildren()),m=0,S=d[0];if(d.forEach((e=>{const i=e.getChildren().find((e=>e.kind===this._info.ts.SyntaxKind.StringLiteral));i&&i.text.trim()===f&&(u=e),e.end>m&&e.end<t&&(m=e.end,S=e)})),u){let v="",_={start:m,length:0};const L=u.getChildren().find((e=>e.kind===this._info.ts.SyntaxKind.ImportClause));if(L){const y=L.getText();if(L.getChildCount()>0&&this._info.ts.isIdentifier(L.getChildren()[0]))_.start=L.getStart(),_.length=y.length,v=`{ ${y}, ${l.exportMapKey} }`;else if(L.getChildCount()>0&&this._info.ts.isNamedImports(L.getChildren()[0])){_.start=L.getStart()+y.length-1;v=`${""===y.slice(1,-1).trim()?"":","} ${l.exportName} `}p.codeActions.push({description:"",changes:[{fileName:e,textChanges:[{span:_,newText:v}]}]}),p.source=[{text:f,kind:"text"}]}}else{const P=utsLanguageServiceInterface_1.UtsPluginLanguageService.getImportNodeIndentText(S);let I=`${0!==m?"\n":""}${P}import { ${l.exportName} } from '${f}';${0===m?"\n":""}`,x={start:m,length:0};p.codeActions.push({description:"",changes:[{fileName:e,textChanges:[{span:x,newText:I}]}]}),p.source=[{text:f,kind:"text"}]}return p}return}{const T=this;let b=a.getCompletionEntryDetails(e,t,i,s,n,r,o);const U=g.getTypeChecker();let C=this._info.ts.getTokenAtPosition(c,t-1);if((null==b?void 0:b.kind)===this._info.ts.ScriptElementKind.memberFunctionElement&&C.parent&&this._info.ts.isPropertyAccessExpression(C.parent)){let A=C.parent.expression,E=U.getTypeAtLocation(A);if(E){const N=E.getProperty(i);if(N){const D=N.getDeclarations();D&&k(D)}}}else if((null==b?void 0:b.kind)===this._info.ts.ScriptElementKind.alias&&C.parent&&this._info.ts.isNewExpression(C.parent)){let F=C.parent.expression;if(t>=F.getStart()&&t<=F.getEnd()){let M=U.getTypeAtLocation(F),j=null==M?void 0:M.getSymbol();if(!j){const w=U.getSymbolsInScope(C,core_1.ts.SymbolFlags.Alias).find((e=>e.escapedName===i));if(w){const O=w.getDeclarations();if(O&&O.length>0){const R=O[0];j=U.getTypeAtLocation(R).getSymbol()}}}if(j)if(j.members&&j.members.has("__constructor")){const K=j.members.get("__constructor");if(K){const W=K.getDeclarations();W&&k(W)}}else b.kind="snippet",b.name=i+"($0)"}}return b;function k(e){var t;let s=C.kind===T._info.ts.SyntaxKind.DotToken||C.kind===T._info.ts.SyntaxKind.QuestionDotToken;if(1===(null==e?void 0:e.length)){let n="(";((null===(t=e[0])||void 0===t?void 0:t.symbol.getJsDocTags())||[]).forEach(((e,t)=>{if("paramLabel"===e.name&&e.text.length>0){const i=e.text[0];"text"===i.kind&&(0===t||(n+=", "),n+=""+("_"===i.text?"":i.text+" ="),n+="$"+(t+1))}})),n.startsWith(",")&&(n=n.slice(1)),n+=")",b.kind="snippet",b.name=(s?".":"")+i+n}else if((null==e?void 0:e.length)>1){const t=[];e.forEach((e=>{let s="(",n=e.getText()||"",r="";const o=e.jsDoc?e.jsDoc:[];if(o.length>0){const e=o[0];(e.tags?e.tags:[]).forEach(((e,t)=>{"paramLabel"===e.tagName.escapedText&&e.comment&&"string"==typeof e.comment&&(0===t||(s+=", "),s+=""+("_"===e.comment.trim()?"":e.comment.trim()+" = "),s+="$"+(t+1))})),r=e.comment||""}s.startsWith(",")&&(s=s.slice(1)),s+=")",n=n.startsWith(i)?n.slice(i.length):n,n=n.startsWith("constructor")?n.slice("constructor".length):n,n=""!==n?n:s,t.push({name:n,prefix:"",body:[s],triggerAssist:!0,description:r})})),t.length>0&&(b.name=(s?".":"")+i,b.codeActions||(b.codeActions=[]),b.codeActions.push({description:"",changes:[],commands:[{command:"editor.action.triggerSnippet",arguments:{snippets:t}}]}))}}}}}return a.getCompletionEntryDetails(e,t,i,s,n,r,o)}async getDefinitionAndBoundSpan(e,t){var i;let s=this.getUtsLanguageService(),n=s.getProgram();if(n){let s=n.getSourceFile(e);if(s){let n=this._info.ts.getTokenAtPosition(s,t);if(this._info.ts.isStringLiteralLike(n)&&n.parent&&this._info.ts.isImportDeclaration(n.parent)){let t=n,s=null===(i=t.text)||void 0===i?void 0:i.trim();if(IosLanguageService.isIosPackageNameLike(s)){const i=utsLanguageServiceInterface_1.Global.resolveUtsPluginName(e,this._info.project);let n=this.getIosLibFilePathFromPackageName(s,i);if(n||i&&this.thirdLibInfoProvider.hasModuleName(i,s)&&(n=this.thirdLibInfoProvider.getModulePath(i,s)[0]),n)return{textSpan:{start:t.getStart(),length:t.getText().length},definitions:[{textSpan:{start:0,length:0},fileName:n,kind:this._info.ts.ScriptElementKind.unknown,name:s,containerKind:this._info.ts.ScriptElementKind.unknown,containerName:""}]}}}}}return s.getDefinitionAndBoundSpan(e,t)}async getQuickInfoAtPosition(e,t){return this.getUtsLanguageService().getQuickInfoAtPosition(e,t)}async getSemanticDiagnosticsAsync(e){let t=this.getUtsLanguageService(),i=t.getSemanticDiagnostics(e),s=[];return i&&i.forEach((e=>{const t=e.file,i=e.start;if(t&&i){let e=this._info.ts.getTokenAtPosition(t,i);if(this._info.ts.isStringLiteralLike(e)&&e.parent&&this._info.ts.isImportDeclaration(e.parent)){let t=e.text.trim();if(IosLanguageService.isIosPackageNameLike(t))return}else if(this._info.ts.isIdentifier(e)&&e.parent&&e.parent.parent&&(this._info.ts.isCallExpression(e.parent.parent)||this._info.ts.isNewExpression(e.parent.parent))){let i=e.parent.parent;if(i.arguments)for(let s of i.arguments){let i=s.getChildren();for(let s of i)if(s===e){if(this._info.ts.getTokenAtPosition(t,e.getEnd()).kind===this._info.ts.SyntaxKind.EqualsToken)return}}}}e.category===this._info.ts.DiagnosticCategory.Error&&(e.category=this._info.ts.DiagnosticCategory.Warning),s.push(e)})),s=utsLanguageServiceInterface_1.UtsPluginLanguageService.CommonLogic.getSemanticDiagnostics(t,e,this._info.ts,s),s}getSignatureHelpItems(e,t,i){return this.getUtsLanguageService().getSignatureHelpItems(e,t,i)}getCodeFixesAtPosition(e,t,i,s,n,r){const o=[...this.getUtsLanguageService().getCodeFixesAtPosition(e,t,i,s,n,r)];if(s.includes(2304)){const i=this.getUtsLanguageService().getProgram();if(i){const s=i.getSourceFile(e);if(s){let i=this._info.ts.getTokenAtPosition(s,t);if(i.kind===this._info.ts.SyntaxKind.Identifier){const n=i.escapedText,r=this.getDetailsInfo(e,n,!1),a=utsLanguageServiceInterface_1.UtsPluginLanguageService.findImportNode(s.getChildren(),this._info.ts);r.forEach((i=>{const s=i.name.split(".");if(s.length<=1)return;const r=s[0];let g;for(let e of a){const t=e.getChildren().find((e=>e.kind===this._info.ts.SyntaxKind.StringLiteral));if(t&&t.text.trim()===r){g=e;break}}if(!g){const i=utsLanguageServiceInterface_1.UtsPluginLanguageService.getLastImportNode(a,t);let s=i?i.end:0,g=0===s?"":"\n";g+=i?utsLanguageServiceInterface_1.UtsPluginLanguageService.getImportNodeIndentText(i):"",g+="import { ",g+=n,g+=' } from "',g+=r,g+='";',g+=0===s?"\n":"",o.push({fixName:"auto import package",description:`import default '${n}' from module '${r}'`,changes:[{fileName:e,textChanges:[{newText:g,span:{start:s,length:0}}]}]})}}))}}}}return o}async getSuggestionDiagnosticsAsync(e){return this.getUtsLanguageService().getSuggestionDiagnostics(e)}async getSyntacticDiagnosticsAsync(e){const t=this.getUtsLanguageService();let i=t.getSyntacticDiagnostics(e);return utsLanguageServiceInterface_1.UtsPluginLanguageService.CommonLogic.getSyntacticDiagnostics(t,e,this._info.ts,i,void 0)}getCompletionEntrySymbol(e,t,i,s){return this.getUtsLanguageService().getCompletionEntrySymbol(e,t,i,s)}getDefinitionAtPosition(e,t){return this.getUtsLanguageService().getDefinitionAtPosition(e,t)}getTypeDefinitionAtPosition(e,t){return this.getUtsLanguageService().getTypeDefinitionAtPosition(e,t)}getImplementationAtPosition(e,t){return this.getUtsLanguageService().getImplementationAtPosition(e,t)}getDocumentHighlights(e,t,i){return this.getUtsLanguageService().getDocumentHighlights(e,t,i)}findRenameLocations(e,t,i,s,n){return this.getUtsLanguageService().findRenameLocations(e,t,i,s,n)}getReferencesAtPosition(e,t){return this.getUtsLanguageService().getReferencesAtPosition(e,t)}findReferences(e,t){return this.getUtsLanguageService().findReferences(e,t)}getNavigateToItems(e,t,i,s){return this.getUtsLanguageService().getNavigateToItems(e,t,i,s)}getEmitOutput(e,t,i){return this.getUtsLanguageService().getEmitOutput(e,t,i)}getSemanticClassifications(e,t,i){return this.getUtsLanguageService().getSemanticClassifications(e,t,i)}getEncodedSemanticClassifications(e,t,i){return this.getUtsLanguageService().getEncodedSemanticClassifications(e,t,i)}getCombinedCodeFix(e,t,i,s){return this.getUtsLanguageService().getCombinedCodeFix(e,t,i,s)}organizeImports(e,t,i){return this.getUtsLanguageService().organizeImports(e,t,i)}getTodoComments(e,t){return this.getUtsLanguageService().getTodoComments(e,t)}getRenameInfo(e,t,i){return this.getUtsLanguageService().getRenameInfo(e,t,i)}getApplicableRefactors(e,t,i,s,n){return this.getUtsLanguageService().getApplicableRefactors(e,t,i,s,n)}getEditsForRefactor(e,t,i,s,n,r){return this.getUtsLanguageService().getEditsForRefactor(e,t,i,s,n,r)}prepareCallHierarchy(e,t){return this.getUtsLanguageService().prepareCallHierarchy(e,t)}provideCallHierarchyIncomingCalls(e,t){return this.getUtsLanguageService().provideCallHierarchyIncomingCalls(e,t)}provideCallHierarchyOutgoingCalls(e,t){return this.getUtsLanguageService().provideCallHierarchyOutgoingCalls(e,t)}provideInlayHints(e,t,i){return this.getUtsLanguageService().provideInlayHints(e,t,i)}getFileReferences(e){return this.getUtsLanguageService().getFileReferences(e)}resolvePackageNameToSymbol(e,t){if(IosLanguageService.isIosPackageNameLike(e)){return t.find((t=>t.escapedName===e))}}getUtsLanguageService(){if(!this._utsPluginLs){const e=new IosDocumentProvider(this._info,this);let t=utsLanguageServiceInterface_1.UtsPluginLanguageService.Utils.createLanguageServiceHost(e,this._info.project,this._info);const i=this._info.ts.createLanguageService2(this._info,t,this._info.project.documentRegistry);this._utsPluginLs=i}return this._utsPluginLs}setOriginalLanguageService(e){this._originalLs=e}get thirdLibInfoProvider(){return this._iosThirdLibInfoProvider}static listenSystemLibTypeMap(e){const t=path.join(utsLanguageServiceInterface_1.Global.g_extensionPath,"../uts-development-ios/uts-types",types_1.UtsPluginPlatform.APP_IOS),i=new Set,s={libs:i,version:0};if(utsLanguageServiceInterface_1.Global.registerPlatformApiLibsObject(types_1.UtsPluginPlatform.APP_IOS,s),fs.existsSync(t)){fs.readdirSync(t).forEach((e=>{e.endsWith(".d.ts")&&i.add(path.join(t,e))}))}this._iosSystemLibTypeMap=this.resolveLibTypeMap(t);const n=path.join(t,"typeMap.json");core_1.ts.sys.watchFile(n,((e,t)=>{t===core_1.ts.FileWatcherEventKind.Deleted?this._iosSystemLibTypeMap=void 0:t!==core_1.ts.FileWatcherEventKind.Created&&t!==core_1.ts.FileWatcherEventKind.Changed||(this._iosSystemLibTypeMap=this.resolveLibTypeMap(path.dirname(n)))}),300),core_1.ts.sys.watchDirectory(t,(e=>{e.endsWith(".d.ts")&&(fs.existsSync(e)?(i.add(e),s.version++):(i.delete(e),s.version++))}))}listenThirdJarDtsFiles(){}static isIosPackageNameLike(e){return!/[/\\]+/g.test(e)&&!/[.]+/g.test(e)}getIosLibFilePathFromPackageName(e,t){const i=IosLanguageService.getIosLibFilePathFromPackageName(e);if(i)return i}static resolveLibTypeMap(e){if(e&&fs.existsSync(e)){const t=path.join(e,"typeMap.json");if(fs.existsSync(t))try{return{path:e,data:JSON.parse(fs.readFileSync(t).toString())}}catch(e){}}}getTypeMapInfosFromFile(e){const t=utsLanguageServiceInterface_1.Global.resolveUtsPluginName(e,this._info.project);return t?this.getTypeMapInfosFromUtsPluinName(t):[]}getTypeMapInfosFromUtsPluinName(e){return[]}libFilesPlatformResolver(e,t){var i;if(t&&!fs.existsSync(e))return!1;if(hx.fileStartsWith(e,[path.join(utsLanguageServiceInterface_1.UtsPluginLanguageService.Constants.UTS_BASE_LIBS_ENTRY_PATH,types_1.UtsPluginPlatform.APP_IOS)]))return!0;const s=new Set(this._iosThirdLibInfoProvider.getLibDirs());IosLanguageService._iosSystemLibTypeMap&&s.add(null===(i=IosLanguageService._iosSystemLibTypeMap)||void 0===i?void 0:i.path);for(let t of s)if(path.relative(e,t).endsWith(".."))return!0;return!1}getDetailsInfo(e,t,i=!0){var s;let n=new Set,r=null===(s=IosLanguageService._iosSystemLibTypeMap)||void 0===s?void 0:s.data.map;if(r)for(let e in r)o(e,r[e]);return this.getTypeMapInfosFromFile(e).forEach((e=>{let t=e.data.map;for(let e in t)o(e,t[e])})),n;function o(e,s){const r=e.split("."),o=r[r.length-1],a=t;i?!o.toLocaleLowerCase().startsWith(a.toLocaleLowerCase())||"class"!==s.type&&"interface"!==s.type||n.add(s):o!==a||"class"!==s.type&&"interface"!==s.type||n.add(s)}}static init(e){this.listenSystemLibTypeMap(core_1.ts),this.init=()=>{}}static getIosLibFilePathFromPackageName(e){var t,i;if(this.isIosPackageNameLike(e)){const s=null===(t=this._iosSystemLibTypeMap)||void 0===t?void 0:t.data.map[e];if(s)return this.processPath(s,null===(i=this._iosSystemLibTypeMap)||void 0===i?void 0:i.path)}}static processPath(e,t){const i=e.name.replace(/\./g,"/");return"class"===e.type||"interface"===e.type||"module"===e.type?path.join(t,i,"index.d.ts"):void 0}static systemLibPlatFormResolver(e,t){var i;if(t&&!fs.existsSync(e))return!1;if(hx.fileStartsWith(e,[path.join(utsLanguageServiceInterface_1.UtsPluginLanguageService.Constants.UTS_BASE_LIBS_ENTRY_PATH,types_1.UtsPluginPlatform.APP_IOS)]))return!0;const s=null===(i=IosLanguageService._iosSystemLibTypeMap)||void 0===i?void 0:i.path;return!(!s||!path.relative(e,s).endsWith(".."))}static getModuleEntries(e){var t;return utsLanguageServiceInterface_1.UtsPluginLanguageService.Utils.getEntriesByObjectKey(null===(t=IosLanguageService._iosSystemLibTypeMap)||void 0===t?void 0:t.data.tree,"string",e)}}exports.IosLanguageService=IosLanguageService,IosLanguageService._iosSystemLibTypeMap=void 0;class IosFreezeLanguageService extends IosLanguageService{async getCompletionsAtPosition(){}getCompletionEntryDetails(){}async getDefinitionAndBoundSpan(){}async getQuickInfoAtPosition(){}async getSemanticDiagnosticsAsync(){return[]}getSignatureHelpItems(){}getCodeFixesAtPosition(){return[]}async getSuggestionDiagnosticsAsync(){return[]}async getSyntacticDiagnosticsAsync(){return[]}}class UTSPluginIosPolicy extends uts_plugin_policy_1.UTSPluginPolicy{constructor(e){super(),this._info=e}get kind(){return"uts_plugin_ios"}getLanguageServiceContextIfHasPolicy(e,t){let i=utsLanguageServiceInterface_1.Global.resolveUtsPluginPlatform(e,this._info.project);if(i&&i===types_1.UtsPluginPlatform.APP_IOS)return this._realLs||(this._realLs=this.createLanguageService()),[{languageService:this._realLs,fileName:e,position:t,target:void 0}]}createLanguageService(){return this.proxyUniModuleUtsPluginLanguageService(this.isMac?new IosLanguageService(this._info):new IosFreezeLanguageService(this._info))}get isMac(){return"darwin"===os.platform()}}exports.UTSPluginIosPolicy=UTSPluginIosPolicy;