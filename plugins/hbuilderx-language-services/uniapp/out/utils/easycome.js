"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EasycomInfo=void 0;const hx=require("../../../core"),core_1=require("../../../core"),path=require("path");function underScoreToCamelCase(e){return e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("")}class EasycomInfo{constructor(e){this.easycomList=new Map,this.hostFileName=new Map,this._info=e,this.easycomNames=new Map,this.easycomNameFile=new Map;const t=this._info.ts.sys,s=t.fileExists.bind(t),i=t.readFile.bind(t);t.fileExists=t=>s(t)||this.easycomList.has(hx.toNormalizedPath(t,e.ts)),t.readFile=(t,s)=>{let o=hx.toNormalizedPath(t,e.ts);return this.easycomList.has(o)?this.easycomList.get(o):i(t,s)}}creatVlsEasycom(e,t){e.forEach((e=>{let s=`${underScoreToCamelCase(e.name)}ComponentPublicInstance`,i="";i+=`import("${hx.toNormalizedPath(e.filePath,this._info.ts)}");\n`,i+=`declare type ${s} = typeof __easycom("${hx.toNormalizedPath(e.filePath,this._info.ts)}");\n`;let o=hx.toNormalizedPath(path.join(t,`_VLS_easycom_${e.name}.easycom.ts`),this._info.ts);this.easycomList.set(o,i),this.hostFileName.set(o,e.filePath),this.easycomNames.set(s,o),this.easycomNameFile.set(s,i)}))}getEasycomList(){return this.easycomList}getTypeNameFileName(e){return this.easycomNameFile.get(e)||""}getEasycomName(){return this.easycomNames}hasEasycomeFile(e){return!!this.easycomList.has(e)}getEasycomFile(e){let t,s=[],i=e.getText(0,e.getLength());const o=/\b\w+ComponentPublicInstance\b/g;for(;null!==(t=o.exec(i));){const e=t[0];let i=this.easycomNames.get(e);i&&s.push(i),console.log(e)}return s}getDefinitionAndBoundSpan(e,t,s,i,o){var a,n,l,r,c;if(e&&e.definitions){let o=null===(a=e.definitions[0])||void 0===a?void 0:a.fileName,m=null===(n=e.definitions[0])||void 0===n?void 0:n.name;if(!path.basename(o).startsWith("_VLS_easycom")||!m)return e;let h=null===(l=i.getProgram())||void 0===l?void 0:l.getSourceFile(t);if(h){let e=core_1.ts.getTokenAtPosition(h,s),t=null===(r=i.getProgram())||void 0===r?void 0:r.getTypeChecker();if(t){let s=t.getSymbolsInScope(h,core_1.ts.SymbolFlags.TypeAlias).find((e=>e.escapedName==m));if(s&&s.declarations){let t=null===(c=s.declarations[0])||void 0===c?void 0:c.getSourceFile(),i=null==t?void 0:t.fileName;if(this.hasEasycomeFile(i)){let t=this.hostFileName.get(i);if(t)return{textSpan:core_1.ts.createTextSpan(e.getStart(),e.getText().length),definitions:[{name:m,kind:core_1.ts.ScriptElementKind.moduleElement,containerKind:core_1.ts.ScriptElementKind.moduleElement,containerName:t,fileName:t,textSpan:core_1.ts.createTextSpan(0,0)}]}}}}}}return e}}exports.EasycomInfo=EasycomInfo,EasycomInfo._sourceFlag="easycomFlag";