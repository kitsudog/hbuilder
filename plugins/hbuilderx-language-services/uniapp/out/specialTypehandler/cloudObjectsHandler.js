"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs"),path=require("path"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),core_1=require("../../../core"),specialStringPlugin_1=require("../../../specialStringPlugin"),baseHandler_1=require("./baseHandler");function getTargetPath(e){let t=path.join(e,"index.obj.js");return fs.existsSync(t)?t:(t=path.join(e,"index.js"),fs.existsSync(t)?t:"")}class CloudObjectsHandler extends baseHandler_1.UniBaseHandler{async doCompleteAsync(e,t,r,n,a){let l=[],o=new Set;return(0,specialStringPlugin_1.getAllCloudObjects)(r.project.fsPath).forEach((e=>{o.add(e.name)})),o.forEach((e=>{l.push({label:e,kind:vscode_languageserver_protocol_1.CompletionItemKind.Property,documentation:e})})),l}async doDefinitionAsync(e,t,r,n,a){let l=e.getText(r.range),o=(0,specialStringPlugin_1.getAllCloudObjects)(r.project.fsPath);for(let e of o)if(e.name==l){let t=getTargetPath(e.path);return 0==t.length?[]:[{targetUri:t,targetRange:(0,core_1.getNullRange)(),targetSelectionRange:(0,core_1.getNullRange)(),originSelectionRange:r.range}]}return[]}}exports.default=CloudObjectsHandler;