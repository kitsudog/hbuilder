"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs"),path=require("path"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),core_1=require("../../../core"),specialStringPlugin_1=require("../../../specialStringPlugin"),baseHandler_1=require("./baseHandler");class CloudFunctionsHandler extends baseHandler_1.UniBaseHandler{async doCompleteAsync(e,t,n,r,o){let i=new Set;(0,specialStringPlugin_1.getAllCloudFunctionsWithoutObject)(n.project.fsPath).forEach((e=>{i.add(e.name)}));let a=[];return i.forEach((e=>{a.push({label:e,kind:vscode_languageserver_protocol_1.CompletionItemKind.Property,documentation:e})})),a}async doDefinitionAsync(e,t,n,r,o){let i=[],a=(0,specialStringPlugin_1.getAllCloudFunctionsWithoutObject)(n.project.fsPath),l=e.getText(n.range);if(n.kind===specialStringPlugin_1.StringLocationInfoKind.IN_JS_LIKE){const o=n.ast;r.get(specialStringPlugin_1.LanguageServiceType.TS),core_1.ts.getTokenAtPosition(o,e.offsetAt(t));for(let e of a)if(e.name==l){let t=path.join(e.path,"index.js");if(!fs.existsSync(t))return i;i.push({targetUri:t,targetRange:(0,core_1.getNullRange)(),targetSelectionRange:(0,core_1.getNullRange)(),originSelectionRange:n.range})}}return i}}exports.default=CloudFunctionsHandler;