"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagUnixResolve=void 0;const core_1=require("../../../../core"),htmlservice_1=require("../../../../htmlservice");class TagUnixResolve{constructor(e,t,i){this._languageService=e,this._allInfo=t,this._dataProviders=i}doExtraResolve(e,t,i,r){if(!(0,core_1.isUniAppXProject)(this._allInfo.project))return e;let o=this._languageService.getLocationInfoAtPosition(t,i,r);if(!o)return e;if(o.kind===htmlservice_1.LocationInfoKind.AttributeName)e.data.jsDoc=this.getAttributeJsDoc(o,e.label);else e.data.jsDoc=this.getTagJsDoc(e.label);return e}getJsDoc(e){let t=[];try{t.push({name:"uniPlatform",text:[{kind:"text",text:JSON.stringify(e)}]})}catch(e){console.error(e)}return t}getTagJsDoc(e){let t=[];for(let i=0;i<this._dataProviders.length;i++){const r=this._dataProviders[i].provideTags(),o=r.findIndex((t=>t.name===e));if(-1===o)continue;const n=r[o].uniPlatform;if(!n)continue;const s=this.getJsDoc(n);if(0!==s.length)return t.push(...s),t}return t}getAttributeJsDoc(e,t){if(!e.activeTag)return[];let i=[];for(let r=0;r<this._dataProviders.length;r++){const o=this._dataProviders[r].provideAttributes(e.activeTag).map((e=>e.name.startsWith("[event]")?{...e,name:e.name.replace("[event]","")}:e)).find((e=>e.name===t));if(!o)continue;const n=o.uniPlatform;if(!n)continue;const s=this.getJsDoc(n);if(0!==s.length)return i.push(...s),i}return i}}exports.TagUnixResolve=TagUnixResolve;