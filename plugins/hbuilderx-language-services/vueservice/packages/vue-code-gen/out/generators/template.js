"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,o,n)}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPatchForSlotNode=exports.walkElementNodes=exports.generate=exports.isIntrinsicElement=exports.transformContext=void 0;const SourceMaps=__importStar(require("../../../source-map")),code_gen_1=require("../../../code-gen"),shared_1=require("@vue/shared"),CompilerDOM=__importStar(require("@vue/compiler-dom")),CompilerCore=__importStar(require("@vue/compiler-core")),transform_1=require("../transform"),scriptSetupRanges_1=require("../parsers/scriptSetupRanges"),script_1=require("./script"),capabilitiesSet={all:{basic:!0,diagnostic:!0,references:!0,definitions:!0,rename:!0,completion:!0,semanticTokens:!0},noDiagnostic:{basic:!0,references:!0,definitions:!0,rename:!0,completion:!0,semanticTokens:!0},diagnosticOnly:{diagnostic:!0},tagHover:{basic:!0},event:{basic:!0,diagnostic:!0},tagReference:{references:!0,definitions:!0,rename:{in:!1,out:!0}},attr:{basic:!0,diagnostic:!1,references:!0,definitions:!0,rename:!0},attrReference:{references:!0,definitions:!0,rename:!0},scopedClassName:{references:!0,definitions:!0,rename:!0,completion:!0},slotName:{basic:!0,diagnostic:!0,references:!0,definitions:!0,completion:!0},slotNameExport:{basic:!0,diagnostic:!0,references:!0,definitions:!0},refAttr:{references:!0,definitions:!0,rename:!0}},formatBrackets={empty:["",""],round:["(",")"],curly:["({ __VLS_foo:","})"],square:["[","]"]},validTsVar=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;function _isHTMLTag(e){return(0,shared_1.isHTMLTag)(e)||"hgroup"===e||"slot"===e||"component"===e}function isIntrinsicElement(e="runtime-dom",t){return"runtime-dom"===e?_isHTMLTag(t)||(0,shared_1.isSVGTag)(t):["block","component","template","slot"].includes(t)}function generate(e,t,a,o,n,s=[],r,i,l){const c=new code_gen_1.CodeGen,d=new code_gen_1.CodeGen,p=new Map,f=new Map,u=new Set(s),g={},m={},x={},T=new Set,v=[],h=[];let y=0;walkElementNodes(o,(e=>{g[e.tag]||(g[e.tag]=[]);const t=g[e.tag];t.push(e.loc.start.offset+e.loc.source.indexOf(e.tag)),e.isSelfClosing||"html"!==a||t.push(e.loc.start.offset+e.loc.source.lastIndexOf(e.tag))}));for(const e in g){if(isIntrinsicElement(t.experimentalRuntimeMode,e))continue;const a=g[e],o=(a.map((t=>({start:t,end:t+e.length}))),e.indexOf("."),(0,shared_1.capitalize)((0,shared_1.camelize)(e.replace(/:/g,"-")))),n="__VLS_"+y++;m[e]={component:o,emit:n,offsets:a.map((e=>{var t;return null===(t=r({start:e,end:e}))||void 0===t?void 0:t.start})).filter(notEmpty)}}for(const e of o.children)_(e,void 0);c.addText("if (typeof __VLS_styleScopedClasses === 'object' && !Array.isArray(__VLS_styleScopedClasses)) {\n");for(const{className:e,offset:t}of v)c.addText("__VLS_styleScopedClasses["),M(e,{start:t,end:t+e.length},{vueTag:"template",capabilities:{...capabilitiesSet.scopedClassName,displayWithLink:u.has(e)}}),c.addText("];\n");c.addText("}\n"),c.addText("declare var __VLS_slots:\n");for(const[e,t]of f)c.addText(`Record<NonNullable<typeof ${e}>, typeof ${t.varName}> &\n`);c.addText("{\n");for(const[e,t]of p)b(e,t.loc,SourceMaps.Mode.Expand,{vueTag:"template",capabilities:{...capabilitiesSet.slotNameExport,referencesCodeLens:n}}),c.addText(`: (_: typeof ${t.varName}) => any,\n`);return c.addText("};\n"),{codeGen:c,cssCodeGen:d,tagNames:g,identifiers:T};function _(o,n){var i,u,g,R;if(1===o.type)!function(o,n){var i,u,g,R;const V=getPatchForSlotNode(o);if(V)return void _(V,n);"template"!==o.tag&&(n=o);if("vls-sr"===o.tag){const t=o.loc.source.indexOf(">")+1,a=o.loc.source.lastIndexOf("</"),n=o.loc.source.substring(t,a),s=e.createSourceFile("/foo.ts",n,e.ScriptTarget.ESNext),r=(0,scriptSetupRanges_1.parseBindingRanges)(e,s,!1).map((e=>n.substring(e.start,e.end)));for(const e of r)x[e]=(null!==(i=x[e])&&void 0!==i?i:0)+1;return void $(n,{start:o.loc.start.offset+t,end:o.loc.start.offset+t+n.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all})}c.addText("{\n");{isIntrinsicElement(t.experimentalRuntimeMode,o.tag);const i=null!==(g=null===(u=m[o.tag])||void 0===u?void 0:u.component)&&void 0!==g?g:o.tag,l=c.getText().length,M={},V=o.isSelfClosing||"html"!==a?void 0:o.loc.start.offset+o.loc.source.lastIndexOf(o.tag);c.addText("<"),$(i,{start:o.loc.start.offset+o.loc.source.indexOf(o.tag),end:o.loc.start.offset+o.loc.source.indexOf(o.tag)+o.tag.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:M}),c.addText(" ");const{hasRemainStyleOrClass:k}=S(o,!1,"props");let E,L;void 0===V?c.addText("/>"):(c.addText("></"),$(i,{start:V,end:V+o.tag.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:M}),c.addText(">")),E=o.loc.source.endsWith("/>")?o.loc.end.offset:o.children.length?o.loc.start.offset+o.loc.source.substring(0,o.children[0].loc.start.offset-o.loc.start.offset).lastIndexOf(">")+1:o.loc.start.offset+o.loc.source.substring(0,o.loc.source.lastIndexOf("</")).lastIndexOf(">")+1,w(c,{sourceRange:{start:o.loc.start.offset,end:E},mappedRange:{start:l,end:c.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:{}}}),c.addText("\n"),k&&(c.addText(`<${i} `),S(o,!0,"props"),c.addText("/>\n")),function(e){var t,a,o;for(const n of e.props)if(7===n.type&&"bind"===n.name&&4===(null===(t=n.arg)||void 0===t?void 0:t.type)&&4===(null===(a=n.exp)||void 0===a?void 0:a.type)&&"style"===n.arg.content&&3===n.exp.constType){const t=n.arg.loc.source[n.arg.loc.source.length-1],a=n.arg.loc.source.indexOf(t)+1,s=n.arg.loc.source.lastIndexOf(t),i=n.arg.loc.source.substring(a,s),l={start:n.arg.loc.start.offset+a,end:n.arg.loc.start.offset+s},c=null===(o=r({start:l.start,end:l.end}))||void 0===o?void 0:o.start;if(void 0===c)continue;const p=c-l.start;l.start+=p,l.end+=p,d.addText(`${e.tag} { `),d.addCode(i,l,SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{basic:!0,references:!0,definitions:!0,diagnostic:!0,rename:!0,completion:!0,semanticTokens:!0}}),d.addText(" }\n")}}(o),L=[],function(t,a,o){var n,s,r;const i=a?m[a.tag]:void 0;for(const l of t.props)if(7===l.type&&"slot"===l.name){const t="__VLS_"+y++,d="__VLS_"+y++;if(i&&a)if("UnicloudDb"===i.component){let e="";try{let t={},o=null===(n=a.codegenNode.dynamicProps)||void 0===n?void 0:n.match(/"[^"]*"/g).map((e=>e.match(/\w+/g)[0])),s=a.codegenNode.props;s&&s.properties.forEach((e=>{t[e.key.content]={value:e.value.content,isDynamic:!!(null==o?void 0:o.includes(e.key.content))}})),e=JSON.stringify(t)}catch(e){}c.addText(`type UnicloudDbType = {\n                            data:\`__VLS_useCollection(${e})\`,\n                            pagination:{\n                                current: number;\n                                size: number;\n                                count: number;\n                            },\n                            loading:boolean,\n                            hasMore:boolean\n                            error:{\n                                errCode: number | string;\n                                errMsg: string;\n                                name: string;\n                                message: string;\n                                stack?: string;\n                            },\n                            options: any\n                        };\n`),c.addText(`type UnicloudDb = {\n                            '${(0,script_1.getSlotsPropertyName)(2)}':{\n                                default:(arg: UnicloudDbType)=>{}\n                            }\n                        };\n`),c.addText(`declare const ${d}: __VLS_types.ExtractComponentSlots<UnicloudDb>;\n`)}else c.addText(`const ${t} = new ${i.component}({ `),S(a,!1,"slots"),c.addText("});\n"),c.addText(`declare const ${d}: __VLS_types.ExtractComponentSlots<typeof ${t}>;\n`);if(4===(null===(s=l.exp)||void 0===s?void 0:s.type)){c.addText("const ");const t=e.createSourceFile("/foo.ts",`const ${l.exp.content}`,e.ScriptTarget.ESNext);(0,transform_1.colletVars)(e,t,o),$(l.exp.content,{start:l.exp.loc.start.offset,end:l.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all}),c.addText(" = ")}if(!i||!a){c.addText("{} as any;\n");continue}let p="default",f=!0;4===(null===(r=l.arg)||void 0===r?void 0:r.type)&&""!==l.arg.content&&(f=l.arg.isStatic,p=l.arg.content);const u=c.getText().length;c.addText(d);const g=l.arg?{start:l.arg.loc.start.offset,end:l.arg.loc.end.offset}:{start:l.loc.start.offset,end:l.loc.start.offset+l.loc.source.split("=")[0].length};f?N(p,g,{vueTag:"template",capabilities:{...capabilitiesSet.slotName,completion:!!l.arg}},!1):(c.addText("["),O(p,g.start+1,{vueTag:"template",capabilities:capabilitiesSet.all},"",""),c.addText("]"));const m=c.getText().length;if(w(c,{mappedRange:{start:u,end:m},sourceRange:g,mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:capabilitiesSet.diagnosticOnly}}),c.addText(";\n"),f&&!l.arg){let e=l.loc.start.offset;l.loc.source.startsWith("#")?e+="#".length:l.loc.source.startsWith("v-slot:")&&(e+="v-slot:".length),c.addText(d),c.addText("['"),$("",{start:e,end:e},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{completion:!0}}),c.addText("'];\n")}}}(o,n,L);for(const e of L)x[e]=(null!==(R=x[e])&&void 0!==R?R:0)+1;const C=o.props.find((e=>7===e.type&&("scope"===e.name||"data"===e.name)));let P=!1,I=h.length;if(7===(null==C?void 0:C.type)&&C.exp){const e="__VLS_"+y++,t=`__VLS_types.withScope(__VLS_ctx, ${e})`;c.addText(`const ${e} = `),$(C.exp.loc.source,{start:C.exp.loc.start.offset,end:C.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all}),c.addText(";\n"),c.addText(`if (${t}) {\n`),h.push(t),P=!0}!function(e){var t;for(const a of e.props)if(7===a.type&&"slot"!==a.name&&"on"!==a.name&&"model"!==a.name&&"bind"!==a.name&&"scope"!==a.name&&"data"!==a.name){const e=c.getText().length;c.addText("__VLS_types.directiveFunction(__VLS_ctx."),$((0,shared_1.camelize)("v-"+a.name),{start:a.loc.start.offset,end:a.loc.start.offset+"v-".length+a.name.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.noDiagnostic,normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),T.add((0,shared_1.camelize)("v-"+a.name)),c.addText(")("),4===(null===(t=a.exp)||void 0===t?void 0:t.type)&&O(a.exp.content,a.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),c.addText(")"),w(c,{sourceRange:{start:a.loc.start.offset,end:a.loc.end.offset},mappedRange:{start:e,end:c.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:capabilitiesSet.diagnosticOnly}}),c.addText(";\n")}}(o),function(e){for(const t of e.props)6===t.type&&"ref"===t.name&&t.value&&(c.addText("// @ts-ignore\n"),O(t.value.content,t.value.loc.start.offset+1,{vueTag:"template",capabilities:capabilitiesSet.refAttr},"(",")"),c.addText(";\n"))}(o),s.length&&function(e){var t,a;for(const o of e.props)if(6===o.type&&"class"===o.name&&o.value){let e=o.value.loc.start.offset,t="";for(const a of o.value.loc.source+" ")""===a.trim()||'"'===a||"'"===a?(""!==t&&(v.push({className:t,offset:e}),e+=t.length,t=""),e+=a.length):t+=a}else 7===o.type&&4===(null===(t=o.arg)||void 0===t?void 0:t.type)&&4===(null===(a=o.exp)||void 0===a?void 0:a.type)&&"class"===o.arg.content&&(c.addText("__VLS_styleScopedClasses = ("),$(o.exp.content,{start:o.exp.loc.start.offset,end:o.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.scopedClassName}),c.addText(");\n"))}(o),z(o),function(e){var t,a,o;if("slot"!==e.tag)return;const n="__VLS_"+y++,s="__VLS_"+y++,r="__VLS_"+y++,i=u(),l=g();let d=!1;for(const a of e.props)if(7===a.type&&!a.arg&&4===(null===(t=a.exp)||void 0===t?void 0:t.type)){d=!0,c.addText(`const ${n} = `),O(a.exp.content,a.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.attrReference},"(",")"),c.addText(";\n");break}c.addText(`const ${s} = {\n`);for(const t of e.props)if(7===t.type&&4===(null===(a=t.arg)||void 0===a?void 0:a.type)&&4===(null===(o=t.exp)||void 0===o?void 0:o.type)&&"name"!==t.arg.content)b(t.arg.content,{start:t.arg.loc.start.offset,end:t.arg.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName,capabilities:capabilitiesSet.attrReference}),c.addText(": "),O(t.exp.content,t.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.attrReference},"(",")"),c.addText(",\n");else if(6===t.type&&"name"!==t.name){const e=void 0!==t.value?`"${toUnicode(t.value.content)}"`:"true";b(t.name,{start:t.loc.start.offset,end:t.loc.start.offset+t.name.length},SourceMaps.Mode.Offset,{vueTag:"template",normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName,capabilities:capabilitiesSet.attr}),c.addText(": ("),c.addText(e),c.addText("),\n")}c.addText("};\n"),d?c.addText(`var ${r}!: typeof ${n} & typeof ${s};\n`):c.addText(`var ${r}!: typeof ${s};\n`);if(l){const t="__VLS_"+y++,a="__VLS_"+y++;c.addText(`const ${t} = ${l};\n`),c.addText(`var ${a}!: typeof ${t};\n`),f.set(a,{varName:r,loc:{start:e.loc.start.offset+e.loc.source.indexOf(e.tag),end:e.loc.start.offset+e.loc.source.indexOf(e.tag)+e.tag.length}})}else p.set(i,{varName:r,loc:{start:e.loc.start.offset+e.loc.source.indexOf(e.tag),end:e.loc.start.offset+e.loc.source.indexOf(e.tag)+e.tag.length}});function u(){for(const t of e.props)if("name"===t.name&&6===t.type&&t.value&&t.value.content)return t.value.content;return"default"}function g(){var t,a;for(const o of e.props)if(7===o.type&&"bind"===o.name&&4===(null===(t=o.arg)||void 0===t?void 0:t.type)&&"name"===o.arg.content)return 4===(null===(a=o.exp)||void 0===a?void 0:a.type)?o.exp.content:"'default'"}}(o);for(const e of o.children)_(e,n);if(L)for(const e of L)x[e]--;P&&(c.addText("}\n"),h.length=I)}function z(e){var t,a,o;const n="__VLS_"+y++;let s=!1,r=(null==l?void 0:l.has(e.tag))?null===(t=l.get(e.tag))||void 0===t?void 0:t.events:void 0;for(const d of e.props){if(7===d.type&&"on"===d.name&&4===(null===(a=d.arg)||void 0===a?void 0:a.type)){const f=CompilerDOM.transformOn(d,e,exports.transformContext);for(const u of f.props){i();const g=m[e.tag],x="__VLS_"+y++;g&&c.addText(`type ${x} = typeof ${n} extends { $props: infer Props } ? Props & Record<string, unknown> : typeof ${g.component} & Record<string, unknown>;\n`),c.addText(`const __VLS_${y++}: {\n`);let T="";if((null==r?void 0:r.has(d.arg.loc.source))&&(T=r.get(d.arg.loc.source).type),T&&T.length>0)c.addText(`'${d.arg.loc.source}': ${T}\n`);else{c.addText(`'${d.arg.loc.source}': __VLS_types.FillingEventArg<\n`);{const v=(0,shared_1.camelize)("on-"+d.arg.loc.source),_="on"+(0,shared_1.capitalize)(d.arg.loc.source);g&&(c.addText("__VLS_types.FirstFunction<\n"),c.addText(`__VLS_types.EmitEvent<typeof ${g.component}, '${d.arg.loc.source}'>,\n`),c.addText(`${x}[`),M(v,[{start:d.arg.loc.start.offset,end:d.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>(0,shared_1.camelize)("on-"+e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),c.addText("],\n"),_!==v&&(c.addText(`${x}[`),M(_,[{start:d.arg.loc.start.offset,end:d.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>"on"+(0,shared_1.capitalize)(e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),c.addText("],\n")),c.addText(`typeof ${n} extends { $emit: infer Emit } ? __VLS_types.EmitEvent2<Emit, '${d.arg.loc.source}'> : unknown,\n`)),c.addText("__VLS_types.GlobalAttrs["),M(v,[{start:d.arg.loc.start.offset,end:d.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>(0,shared_1.camelize)("on-"+e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),c.addText("],\n"),g&&c.addText(">\n")}c.addText(">\n")}c.addText("} = {\n"),b(d.arg.loc.source,{start:d.arg.loc.start.offset,end:d.arg.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.event}),c.addText(": "),p(d,u.value),c.addText("};\n")}}else 7===d.type&&"on"===d.name&&4===(null===(o=d.exp)||void 0===o?void 0:o.type)&&(O(d.exp.content,d.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"$event => {(",")}"),c.addText(";\n"));function p(e,t){var a;if(4===(null===(a=e.exp)||void 0===a?void 0:a.type)){if(4===t.type)O(e.exp.content,e.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")");else if(8===t.type){const a=e.exp,o=t.children.findIndex((e=>"object"==typeof e&&4===e.type&&e.content===a.content)),n=t.children[o];let s=t.children.filter(((e,t)=>"string"==typeof e&&t<o)).map((e=>e)).join(""),r=t.children.filter(((e,t)=>"string"==typeof e&&t>o)).map((e=>e)).join("");if(s&&h.length){s=s.replace("(","{ "),r=r.replace(")","} "),s+="\n";for(const e of h)s+=`if (!(${e})) return;\n`}O(n.content,n.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},s,r)}}else c.addText("undefined")}}function i(){if(s)return;const t=m[e.tag];t&&(c.addText(`const ${n} = new ${t.component}({ `),S(e,!1,"slots"),c.addText("});\n")),s=!0}}c.addText("}\n")}(o,n);else if(12===o.type)_(o.content,n);else if(8===o.type)for(const e of o.children)"object"==typeof e&&_(e,n);else if(5===o.type){const e=o.loc.source.substring(2,o.loc.source.length-2);let t=o.loc.start.offset+2;c.addText("("),O(e,t,{vueTag:"template",capabilities:capabilitiesSet.all},"",""),c.addText(");\n")}else if(9===o.type){let e=h.length;for(let e=0;e<o.branches.length;e++){const a=o.branches[e];0===e?c.addText("if"):a.condition?c.addText("else if"):c.addText("else");let s=!1;4===(null===(i=a.condition)||void 0===i?void 0:i.type)&&(c.addText(" "),O(a.condition.loc.source,a.condition.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),t.experimentalAllowTypeNarrowingInInlineHandlers&&(h.push(a.condition.content),s=!0)),c.addText(" {\n");for(const e of a.children)_(e,n);c.addText("}\n"),s&&(h[h.length-1]=`!(${h[h.length-1]})`)}h.length=e}else if(11===o.type){const{source:t,value:a,key:s,index:r}=o.parseResult,i=a?{start:(null!==(u=null!=a?a:s)&&void 0!==u?u:r).loc.start.offset,end:(null!==(g=null!=r?r:s)&&void 0!==g?g:a).loc.end.offset}:void 0,l=i?o.loc.source.substring(i.start-o.loc.start.offset,i.end-o.loc.start.offset):void 0,d=[];if(c.addText("for (const ["),i&&l){const t=e.createSourceFile("/foo.ts",`const [${l}]`,e.ScriptTarget.ESNext);(0,transform_1.colletVars)(e,t,d);for(const e of d)x[e]=(null!==(R=x[e])&&void 0!==R?R:0)+1;$(l,i,SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all})}c.addText("] of __VLS_types.getVforSourceType"),4===t.type&&O(t.content,t.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),c.addText(") {\n");for(const e of o.children)_(e,n);c.addText("}\n");for(const e of d)x[e]--}else 2===o.type||3===o.type||c.addText(`// Unprocessed node type: ${o.type} json: ${JSON.stringify(o.loc)}\n`)}function S(e,a,o){var n,s,r,i;let l=0,d=0;for(const v of e.props)if(7!==v.type||"bind"!==v.name&&"model"!==v.name||"model"!==v.name&&4!==(null===(n=v.arg)||void 0===n?void 0:n.type)||v.exp&&4!==v.exp.type)if(6===v.type){const e=(0,shared_1.hyphenate)(v.name)===v.name?(0,shared_1.camelize)(v.name):v.name,t=v.name;if(a&&"style"!==e&&"class"!==e)continue;if("style"===e||"class"===e){if(("style"===e?l++:d++)>=1!==a)continue}g(!0);const o=c.getText().length;p(e,!0,{start:v.loc.start.offset,end:v.loc.start.offset+t.length},{vueTag:"template",capabilities:{},normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(!0),v.value?T(v.value):c.addText("true"),u(!0),m(!0);const n=c.getText().length;w(c,{sourceRange:{start:v.loc.start.offset,end:v.loc.end.offset},mappedRange:{start:o,end:n},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:x(capabilitiesSet.diagnosticOnly)}}),t!==e&&(g(!0),p(t,!0,{start:v.loc.start.offset,end:v.loc.start.offset+t.length},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(!0),v.value?T(v.value):c.addText("true"),u(!0),m(!0))}else if(7!==v.type||"bind"!==v.name||v.arg||4!==(null===(i=v.exp)||void 0===i?void 0:i.type)){if(a)continue}else{if(a)continue;"props"===o?c.addText("{..."):c.addText("..."),O(v.exp.content,v.exp.loc.start.offset,{vueTag:"template",capabilities:x(capabilitiesSet.all)},"(",")"),"props"===o?c.addText("} "):c.addText(", ")}else{const o=!v.arg||4===v.arg.type&&v.arg.isStatic;let n=4===(null===(s=v.arg)||void 0===s?void 0:s.type)?3===v.arg.constType?v.arg.content:v.arg.loc.source:getModelValuePropName(e,t.target);v.modifiers.some((e=>"prop"===e||"attr"===e))&&(n=n.substring(1));const i=o&&(0,shared_1.hyphenate)(n)===n?(0,shared_1.camelize)(n):n;if(a&&"style"!==i&&"class"!==i)continue;if("style"===i||"class"===i){if(("style"===i?l++:d++)>=1!==a)continue}g(o);const T=c.getText().length;v.arg?3===(null===(r=v.exp)||void 0===r?void 0:r.constType)?p(i,o,{start:v.arg.loc.start.offset,end:v.arg.loc.start.offset+n.length},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}):p(i,o,{start:v.arg.loc.start.offset,end:v.arg.loc.end.offset},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}):p(n,o,{start:v.loc.start.offset,end:v.loc.start.offset+"v-model".length},{vueTag:"template",capabilities:x(capabilitiesSet.attr)}),f(o),v.exp&&3!==v.exp.constType?O(v.exp.loc.source,v.exp.loc.start.offset,{vueTag:"template",capabilities:x(capabilitiesSet.all)},"(",")"):c.addText("undefined"),u(o),w(c,{sourceRange:{start:v.loc.start.offset,end:v.loc.end.offset},mappedRange:{start:T,end:c.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:x(capabilitiesSet.diagnosticOnly)}}),m(o),v.arg&&n!==i&&(g(o),p(n,o,{start:v.arg.loc.start.offset,end:v.arg.loc.end.offset},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(o),v.exp?O(v.exp.loc.source,void 0,void 0,"(",")"):c.addText("undefined"),u(o),m(o))}return{hasRemainStyleOrClass:l>=2||d>=2};function p(e,t,a,n){"props"===o&&t?$(e,a,SourceMaps.Mode.Offset,n):b(e,a,SourceMaps.Mode.Offset,n)}function f(e){"props"===o&&e?c.addText("={"):c.addText(": (")}function u(e){"props"===o&&e?c.addText("}"):c.addText(")")}function g(e){"props"!==o||e||c.addText("{...{")}function m(e){"props"===o&&e?c.addText(" "):"props"!==o||e?c.addText(", "):c.addText("}} ")}function x(e){return"props"===o?e:{references:e.references,rename:e.rename}}function T(e){c.addText('"');let t=e.loc.start.offset,a=e.loc.end.offset;a-t>e.content.length&&(t++,a--),$(toUnicode(e.content),{start:t,end:a},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{}}),c.addText('"')}}function b(e,t,a,o){return validTsVar.test(e)?($(e,t,a,o),1):e.startsWith("[")&&e.endsWith("]")?(O(e,t.start,o,"",""),1):(M(e,t,o),2)}function N(e,t,a,o=!0){return o&&validTsVar.test(e)?(c.addText("."),t.end-t.start===e.length?$(e,t,SourceMaps.Mode.Offset,a):$(e,t,SourceMaps.Mode.Expand,a),1):e.startsWith("[")&&e.endsWith("]")?($(e,t,SourceMaps.Mode.Offset,a),2):(c.addText("["),M(e,t,a),c.addText("]"),3)}function M(e,t,a){const o=`'${e}'`;for(const e of"length"in t?t:[t])w(c,{sourceRange:e,mappedRange:{start:c.getText().length+1,end:c.getText().length+o.length-1},mode:SourceMaps.Mode.Offset,additional:[{sourceRange:e,mappedRange:{start:c.getText().length,end:c.getText().length+o.length},mode:SourceMaps.Mode.Totally}],data:a});c.addText(o)}function O(t,a,o,n,s){if(0===t.length||0===t.trim().length){let e=t.length+1;t="$".repeat(e),a&&a--}(0,transform_1.walkInterpolationFragment)(e,n+t+s,((e,s,r)=>{if(void 0===s)c.addText(e);else{let i="";const l=(s-=n.length)+e.length-t.length;l>0&&(i=e.substring(e.length-l),e=e.substring(0,e.length-l)),s<0&&(c.addText(e.substring(0,-s)),e=e.substring(-s),s=0),void 0!==a&&void 0!==o?$(e,{start:a+s,end:a+s+e.length},SourceMaps.Mode.Offset,r?{vueTag:o.vueTag,capabilities:{diagnostic:!0}}:o):c.addText(e),c.addText(i)}}),x,T)}function $(e,t,a,o){const n=c.addText(e);w(c,{sourceRange:t,mappedRange:n,mode:a,data:o})}function w(e,t){var a,o;const n={...t},s=null===(a=r(t.sourceRange))||void 0===a?void 0:a.start;if(void 0===s)return;const i=s-t.sourceRange.start;if(n.sourceRange={start:t.sourceRange.start+i,end:t.sourceRange.end+i},t.additional){n.additional=[];for(const e of t.additional){let t=null===(o=r(e.sourceRange))||void 0===o?void 0:o.start;if(void 0===t)continue;const a=t-e.sourceRange.start;n.additional.push({...e,sourceRange:{start:e.sourceRange.start+a,end:e.sourceRange.end+a}})}}e.addMapping2(n)}}function walkElementNodes(e,t){if(0===e.type)for(const a of e.children)walkElementNodes(a,t);else if(1===e.type){const a=getPatchForSlotNode(e);if(a)return void walkElementNodes(a,t);t(e);for(const a of e.children)walkElementNodes(a,t)}else if(9===e.type)for(let a=0;a<e.branches.length;a++){const o=e.branches[a];for(const e of o.children)walkElementNodes(e,t)}else if(11===e.type)for(const a of e.children)walkElementNodes(a,t)}function toUnicode(e){return e.split("").map((e=>{var t=e.charCodeAt(0).toString(16).padStart(4,"0");return t.length>2?"\\u"+t:e})).join("")}function unHyphenatComponentName(e){return(0,shared_1.camelize)("-"+e)}function keepHyphenateName(e,t){return e===(0,shared_1.hyphenate)(e)?(0,shared_1.hyphenate)(t):t}function getModelValuePropName(e,t){var a;const o=e.tag,n=e.props.find((e=>6===e.type&&"type"===e.name)),s=null===(a=null==n?void 0:n.value)||void 0===a?void 0:a.content;return"input"===o&&"checkbox"===s?"checked":"input"===o||"textarea"===o||"select"===o||t<3?"value":"modelValue"}function getPatchForSlotNode(e){const t=e.props.find((e=>7===e.type&&"for"===e.name));if(t){let a;if(CompilerCore.processFor(e,t,exports.transformContext,(e=>{a={...e}})),a)return a.children=[{...e,props:e.props.filter((e=>e!==t))}],a}}function notEmpty(e){return null!=e}exports.transformContext={onError:()=>{},helperString:e=>e.toString(),replaceNode:e=>{},cacheHandlers:!1,prefixIdentifiers:!1,scopes:{vFor:0,vOnce:0,vPre:0,vSlot:0},expressionPlugins:["typescript"]},exports.isIntrinsicElement=isIntrinsicElement,exports.generate=generate,exports.walkElementNodes=walkElementNodes,exports.getPatchForSlotNode=getPatchForSlotNode;