"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventResponse=void 0;const node_1=require("vscode-languageserver/node"),indexUtils_1=require("./indexHandler/indexUtils"),priority_1=require("./indexHandler/priority"),projectManager_1=require("./indexHandler/projectManager"),taskQueue_1=require("./indexHandler/taskQueue");class EventResponse{static instance(e,t,a){return void 0===this._instance&&(this._instance=new EventResponse(e,t,a)),this._instance}constructor(e,t,a){this._priority=priority_1.Priority.instance(),this._documents=e,this._projectManager=projectManager_1.ProjectManager.instance(a),this._taskHandler=taskQueue_1.TaskQueue.instance(e,t,projectManager_1.ProjectManager.instance(a))}onRemoveProject(e){this._taskHandler.deleteTaskFromUriList([e]),this._projectManager.deleteProjectHandler(e)}onAddProject(e){this._projectManager.updateProjectVersion(e);const t=this._projectManager.getProjectHandler(e).fileTask.getFirstTaskMap();this._taskHandler.addTaskFromMap(t)}onDidChangeContent(e,t){this._projectManager.updateProjectVersion(e),this._taskHandler.delayAddTask(e,t,500)}onDidClose(e,t){this._projectManager.updateProjectVersion(e),this._taskHandler.delayAddTask(e,t,20)}onWatchedFileChange(e,t,a){this._projectManager.updateProjectVersion(e),this._taskHandler.delayAddTask(e,t,500)}onWatchedFolderChange(e,t,a){this._projectManager.updateProjectVersion(e);const r=this._projectManager.getProjectHandler(e).fileTask.getTaskMapFromFolder(t);this._taskHandler.addTaskFromMap(r)}onWatchedDelete(e,t,a){a===node_1.FileChangeType.Deleted&&(this._projectManager.updateProjectVersion(e),this._taskHandler.deleteTaskFromUriList([t]),this._projectManager.getProjectHandler(e).fileData.removeIndexDataFromUri(t))}onEditorActivatedNotify(e,t){this._priority.changePriority(e,t)}async onRebuildIndex(e){return await(0,indexUtils_1.doRemainingTasks)(this._taskHandler,this._projectManager,e,!0)}async onQuery(e,t){return await(0,indexUtils_1.indexQueryData)(this._taskHandler,this._projectManager,e,t)}}exports.EventResponse=EventResponse;