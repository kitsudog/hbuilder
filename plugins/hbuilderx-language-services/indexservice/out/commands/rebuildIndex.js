"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RebuildIndex=void 0;const vscode=require("vscode"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../core"),nls=require("../localize/localize"),localize=nls.loadMessageBundle(__filename);class RebuildIndex{constructor(e){this.client=e}async rebuildIndex(e){if(!e){const e=localize("indexservice.command.rebuild.missParameter.error","构建索引失败: 未获取到项目参数");return void vscode.window.setStatusBarMessage(e,5e3,"error")}let r,s;if(Array.isArray(e)?e.length>0&&(r=e[0].workspaceFolder):r=e.workspaceFolder,!r){const e=localize("indexservice.command.rebuild.notWorkspaceFolder.error","构建索引失败: 未获取到路径");return void vscode.window.setStatusBarMessage(e,5e3,"error")}let i="";if(r.uri&&"file"===r.uri.scheme&&(i=r.name,s=vscode_uri_1.URI.file(r.uri.fsPath)),!s){let e=localize("indexservice.command.rebuild.notProjectUri.error","构建索引失败: 无效的项目");return void vscode.window.setStatusBarMessage(e,5e3,"error")}const o={folderUri:s.toString()};vscode.window.setStatusBarMessage(localize("indexservice.command.rebuild.processing.info","正在构建项目[{0}]索引...",i),-1);const d=await this.client.sendRequest(core_1.RebuildProjectIndexRequest.type,o);if(d.isSuccess){let e=localize("indexservice.command.rebuild.success.info","项目[{0}]构建索引完成",i);vscode.window.setStatusBarMessage(e,5e3)}else{let e=localize("indexservice.command.rebuild.failure.error","项目[{0}]构建索引失败",i);e+=`: ${d.errorMessage}`,vscode.window.setStatusBarMessage(e,5e3,"error")}}getRebuildCommand(){return vscode.commands.registerCommand("indexService.rebuildIndex",this.rebuildIndex.bind(this))}}exports.RebuildIndex=RebuildIndex;