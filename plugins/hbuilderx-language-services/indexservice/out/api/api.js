"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIndexData=void 0;const core_1=require("../../../core");async function getAllKindData(e,t,r){const n={projectUri:t,kind:r},o=await e.sendRequest(core_1.GetIndexDataRequest.type,[n]);if(!o)return;if(0===o.length)return;return(0,core_1.normalizationIndexData)(o[0])}async function getIndexData(e,t){const r=(0,core_1.noTsToNormalizedUri)(t.projectPath),n=t.kind;if(!r)return"Error! projectUri not find!";if(!n)return"Error! kind not find!";const o=await getAllKindData(e,r,n);if(!o)return;if(!t.filePath)return o;const i=(0,core_1.noTsToNormalizedUri)(t.filePath);if(!i)return o;let a=[i];const c=(0,core_1.iterateGetBackReference)(o,[i],new Map);let s=(0,core_1.getReferenceList)(c);s||(s=[]),a.push(...s);const u=(0,core_1.iterateGetReference)(o,a,new Map);let d=(0,core_1.getReferenceList)(u);if(d||(d=[]),a.push(...d),0===a.length)return;const f={projectUri:r,kind:n},l=(0,core_1.getIndexDataOptionsFromList)(a,f),p=await e.sendRequest(core_1.GetIndexDataRequest.type,l);if(!p)return;if(0===p.length)return;const x={options:{text:t.filePath},filter:function(e,t){let r=!1;void 0!==t.options.text&&t.options.text.toLowerCase()===e.value.toLowerCase()&&(r=!0);return!r}},_=[],g=(0,core_1.lspFilterIndexData)(o,x);return _.push(g),_}exports.getIndexData=getIndexData;