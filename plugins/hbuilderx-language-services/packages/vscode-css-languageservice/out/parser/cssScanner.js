"use strict";var TokenType;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scanner=exports.MultiLineStream=exports.TokenType=void 0,function(e){e[e.Ident=0]="Ident",e[e.AtKeyword=1]="AtKeyword",e[e.String=2]="String",e[e.BadString=3]="BadString",e[e.UnquotedString=4]="UnquotedString",e[e.Hash=5]="Hash",e[e.Num=6]="Num",e[e.Percentage=7]="Percentage",e[e.Dimension=8]="Dimension",e[e.UnicodeRange=9]="UnicodeRange",e[e.CDO=10]="CDO",e[e.CDC=11]="CDC",e[e.Colon=12]="Colon",e[e.SemiColon=13]="SemiColon",e[e.CurlyL=14]="CurlyL",e[e.CurlyR=15]="CurlyR",e[e.ParenthesisL=16]="ParenthesisL",e[e.ParenthesisR=17]="ParenthesisR",e[e.BracketL=18]="BracketL",e[e.BracketR=19]="BracketR",e[e.Whitespace=20]="Whitespace",e[e.Includes=21]="Includes",e[e.Dashmatch=22]="Dashmatch",e[e.SubstringOperator=23]="SubstringOperator",e[e.PrefixOperator=24]="PrefixOperator",e[e.SuffixOperator=25]="SuffixOperator",e[e.Delim=26]="Delim",e[e.EMS=27]="EMS",e[e.EXS=28]="EXS",e[e.Length=29]="Length",e[e.Angle=30]="Angle",e[e.Time=31]="Time",e[e.Freq=32]="Freq",e[e.Exclamation=33]="Exclamation",e[e.Resolution=34]="Resolution",e[e.Comma=35]="Comma",e[e.Charset=36]="Charset",e[e.EscapedJavaScript=37]="EscapedJavaScript",e[e.BadEscapedJavaScript=38]="BadEscapedJavaScript",e[e.Comment=39]="Comment",e[e.SingleLineComment=40]="SingleLineComment",e[e.EOF=41]="EOF",e[e.CustomToken=42]="CustomToken"}(TokenType||(exports.TokenType=TokenType={}));class MultiLineStream{constructor(e){this.source=e,this.len=e.length,this.position=0}substring(e,t=this.position){return this.source.substring(e,t)}eos(){return this.len<=this.position}pos(){return this.position}goBackTo(e){this.position=e}goBack(e){this.position-=e}advance(e){this.position+=e}nextChar(){return this.source.charCodeAt(this.position++)||0}peekChar(e=0){return this.source.charCodeAt(this.position+e)||0}lookbackChar(e=0){return this.source.charCodeAt(this.position-e)||0}advanceIfChar(e){return e===this.source.charCodeAt(this.position)&&(this.position++,!0)}advanceIfChars(e){if(this.position+e.length>this.source.length)return!1;let t=0;for(;t<e.length;t++)if(this.source.charCodeAt(this.position+t)!==e[t])return!1;return this.advance(t),!0}advanceWhileChar(e){const t=this.position;for(;this.position<this.len&&e(this.source.charCodeAt(this.position));)this.position++;return this.position-t}}exports.MultiLineStream=MultiLineStream;const _a="a".charCodeAt(0),_f="f".charCodeAt(0),_z="z".charCodeAt(0),_A="A".charCodeAt(0),_F="F".charCodeAt(0),_Z="Z".charCodeAt(0),_0="0".charCodeAt(0),_9="9".charCodeAt(0),_TLD="~".charCodeAt(0),_HAT="^".charCodeAt(0),_EQS="=".charCodeAt(0),_PIP="|".charCodeAt(0),_MIN="-".charCodeAt(0),_USC="_".charCodeAt(0),_PRC="%".charCodeAt(0),_MUL="*".charCodeAt(0),_LPA="(".charCodeAt(0),_RPA=")".charCodeAt(0),_LAN="<".charCodeAt(0),_RAN=">".charCodeAt(0),_ATS="@".charCodeAt(0),_HSH="#".charCodeAt(0),_DLR="$".charCodeAt(0),_BSL="\\".charCodeAt(0),_FSL="/".charCodeAt(0),_NWL="\n".charCodeAt(0),_CAR="\r".charCodeAt(0),_LFD="\f".charCodeAt(0),_DQO='"'.charCodeAt(0),_SQO="'".charCodeAt(0),_WSP=" ".charCodeAt(0),_TAB="\t".charCodeAt(0),_SEM=";".charCodeAt(0),_COL=":".charCodeAt(0),_CUL="{".charCodeAt(0),_CUR="}".charCodeAt(0),_BRL="[".charCodeAt(0),_BRR="]".charCodeAt(0),_CMA=",".charCodeAt(0),_DOT=".".charCodeAt(0),_BNG="!".charCodeAt(0),staticTokenTable={};staticTokenTable[_SEM]=TokenType.SemiColon,staticTokenTable[_COL]=TokenType.Colon,staticTokenTable[_CUL]=TokenType.CurlyL,staticTokenTable[_CUR]=TokenType.CurlyR,staticTokenTable[_BRR]=TokenType.BracketR,staticTokenTable[_BRL]=TokenType.BracketL,staticTokenTable[_LPA]=TokenType.ParenthesisL,staticTokenTable[_RPA]=TokenType.ParenthesisR,staticTokenTable[_CMA]=TokenType.Comma;const staticUnitTable={};staticUnitTable.em=TokenType.EMS,staticUnitTable.ex=TokenType.EXS,staticUnitTable.px=TokenType.Length,staticUnitTable.cm=TokenType.Length,staticUnitTable.mm=TokenType.Length,staticUnitTable.in=TokenType.Length,staticUnitTable.pt=TokenType.Length,staticUnitTable.pc=TokenType.Length,staticUnitTable.deg=TokenType.Angle,staticUnitTable.rad=TokenType.Angle,staticUnitTable.grad=TokenType.Angle,staticUnitTable.ms=TokenType.Time,staticUnitTable.s=TokenType.Time,staticUnitTable.hz=TokenType.Freq,staticUnitTable.khz=TokenType.Freq,staticUnitTable["%"]=TokenType.Percentage,staticUnitTable.fr=TokenType.Percentage,staticUnitTable.dpi=TokenType.Resolution,staticUnitTable.dpcm=TokenType.Resolution;class Scanner{constructor(){this.stream=new MultiLineStream(""),this.ignoreComment=!0,this.ignoreWhitespace=!0,this.inURL=!1}setSource(e){this.stream=new MultiLineStream(e)}finishToken(e,t,s){return{offset:e,len:this.stream.pos()-e,type:t,text:s||this.stream.substring(e)}}substring(e,t){return this.stream.substring(e,e+t)}pos(){return this.stream.pos()}goBackTo(e){this.stream.goBackTo(e)}scanUnquotedString(){const e=this.stream.pos(),t=[];return this._unquotedString(t)?this.finishToken(e,TokenType.UnquotedString,t.join("")):null}scan(){const e=this.trivia();if(null!==e)return e;const t=this.stream.pos();return this.stream.eos()?this.finishToken(t,TokenType.EOF):this.scanNext(t)}scanNext(e){if(this.stream.advanceIfChars([_LAN,_BNG,_MIN,_MIN]))return this.finishToken(e,TokenType.CDO);if(this.stream.advanceIfChars([_MIN,_MIN,_RAN]))return this.finishToken(e,TokenType.CDC);let t=[];if(this.ident(t))return this.finishToken(e,TokenType.Ident,t.join(""));if(this.stream.advanceIfChar(_ATS)){if(t=["@"],this._name(t)){const s=t.join("");return"@charset"===s?this.finishToken(e,TokenType.Charset,s):this.finishToken(e,TokenType.AtKeyword,s)}return this.finishToken(e,TokenType.Delim)}if(this.stream.advanceIfChar(_HSH))return t=["#"],this._name(t)?this.finishToken(e,TokenType.Hash,t.join("")):this.finishToken(e,TokenType.Delim);if(this.stream.advanceIfChar(_BNG))return this.finishToken(e,TokenType.Exclamation);if(this._number()){const s=this.stream.pos();if(t=[this.stream.substring(e,s)],this.stream.advanceIfChar(_PRC))return this.finishToken(e,TokenType.Percentage);if(this.ident(t)){const i=this.stream.substring(s).toLowerCase(),r=staticUnitTable[i];return void 0!==r?this.finishToken(e,r,t.join("")):this.finishToken(e,TokenType.Dimension,t.join(""))}return this.finishToken(e,TokenType.Num)}t=[];let s=this._string(t);return null!==s?this.finishToken(e,s,t.join("")):(s=staticTokenTable[this.stream.peekChar()],void 0!==s?(this.stream.advance(1),this.finishToken(e,s)):this.stream.peekChar(0)===_TLD&&this.stream.peekChar(1)===_EQS?(this.stream.advance(2),this.finishToken(e,TokenType.Includes)):this.stream.peekChar(0)===_PIP&&this.stream.peekChar(1)===_EQS?(this.stream.advance(2),this.finishToken(e,TokenType.Dashmatch)):this.stream.peekChar(0)===_MUL&&this.stream.peekChar(1)===_EQS?(this.stream.advance(2),this.finishToken(e,TokenType.SubstringOperator)):this.stream.peekChar(0)===_HAT&&this.stream.peekChar(1)===_EQS?(this.stream.advance(2),this.finishToken(e,TokenType.PrefixOperator)):this.stream.peekChar(0)===_DLR&&this.stream.peekChar(1)===_EQS?(this.stream.advance(2),this.finishToken(e,TokenType.SuffixOperator)):(this.stream.nextChar(),this.finishToken(e,TokenType.Delim)))}trivia(){for(;;){const e=this.stream.pos();if(this._whitespace()){if(!this.ignoreWhitespace)return this.finishToken(e,TokenType.Whitespace)}else{if(!this.comment())return null;if(!this.ignoreComment)return this.finishToken(e,TokenType.Comment)}}}comment(){if(this.stream.advanceIfChars([_FSL,_MUL])){let e=!1,t=!1;return this.stream.advanceWhileChar((s=>t&&s===_FSL?(e=!0,!1):(t=s===_MUL,!0))),e&&this.stream.advance(1),!0}return!1}_number(){let e,t=0;return this.stream.peekChar()===_DOT&&(t=1),e=this.stream.peekChar(t),e>=_0&&e<=_9&&(this.stream.advance(t+1),this.stream.advanceWhileChar((e=>e>=_0&&e<=_9||0===t&&e===_DOT)),!0)}_newline(e){const t=this.stream.peekChar();switch(t){case _CAR:case _LFD:case _NWL:return this.stream.advance(1),e.push(String.fromCharCode(t)),t===_CAR&&this.stream.advanceIfChar(_NWL)&&e.push("\n"),!0}return!1}_escape(e,t){let s=this.stream.peekChar();if(s===_BSL){this.stream.advance(1),s=this.stream.peekChar();let i=0;for(;i<6&&(s>=_0&&s<=_9||s>=_a&&s<=_f||s>=_A&&s<=_F);)this.stream.advance(1),s=this.stream.peekChar(),i++;if(i>0){try{const t=parseInt(this.stream.substring(this.stream.pos()-i),16);t&&e.push(String.fromCharCode(t))}catch(e){}return s===_WSP||s===_TAB?this.stream.advance(1):this._newline([]),!0}if(s!==_CAR&&s!==_LFD&&s!==_NWL)return this.stream.advance(1),e.push(String.fromCharCode(s)),!0;if(t)return this._newline(e)}return!1}_stringChar(e,t){const s=this.stream.peekChar();return 0!==s&&s!==e&&s!==_BSL&&s!==_CAR&&s!==_LFD&&s!==_NWL&&(this.stream.advance(1),t.push(String.fromCharCode(s)),!0)}_string(e){if(this.stream.peekChar()===_SQO||this.stream.peekChar()===_DQO){const t=this.stream.nextChar();for(e.push(String.fromCharCode(t));this._stringChar(t,e)||this._escape(e,!0););return this.stream.peekChar()===t?(this.stream.nextChar(),e.push(String.fromCharCode(t)),TokenType.String):TokenType.BadString}return null}_unquotedChar(e){const t=this.stream.peekChar();return 0!==t&&t!==_BSL&&t!==_SQO&&t!==_DQO&&t!==_LPA&&t!==_RPA&&t!==_WSP&&t!==_TAB&&t!==_NWL&&t!==_LFD&&t!==_CAR&&(this.stream.advance(1),e.push(String.fromCharCode(t)),!0)}_unquotedString(e){let t=!1;for(;this._unquotedChar(e)||this._escape(e);)t=!0;return t}_whitespace(){return this.stream.advanceWhileChar((e=>e===_WSP||e===_TAB||e===_NWL||e===_LFD||e===_CAR))>0}_name(e){let t=!1;for(;this._identChar(e)||this._escape(e);)t=!0;return t}ident(e){const t=this.stream.pos();if(this._minus(e)&&this._minus(e)){if(this._identFirstChar(e)||this._escape(e)){for(;this._identChar(e)||this._escape(e););return!0}}else if(this._identFirstChar(e)||this._escape(e)){for(;this._identChar(e)||this._escape(e););return!0}return this.stream.goBackTo(t),!1}_identFirstChar(e){const t=this.stream.peekChar();return(t===_USC||t>=_a&&t<=_z||t>=_A&&t<=_Z||t>=128&&t<=65535)&&(this.stream.advance(1),e.push(String.fromCharCode(t)),!0)}_minus(e){const t=this.stream.peekChar();return t===_MIN&&(this.stream.advance(1),e.push(String.fromCharCode(t)),!0)}_identChar(e){const t=this.stream.peekChar();return(t===_USC||t===_MIN||t>=_a&&t<=_z||t>=_A&&t<=_Z||t>=_0&&t<=_9||t>=128&&t<=65535)&&(this.stream.advance(1),e.push(String.fromCharCode(t)),!0)}}exports.Scanner=Scanner;