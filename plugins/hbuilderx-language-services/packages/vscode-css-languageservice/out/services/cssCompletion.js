"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,s){void 0===s&&(s=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,s,n)}:function(e,t,o,s){void 0===s&&(s=o),e[s]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CSSCompletion=exports.SortTexts=exports.retriggerCommand=exports.SnippetFormat=void 0;const cssLanguageTypes_1=require("../cssLanguageTypes"),cssLanguageExtTypes_1=require("../external/cssLanguageExtTypes"),languageFacts=__importStar(require("../languageFacts/facts")),nodes=__importStar(require("../parser/cssNodes")),cssSymbolScope_1=require("../parser/cssSymbolScope"),strings=__importStar(require("../utils/strings")),nls=__importStar(require("vscode-nls")),styleExtCompletion_1=require("../external/styleExtCompletion"),objects_1=require("../utils/objects"),pathCompletion_1=require("./pathCompletion"),localize=nls.loadMessageBundle();var SortTexts;exports.SnippetFormat=cssLanguageTypes_1.InsertTextFormat.Snippet,exports.retriggerCommand={title:"Suggest",command:"editor.action.triggerSuggest"},function(e){e.Enums=" ",e.Normal="d",e.ThisClass="f",e.ThisId="g",e.Tag="h",e.AtRule="i",e.VendorPrefixed="x",e.Term="y",e.Variable="z",e.Deprecated="zz"}(SortTexts||(exports.SortTexts=SortTexts={}));class CSSCompletion{constructor(e=null,t,o){this.variablePrefix=e,this.lsOptions=t,this.cssDataManager=o,this.completionParticipants=[],this.styleExtCompletion=new styleExtCompletion_1.StyleExtCompletion(new cssLanguageExtTypes_1.Scanner)}configure(e){this.settings=e}getSymbolContext(){return this.symbolContext||(this.symbolContext=new cssSymbolScope_1.Symbols(this.styleSheet)),this.symbolContext}setCompletionParticipants(e){this.completionParticipants=e||[]}async doComplete2(e,t,o,s){if(!this.lsOptions.fileSystemProvider||!this.lsOptions.fileSystemProvider.readDirectory)return this.doComplete(e,t,o);const n=new pathCompletion_1.PathCompletionParticipant(this.lsOptions.fileSystemProvider.readDirectory),i=this.completionParticipants;this.completionParticipants=[n].concat(i);const r=this.doComplete(e,t,o);try{const t=await n.computeCompletions(e,s);return{isIncomplete:r.isIncomplete||t.isIncomplete,items:t.items.concat(r.items)}}finally{this.completionParticipants=i}}doCompleteFromError(){const e={isIncomplete:!1,items:[]},t=this.styleExtCompletion.getNodeFromToken(this.textDocument,this.position);if(!t)return this.finalize(e);const o=t.node;if(!o)return this.finalize(e);const s="css"!==t.scannerType;if(o instanceof nodes.Property)s&&(this.getSimpleCompletionsForSelector(o,s,e),this.getSimpleCompletionForTopLevel(e)),this.getSimpleCompletionsForDeclarationProperty(o.getParent(),e);else if(o instanceof nodes.SimpleSelector)this.getSimpleCompletionsForSelector(o,s,e),this.getSimpleCompletionForTopLevel(e);else{if(!(o instanceof nodes.Declarations))return this.finalize(e);{const s=this.cssDataManager.getProperty(t.propertyName);this.getSimpleCompletionsForDeclarationValue(s,o,e)}}return this.finalize(e)}doComplete(e,t,o){this.offset=e.offsetAt(t),this.position=t,this.currentWord=getCurrentWord(e,this.offset),this.defaultReplaceRange=cssLanguageTypes_1.Range.create(cssLanguageTypes_1.Position.create(this.position.line,this.position.character-this.currentWord.length),this.position),this.textDocument=e,this.styleSheet=o;try{if(this.styleExtCompletion.isErrorStyleSheet(this.offset,this.styleSheet))return this.doCompleteFromError();const e={isIncomplete:!1,items:[]};this.nodePath=nodes.getNodePath(this.styleSheet,this.offset);for(let t=this.nodePath.length-1;t>=0;t--){const o=this.nodePath[t];if(o instanceof nodes.Property)this.getCompletionsForDeclarationProperty(o.getParent(),e);else if(o instanceof nodes.Expression)o.parent instanceof nodes.Interpolation?this.getVariableProposals(null,e):this.getCompletionsForExpression(o,e);else if(o instanceof nodes.SimpleSelector){const t=o.findAParent(nodes.NodeType.ExtendsReference,nodes.NodeType.Ruleset);if(t)if(t.type===nodes.NodeType.ExtendsReference)this.getCompletionsForExtendsReference(t,o,e);else{const o=t;this.getCompletionsForSelector(o,o&&o.isNested(),e)}}else if(o instanceof nodes.FunctionArgument)this.getCompletionsForFunctionArgument(o,o.getParent(),e);else if(o instanceof nodes.Declarations)this.getCompletionsForDeclarations(o,e);else if(o instanceof nodes.VariableDeclaration)this.getCompletionsForVariableDeclaration(o,e);else if(o instanceof nodes.RuleSet)this.getCompletionsForRuleSet(o,e);else if(o instanceof nodes.Interpolation)this.getCompletionsForInterpolation(o,e);else if(o instanceof nodes.FunctionDeclaration)this.getCompletionsForFunctionDeclaration(o,e);else if(o instanceof nodes.MixinReference)this.getCompletionsForMixinReference(o,e);else if(o instanceof nodes.Function)this.getCompletionsForFunctionArgument(null,o,e);else if(o instanceof nodes.Supports)this.getCompletionsForSupports(o,e);else if(o instanceof nodes.SupportsCondition)this.getCompletionsForSupportsCondition(o,e);else if(o instanceof nodes.ExtendsReference)this.getCompletionsForExtendsReference(o,null,e);else if(o.type===nodes.NodeType.URILiteral)this.getCompletionForUriLiteralValue(o,e);else if(null===o.parent)this.getCompletionForTopLevel(e);else{if(o.type!==nodes.NodeType.StringLiteral||!this.isImportPathParent(o.parent.type))continue;this.getCompletionForImportPath(o,e)}if(e.items.length>0||this.offset>o.offset)return this.finalize(e)}return this.getCompletionsForStylesheet(e),0===e.items.length&&this.variablePrefix&&0===this.currentWord.indexOf(this.variablePrefix)&&this.getVariableProposals(null,e),this.finalize(e)}finally{this.position=null,this.currentWord=null,this.textDocument=null,this.styleSheet=null,this.symbolContext=null,this.defaultReplaceRange=null,this.nodePath=null}}isImportPathParent(e){return e===nodes.NodeType.Import}finalize(e){return e}findInNodePath(...e){for(let t=this.nodePath.length-1;t>=0;t--){const o=this.nodePath[t];if(-1!==e.indexOf(o.type))return o}return null}getCompletionsForDeclarationProperty(e,t){return this.getPropertyProposals(e,t)}getPropertyProposals(e,t){const o=this.isTriggerPropertyValueCompletionEnabled,s=this.isCompletePropertyWithSemicolonEnabled;return this.cssDataManager.getProperties().forEach((n=>{let i,r,a=!1;e?(i=this.getCompletionRange(e.getProperty()),r=n.name,(0,objects_1.isDefined)(e.colonPosition)||(r+=": ",a=!0)):(i=this.getCompletionRange(null),r=n.name+": ",a=!0),!e&&s&&(r+="$0;"),e&&!e.semicolonPosition&&s&&this.offset>=this.textDocument.offsetAt(i.end)&&(r+="$0;");const l={label:n.name,documentation:languageFacts.getEntryDescription(n,this.doesSupportMarkdown()),tags:isDeprecated(n)?[cssLanguageTypes_1.CompletionItemTag.Deprecated]:[],textEdit:cssLanguageTypes_1.TextEdit.replace(i,r),insertTextFormat:exports.SnippetFormat,kind:cssLanguageTypes_1.CompletionItemKind.Property,uniPlatform:n.uniPlatform,fromDataProvider:!0};n.restrictions||(a=!1),o&&a&&(l.command=exports.retriggerCommand);const c=getSortText("number"==typeof n.relevance?Math.min(Math.max(n.relevance,0),99):50);l.sortText=c,t.items.push(l)})),this.completionParticipants.forEach((e=>{e.onCssProperty&&e.onCssProperty({propertyName:this.currentWord,range:this.defaultReplaceRange})})),t}get isTriggerPropertyValueCompletionEnabled(){return!this.settings||!this.settings.completion||void 0===this.settings.completion.triggerPropertyValueCompletion||this.settings.completion.triggerPropertyValueCompletion}get isCompletePropertyWithSemicolonEnabled(){return!this.settings||!this.settings.completion||void 0===this.settings.completion.completePropertyWithSemicolon||this.settings.completion.completePropertyWithSemicolon}getCompletionsForDeclarationValue(e,t){const o=e.getFullPropertyName(),s=this.cssDataManager.getProperty(o);let n=e.getValue()||null;for(;n&&n.hasChildren();)n=n.findChildAtOffset(this.offset,!1);if(this.completionParticipants.forEach((e=>{e.onCssPropertyValue&&e.onCssPropertyValue({propertyName:o,propertyValue:this.currentWord,range:this.getCompletionRange(n)})})),s)this.getSimpleCompletionsForDeclarationValue(s,n,t);else{const o=collectValues(this.styleSheet,e);for(const e of o.getEntries())t.items.push({label:e,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(n),e),kind:cssLanguageTypes_1.CompletionItemKind.Value})}return this.getVariableProposals(n,t),this.getTermProposals(s,n,t),t}getValueEnumProposals(e,t,o){if(e.values)for(const s of e.values){let n,i=s.name;if(strings.endsWith(i,")")){const e=i.lastIndexOf("(");-1!==e&&(i=i.substr(0,e)+"($1)",n=exports.SnippetFormat)}let r=SortTexts.Enums;strings.startsWith(s.name,"-")&&(r+=SortTexts.VendorPrefixed);const a={label:s.name,documentation:languageFacts.getEntryDescription(s,this.doesSupportMarkdown()),tags:isDeprecated(e)?[cssLanguageTypes_1.CompletionItemTag.Deprecated]:[],textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),i),sortText:r,kind:cssLanguageTypes_1.CompletionItemKind.Value,insertTextFormat:n,uniPlatform:s.uniPlatform,fromDataProvider:!0};o.items.push(a)}return o}getCSSWideKeywordProposals(e,t,o){for(const e in languageFacts.cssWideKeywords){const s=languageFacts.cssWideKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}for(const e in languageFacts.cssWideFunctions){const s=languageFacts.cssWideFunctions[e],n=moveCursorInsideParenthesis(e);o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),n),kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:exports.SnippetFormat,command:strings.startsWith(e,"var")?exports.retriggerCommand:void 0,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getCompletionsForInterpolation(e,t){return this.offset>=e.offset+2&&this.getVariableProposals(null,t),t}getVariableProposals(e,t){const o=this.getSymbolContext().findSymbolsAtOffset(this.offset,nodes.ReferenceType.Variable);for(const s of o){const o=strings.startsWith(s.name,"--")?`var(${s.name})`:s.name,n={label:s.name,documentation:s.value?strings.getLimitedString(s.value):s.value,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(e),o),kind:cssLanguageTypes_1.CompletionItemKind.Variable,sortText:SortTexts.Variable};if("string"==typeof n.documentation&&isColorString(n.documentation)&&(n.kind=cssLanguageTypes_1.CompletionItemKind.Color),s.node.type===nodes.NodeType.FunctionParameter){const e=s.node.getParent();e.type===nodes.NodeType.MixinDeclaration&&(n.detail=localize("completion.argument","argument from '{0}'",e.getName()))}t.items.push(n)}return t}getVariableProposalsForCSSVarFunction(e){let t=this.getSymbolContext().findSymbolsAtOffset(this.offset,nodes.ReferenceType.Variable);t=t.filter((e=>strings.startsWith(e.name,"--")));for(const o of t){const t={label:o.name,documentation:o.value?strings.getLimitedString(o.value):o.value,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(null),o.name),kind:cssLanguageTypes_1.CompletionItemKind.Variable};"string"==typeof t.documentation&&isColorString(t.documentation)&&(t.kind=cssLanguageTypes_1.CompletionItemKind.Color),e.items.push(t)}return e}getUnitProposals(e,t,o){let s="0";if(this.currentWord.length>0){const e=this.currentWord.match(/^-?\d[\.\d+]*/);e&&(s=e[0],o.isIncomplete=s.length===this.currentWord.length)}else 0===this.currentWord.length&&(o.isIncomplete=!0);if(t&&t.parent&&t.parent.type===nodes.NodeType.Term&&(t=t.getParent()),e.restrictions){const n=[];for(const i of e.restrictions){const e=languageFacts.units[i];if(e){const i=Object.keys(e);for(const r of i){const i=e[r];if(n.includes(r))continue;n.push(r);const a=s+r;o.items.push({label:a,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),a),kind:cssLanguageTypes_1.CompletionItemKind.Unit,uniPlatform:i.uniPlatform,fromDataProvider:!0})}}}}return o}getCompletionRange(e){if(e&&e.offset<=this.offset&&this.offset<=e.end){const t=-1!==e.end?this.textDocument.positionAt(e.end):this.position,o=this.textDocument.positionAt(e.offset);if(o.line===t.line)return cssLanguageTypes_1.Range.create(o,t)}return this.defaultReplaceRange}getColorProposals(e,t,o){for(const e in languageFacts.colors){const s=languageFacts.colors[e];o.items.push({label:s.label,detail:s.detail,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Color})}for(const e in languageFacts.colorKeywords){const s=languageFacts.colorKeywords[e];o.items.push({label:s.label,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}const s=new Set;this.styleSheet.acceptVisitor(new ColorValueCollector(s,this.offset));for(const e of s.getEntries())o.items.push({label:e,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Color});for(const e in languageFacts.colorFunctions){const s=languageFacts.colorFunctions[e];o.items.push({label:s.label,detail:s.detail,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),s.insertText),insertTextFormat:exports.SnippetFormat,kind:cssLanguageTypes_1.CompletionItemKind.Function,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getPositionProposals(e,t,o){for(const e in languageFacts.positionKeywords){const s=languageFacts.positionKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getRepeatStyleProposals(e,t,o){for(const e in languageFacts.repeatStyleKeywords){const s=languageFacts.repeatStyleKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getLineStyleProposals(e,t,o){for(const e in languageFacts.lineStyleKeywords){const s=languageFacts.lineStyleKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getLineWidthProposals(e,t,o){for(const e in languageFacts.lineWidthKeywords){const s=languageFacts.lineWidthKeywords[e];o.items.push({label:e,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getGeometryBoxProposals(e,t,o){for(const e in languageFacts.geometryBoxKeywords){const s=languageFacts.geometryBoxKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getBoxProposals(e,t,o){for(const e in languageFacts.boxKeywords){const s=languageFacts.boxKeywords[e];o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),e),kind:cssLanguageTypes_1.CompletionItemKind.Value,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getImageProposals(e,t,o){for(const e in languageFacts.imageFunctions){const s=languageFacts.imageFunctions[e],n=moveCursorInsideParenthesis(e);o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),n),kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:e!==n?exports.SnippetFormat:void 0,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getTimingFunctionProposals(e,t,o){for(const e in languageFacts.transitionTimingFunctions){const s=languageFacts.transitionTimingFunctions[e],n=moveCursorInsideParenthesis(e);o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),n),kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:e!==n?exports.SnippetFormat:void 0,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getBasicShapeProposals(e,t,o){for(const e in languageFacts.basicShapeFunctions){const s=languageFacts.basicShapeFunctions[e],n=moveCursorInsideParenthesis(e);o.items.push({label:e,documentation:s.documentation,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(t),n),kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:e!==n?exports.SnippetFormat:void 0,uniPlatform:s.uniPlatform,fromDataProvider:!0})}return o}getCompletionsForStylesheet(e){const t=this.styleSheet.findFirstChildBeforeOffset(this.offset);return t?t instanceof nodes.RuleSet?this.getCompletionsForRuleSet(t,e):t instanceof nodes.Supports?this.getCompletionsForSupports(t,e):e:this.getCompletionForTopLevel(e)}getCompletionForTopLevel(e){return this.getSimpleCompletionForTopLevel(e),this.getCompletionsForSelector(null,!1,e),e}getCompletionsForRuleSet(e,t){const o=e.getDeclarations();if(o&&o.endsWith("}")&&this.offset>=o.end)return this.getCompletionForTopLevel(t);return!o||this.offset<=o.offset?this.getCompletionsForSelector(e,e.isNested(),t):this.getCompletionsForDeclarations(e.getDeclarations(),t)}getCompletionsForSelector(e,t,o){const s=this.findInNodePath(nodes.NodeType.PseudoSelector,nodes.NodeType.IdentifierSelector,nodes.NodeType.ClassSelector,nodes.NodeType.ElementNameSelector);!s&&this.hasCharacterAtPosition(this.offset-this.currentWord.length-1,":")&&(this.currentWord=":"+this.currentWord,this.hasCharacterAtPosition(this.offset-this.currentWord.length-1,":")&&(this.currentWord=":"+this.currentWord),this.defaultReplaceRange=cssLanguageTypes_1.Range.create(cssLanguageTypes_1.Position.create(this.position.line,this.position.character-this.currentWord.length),this.position)),this.getSimpleCompletionsForSelector(s,t,o);const n={};n[this.currentWord]=!0;const i=this.textDocument.getText();if(this.styleSheet.accept((e=>{if(e.type===nodes.NodeType.SimpleSelector&&e.length>0){const t=i.substr(e.offset,e.length);if("."===t.charAt(0)&&!n[t]){n[t]=!0;const e=getSortText(50,SortTexts.ThisClass);o.items.push({label:t,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(s),t),kind:cssLanguageTypes_1.CompletionItemKind.Keyword,sortText:e})}return!1}return!0})),e&&e.isNested()){const t=e.getSelectors().findFirstChildBeforeOffset(this.offset);t&&0===e.getSelectors().getChildren().indexOf(t)&&this.getPropertyProposals(null,o)}return o}getCompletionsForDeclarations(e,t){if(!e||this.offset===e.offset)return t;const o=e.findFirstChildBeforeOffset(this.offset);if(!o)return this.getCompletionsForDeclarationProperty(null,t);if(o instanceof nodes.AbstractDeclaration){const e=o;if(!(0,objects_1.isDefined)(e.colonPosition)||this.offset<=e.colonPosition)return this.getCompletionsForDeclarationProperty(e,t);if((0,objects_1.isDefined)(e.semicolonPosition)&&e.semicolonPosition<this.offset)return this.offset===e.semicolonPosition+1?t:this.getCompletionsForDeclarationProperty(null,t);if(e instanceof nodes.Declaration)return this.getCompletionsForDeclarationValue(e,t)}else o instanceof nodes.ExtendsReference?this.getCompletionsForExtendsReference(o,null,t):(this.currentWord&&"@"===this.currentWord[0]||o instanceof nodes.RuleSet)&&this.getCompletionsForDeclarationProperty(null,t);return t}getCompletionsForVariableDeclaration(e,t){return this.offset&&(0,objects_1.isDefined)(e.colonPosition)&&this.offset>e.colonPosition&&this.getVariableProposals(e.getValue(),t),t}getCompletionsForExpression(e,t){const o=e.getParent();if(o instanceof nodes.FunctionArgument)return this.getCompletionsForFunctionArgument(o,o.getParent(),t),t;const s=e.findParent(nodes.NodeType.Declaration);if(!s)return this.getTermProposals(void 0,null,t),t;const n=e.findChildAtOffset(this.offset,!0);return n?n instanceof nodes.NumericValue||n instanceof nodes.Identifier?this.getCompletionsForDeclarationValue(s,t):t:this.getCompletionsForDeclarationValue(s,t)}getCompletionsForFunctionArgument(e,t,o){const s=t.getIdentifier();return s&&s.matches("var")&&(t.getArguments().hasChildren()&&t.getArguments().getChild(0)!==e||this.getVariableProposalsForCSSVarFunction(o)),o}getCompletionsForFunctionDeclaration(e,t){const o=e.getDeclarations();return o&&this.offset>o.offset&&this.offset<o.end&&this.getTermProposals(void 0,null,t),t}getCompletionsForMixinReference(e,t){const o=this.getSymbolContext().findSymbolsAtOffset(this.offset,nodes.ReferenceType.Mixin);for(const e of o)e.node instanceof nodes.MixinDeclaration&&t.items.push(this.makeTermProposal(e,e.node.getParameters(),null));const s=e.getIdentifier()||null;return this.completionParticipants.forEach((e=>{e.onCssMixinReference&&e.onCssMixinReference({mixinName:this.currentWord,range:this.getCompletionRange(s)})})),t}getTermProposals(e,t,o){const s=this.getSymbolContext().findSymbolsAtOffset(this.offset,nodes.ReferenceType.Function);for(const e of s)e.node instanceof nodes.FunctionDeclaration&&o.items.push(this.makeTermProposal(e,e.node.getParameters(),t));return o}makeTermProposal(e,t,o){e.node;const s=t.getChildren().map((e=>e instanceof nodes.FunctionParameter?e.getName():e.getText())),n=e.name+"("+s.map(((e,t)=>"${"+(t+1)+":"+e+"}")).join(", ")+")";return{label:e.name,detail:e.name+"("+s.join(", ")+")",textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(o),n),insertTextFormat:exports.SnippetFormat,kind:cssLanguageTypes_1.CompletionItemKind.Function,sortText:SortTexts.Term}}getCompletionsForSupportsCondition(e,t){const o=e.findFirstChildBeforeOffset(this.offset);if(o){if(o instanceof nodes.Declaration)return!(0,objects_1.isDefined)(o.colonPosition)||this.offset<=o.colonPosition?this.getCompletionsForDeclarationProperty(o,t):this.getCompletionsForDeclarationValue(o,t);if(o instanceof nodes.SupportsCondition)return this.getCompletionsForSupportsCondition(o,t)}return(0,objects_1.isDefined)(e.lParent)&&this.offset>e.lParent&&(!(0,objects_1.isDefined)(e.rParent)||this.offset<=e.rParent)?this.getCompletionsForDeclarationProperty(null,t):t}getCompletionsForSupports(e,t){const o=e.getDeclarations();if(!o||this.offset<=o.offset){const o=e.findFirstChildBeforeOffset(this.offset);return o instanceof nodes.SupportsCondition?this.getCompletionsForSupportsCondition(o,t):t}return this.getCompletionForTopLevel(t)}getCompletionsForExtendsReference(e,t,o){return o}getCompletionForUriLiteralValue(e,t){let o,s,n;if(e.hasChildren()){const t=e.getChild(0);o=t.getText(),s=this.position,n=this.getCompletionRange(t)}else{o="",s=this.position;const t=this.textDocument.positionAt(e.offset+"url(".length);n=cssLanguageTypes_1.Range.create(t,t)}return this.completionParticipants.forEach((e=>{e.onCssURILiteralValue&&e.onCssURILiteralValue({uriValue:o,position:s,range:n})})),t}getCompletionForImportPath(e,t){return this.completionParticipants.forEach((t=>{t.onCssImportPath&&t.onCssImportPath({pathValue:e.getText(),position:this.position,range:this.getCompletionRange(e)})})),t}hasCharacterAtPosition(e,t){const o=this.textDocument.getText();return e>=0&&e<o.length&&o.charAt(e)===t}doesSupportMarkdown(){var e,t,o;if(!(0,objects_1.isDefined)(this.supportsMarkdown)){if(!(0,objects_1.isDefined)(this.lsOptions.clientCapabilities))return this.supportsMarkdown=!0,this.supportsMarkdown;const s=null===(o=null===(t=null===(e=this.lsOptions.clientCapabilities.textDocument)||void 0===e?void 0:e.completion)||void 0===t?void 0:t.completionItem)||void 0===o?void 0:o.documentationFormat;this.supportsMarkdown=Array.isArray(s)&&-1!==s.indexOf(cssLanguageTypes_1.MarkupKind.Markdown)}return this.supportsMarkdown}getSimpleCompletionsForDeclarationProperty(e,t){return this.getPropertyProposals(e,t)}getSimpleCompletionsForSelector(e,t,o){this.cssDataManager.getPseudoClasses().forEach((t=>{const s=moveCursorInsideParenthesis(t.name),n={label:t.name,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(e),s),documentation:languageFacts.getEntryDescription(t,this.doesSupportMarkdown()),tags:isDeprecated(t)?[cssLanguageTypes_1.CompletionItemTag.Deprecated]:[],kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:t.name!==s?exports.SnippetFormat:void 0,uniPlatform:t.uniPlatform,fromDataProvider:!0};let i=SortTexts.Normal;if(strings.startsWith(t.name,":")){i=SortTexts.VendorPrefixed,strings.startsWith(t.name,":-")&&(i=SortTexts.Deprecated);const e=getSortText(51,i);n.sortText=e}o.items.push(n)}));if(this.cssDataManager.getPseudoElements().forEach((t=>{const s=moveCursorInsideParenthesis(t.name),n={label:t.name,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(e),s),documentation:languageFacts.getEntryDescription(t,this.doesSupportMarkdown()),tags:isDeprecated(t)?[cssLanguageTypes_1.CompletionItemTag.Deprecated]:[],kind:cssLanguageTypes_1.CompletionItemKind.Function,insertTextFormat:t.name!==s?exports.SnippetFormat:void 0,uniPlatform:t.uniPlatform,fromDataProvider:!0};let i=SortTexts.Normal;if(strings.startsWith(t.name,"::")){i=SortTexts.VendorPrefixed,strings.startsWith(t.name,"::-")&&(i=SortTexts.Deprecated);const e=getSortText(50,i);n.sortText=e}o.items.push(n)})),!t){for(const t in languageFacts.html5Tags){const s=languageFacts.html5Tags[t],n=getSortText(51,SortTexts.Tag);o.items.push({label:t,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(e),t),kind:cssLanguageTypes_1.CompletionItemKind.Keyword,sortText:n,uniPlatform:s.uniPlatform,fromDataProvider:!0})}for(const t in languageFacts.svgElements){const s=languageFacts.svgElements[t],n=getSortText(50,SortTexts.Tag);o.items.push({label:t,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(e),t),kind:cssLanguageTypes_1.CompletionItemKind.Keyword,sortText:n,uniPlatform:s.uniPlatform,fromDataProvider:!0})}}return o}getSimpleCompletionsForDeclarationValue(e,t,o){if(e){if(e.restrictions)for(const s of e.restrictions)switch(s){case"color":this.getColorProposals(e,t,o);break;case"position":this.getPositionProposals(e,t,o);break;case"repeat":this.getRepeatStyleProposals(e,t,o);break;case"line-style":this.getLineStyleProposals(e,t,o);break;case"line-width":this.getLineWidthProposals(e,t,o);break;case"geometry-box":this.getGeometryBoxProposals(e,t,o);break;case"box":this.getBoxProposals(e,t,o);break;case"image":this.getImageProposals(e,t,o);break;case"timing-function":this.getTimingFunctionProposals(e,t,o);break;case"shape":this.getBasicShapeProposals(e,t,o)}return this.getValueEnumProposals(e,t,o),this.getCSSWideKeywordProposals(e,t,o),this.getUnitProposals(e,t,o),o}}getSimpleCompletionForTopLevel(e){return this.cssDataManager.getAtDirectives().forEach((t=>{const o=getSortText(51,SortTexts.AtRule);e.items.push({label:t.name,textEdit:cssLanguageTypes_1.TextEdit.replace(this.getCompletionRange(null),t.name),documentation:languageFacts.getEntryDescription(t,this.doesSupportMarkdown()),tags:isDeprecated(t)?[cssLanguageTypes_1.CompletionItemTag.Deprecated]:[],kind:cssLanguageTypes_1.CompletionItemKind.Keyword,sortText:o,uniPlatform:t.uniPlatform,fromDataProvider:!0})})),e}}function isDeprecated(e){return!(!e.status||"nonstandard"!==e.status&&"obsolete"!==e.status)}function computeRankNumber(e){const t=e.toString();switch(t.length){case 4:return t;case 3:return"0"+t;case 2:return"00"+t;case 1:return"000"+t;default:return"0000"}}exports.CSSCompletion=CSSCompletion;class Set{constructor(){this.entries={}}add(e){this.entries[e]=!0}getEntries(){return Object.keys(this.entries)}}function moveCursorInsideParenthesis(e){return e.replace(/\(\)$/,"($1)")}function collectValues(e,t){const o=t.getFullPropertyName(),s=new Set;function n(e){return(e instanceof nodes.Identifier||e instanceof nodes.NumericValue||e instanceof nodes.HexColorValue)&&s.add(e.getText()),!0}return e.accept((function(e){if(e instanceof nodes.Declaration&&e!==t&&function(e){const t=e.getFullPropertyName();return o===t}(e)){const t=e.getValue();t&&t.accept(n)}return!0})),s}class ColorValueCollector{constructor(e,t){this.entries=e,this.currentOffset=t}visitNode(e){return(e instanceof nodes.HexColorValue||e instanceof nodes.Function&&languageFacts.isColorConstructor(e))&&(this.currentOffset<e.offset||e.end<this.currentOffset)&&this.entries.add(e.getText()),!0}}function getCurrentWord(e,t){let o=t-1;const s=e.getText();for(;o>=0&&-1===' \t\n\r":{[()]},*>+'.indexOf(s.charAt(o));)o--;return s.substring(o+1,t)}function isColorString(e){return e.toLowerCase()in languageFacts.colors||/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)}function getSortText(e=50,t=SortTexts.Normal){return t+"_"+(255-Math.min(Math.max(e,0),99)).toString(16)}