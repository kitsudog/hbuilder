"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CSSCodeActions=void 0;const nodes=__importStar(require("../parser/cssNodes")),strings_1=require("../utils/strings"),lintRules_1=require("../services/lintRules"),cssLanguageTypes_1=require("../cssLanguageTypes"),nls=__importStar(require("vscode-nls")),localize=nls.loadMessageBundle();class CSSCodeActions{constructor(e){this.cssDataManager=e}doCodeActions(e,t,s,r){return this.doCodeActions2(e,t,s,r).map((t=>{const s=t.edit&&t.edit.documentChanges&&t.edit.documentChanges[0];return cssLanguageTypes_1.Command.create(t.title,"_css.applyCodeAction",e.uri,e.version,s&&s.edits)}))}doCodeActions2(e,t,s,r){const n=[];if(s.diagnostics)for(const t of s.diagnostics)this.appendFixesForMarker(e,r,t,n);return n}getFixesForUnknownProperty(e,t,s,r){const n=t.getName(),o=[];this.cssDataManager.getProperties().forEach((e=>{const t=(0,strings_1.difference)(n,e.name);t>=n.length/2&&o.push({property:e.name,score:t})})),o.sort(((e,t)=>t.score-e.score||e.property.localeCompare(t.property)));let i=3;for(const t of o){const n=t.property,o=localize("css.codeaction.rename","Rename to '{0}'",n),a=cssLanguageTypes_1.TextEdit.replace(s.range,n),c=cssLanguageTypes_1.VersionedTextDocumentIdentifier.create(e.uri,e.version),d={documentChanges:[cssLanguageTypes_1.TextDocumentEdit.create(c,[a])]},u=cssLanguageTypes_1.CodeAction.create(o,d,cssLanguageTypes_1.CodeActionKind.QuickFix);if(u.diagnostics=[s],r.push(u),--i<=0)return}}appendFixesForMarker(e,t,s,r){if(s.code!==lintRules_1.Rules.UnknownProperty.id)return;const n=e.offsetAt(s.range.start),o=e.offsetAt(s.range.end),i=nodes.getNodePath(t,n);for(let t=i.length-1;t>=0;t--){const a=i[t];if(a instanceof nodes.Declaration){const t=a.getProperty();if(t&&t.offset===n&&t.end===o)return void this.getFixesForUnknownProperty(e,t,s,r)}}}}exports.CSSCodeActions=CSSCodeActions;