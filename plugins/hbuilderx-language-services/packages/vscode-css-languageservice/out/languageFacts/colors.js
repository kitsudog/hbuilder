"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t);var n=Object.getOwnPropertyDescriptor(r,t);n&&!("get"in n?!r.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,n)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getColorValue=exports.hslFromColor=exports.colorFromHSL=exports.colorFrom256RGB=exports.colorFromHex=exports.hexDigit=exports.isColorValue=exports.isColorConstructor=exports.hexColors=exports.colors=exports.colorKeywords=exports.colorFunctions=void 0;const nodes=__importStar(require("../parser/cssNodes")),nls=__importStar(require("vscode-nls")),localize=nls.loadMessageBundle(),extBuiltinData_1=require("./extBuiltinData");function getNumericValue(e,r){const t=e.getText().match(/^([-+]?[0-9]*\.?[0-9]+)(%?)$/);if(t){t[2]&&(r=100);const e=parseFloat(t[1])/r;if(e>=0&&e<=1)return e}throw new Error}function getAngle(e){const r=e.getText();if(r.match(/^([-+]?[0-9]*\.?[0-9]+)(deg)?$/))return parseFloat(r)%360;throw new Error}function isColorConstructor(e){const r=e.getName();return!!r&&/^(rgb|rgba|hsl|hsla)$/gi.test(r)}function isColorValue(e){if(e.type===nodes.NodeType.HexColorValue)return!0;if(e.type===nodes.NodeType.Function)return isColorConstructor(e);if(e.type===nodes.NodeType.Identifier){if(e.parent&&e.parent.type!==nodes.NodeType.Term)return!1;const r=e.getText().toLowerCase();if("none"===r)return!1;if(exports.colors[r])return!0}return!1}exports.colorFunctions=extBuiltinData_1.PrivateColor.parseExtData("colorFunctions"),exports.colorKeywords=extBuiltinData_1.PrivateColor.parseExtData("colorKeywords"),exports.colors=extBuiltinData_1.PrivateColor.parseExtData("colors"),exports.hexColors=extBuiltinData_1.PrivateColor.parseExtData("hexColors"),exports.isColorConstructor=isColorConstructor,exports.isColorValue=isColorValue;const Digit0=48,Digit9=57,A=65,F=70,a=97,f=102;function hexDigit(e){return e<48?0:e<=57?e-48:(e<a&&(e+=32),e>=a&&e<=f?e-a+10:0)}function colorFromHex(e){if("#"!==e[0])return null;switch(e.length){case 4:return{red:17*hexDigit(e.charCodeAt(1))/255,green:17*hexDigit(e.charCodeAt(2))/255,blue:17*hexDigit(e.charCodeAt(3))/255,alpha:1};case 5:return{red:17*hexDigit(e.charCodeAt(1))/255,green:17*hexDigit(e.charCodeAt(2))/255,blue:17*hexDigit(e.charCodeAt(3))/255,alpha:17*hexDigit(e.charCodeAt(4))/255};case 7:return{red:(16*hexDigit(e.charCodeAt(1))+hexDigit(e.charCodeAt(2)))/255,green:(16*hexDigit(e.charCodeAt(3))+hexDigit(e.charCodeAt(4)))/255,blue:(16*hexDigit(e.charCodeAt(5))+hexDigit(e.charCodeAt(6)))/255,alpha:1};case 9:return{red:(16*hexDigit(e.charCodeAt(1))+hexDigit(e.charCodeAt(2)))/255,green:(16*hexDigit(e.charCodeAt(3))+hexDigit(e.charCodeAt(4)))/255,blue:(16*hexDigit(e.charCodeAt(5))+hexDigit(e.charCodeAt(6)))/255,alpha:(16*hexDigit(e.charCodeAt(7))+hexDigit(e.charCodeAt(8)))/255}}return null}function colorFrom256RGB(e,r,t,o=1){return{red:e/255,green:r/255,blue:t/255,alpha:o}}function colorFromHSL(e,r,t,o=1){if(0===r)return{red:t,green:t,blue:t,alpha:o};{const n=(e,r,t)=>{for(;t<0;)t+=6;for(;t>=6;)t-=6;return t<1?(r-e)*t+e:t<3?r:t<4?(r-e)*(4-t)+e:e},i=t<=.5?t*(r+1):t+r-t*r,a=2*t-i;return{red:n(a,i,(e/=60)+2),green:n(a,i,e),blue:n(a,i,e-2),alpha:o}}}function hslFromColor(e){const r=e.red,t=e.green,o=e.blue,n=e.alpha,i=Math.max(r,t,o),a=Math.min(r,t,o);let l=0,s=0;const u=(a+i)/2,c=i-a;if(c>0){switch(s=Math.min(u<=.5?c/(2*u):c/(2-2*u),1),i){case r:l=(t-o)/c+(t<o?6:0);break;case t:l=(o-r)/c+2;break;case o:l=(r-t)/c+4}l*=60,l=Math.round(l)}return{h:l,s:s,l:u,a:n}}function getColorValue(e){var r;if(e.type===nodes.NodeType.HexColorValue){return colorFromHex(e.getText())}if(e.type===nodes.NodeType.Function){const r=e,t=r.getName(),o=r.getArguments().getChildren();if(!t||o.length<3||o.length>4)return null;try{const e=4===o.length?getNumericValue(o[3],1):1;if("rgb"===t||"rgba"===t)return{red:getNumericValue(o[0],255),green:getNumericValue(o[1],255),blue:getNumericValue(o[2],255),alpha:e};if("hsl"===t||"hsla"===t){const r=getAngle(o[0]),t=getNumericValue(o[1],100);return colorFromHSL(r,t,getNumericValue(o[2],100),e)}}catch(e){return null}}else if(e.type===nodes.NodeType.Identifier){if(e.parent&&e.parent.type!==nodes.NodeType.Term)return null;const t=e.parent;if(t&&t.parent&&t.parent.type===nodes.NodeType.BinaryExpression){const e=t.parent;if(e.parent&&e.parent.type===nodes.NodeType.ListEntry&&e.parent.key===e)return null}const o=e.getText().toLowerCase();if("none"===o)return null;const n=null===(r=exports.colors[o])||void 0===r?void 0:r.detail;if(n)return colorFromHex(n)}return null}exports.hexDigit=hexDigit,exports.colorFromHex=colorFromHex,exports.colorFrom256RGB=colorFrom256RGB,exports.colorFromHSL=colorFromHSL,exports.hslFromColor=hslFromColor,exports.getColorValue=getColorValue;