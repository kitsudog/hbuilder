"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MergeDataProvider=void 0;const coreData_1=require("./coreData");class MergeDataProvider{constructor(e,r,s){this._project=e,this._i18nData=r,this._providers=s,this._properties=[],this._atDirectives=[],this._pseudoClasses=[],this._pseudoElements=[],this._providers=s.filter((r=>r.enable(e))),1===this._providers.length&&(this._properties=this._providers[0].data.provideProperties(),this._atDirectives=this._providers[0].data.provideAtDirectives(),this._pseudoClasses=this._providers[0].data.providePseudoClasses(),this._pseudoElements=this._providers[0].data.providePseudoElements())}provideData(e,r,s){return 0===this[r].length&&this.mergeData(e,r,s),this[r]}i18nTranslate(e){let r="";(0,coreData_1.isUniAppXProject)(this._project)&&(r="uniappx."),e.forEach((e=>{if(e.i18nKey){let s=this._i18nData[`${r}${e.i18nKey}`];s||(s=this._i18nData[`${e.i18nKey}`]),s&&(e.description=s)}if(e.values){e.values.forEach((e=>{if(e.i18nKey){let s=this._i18nData[`${r}${e.i18nKey}`];s||(s=this._i18nData[`${e.i18nKey}`]),s&&(e.description=s)}}))}}))}provideProperties(){const e=this.provideData("provideProperties","_properties","mergeProperties");return this.i18nTranslate(e),e}provideAtDirectives(){const e=this.provideData("provideAtDirectives","_atDirectives","mergeAtDirectives");return this.i18nTranslate(e),e}providePseudoClasses(){const e=this.provideData("providePseudoClasses","_pseudoClasses","mergePseudoClasses");return this.i18nTranslate(e),e}providePseudoElements(){const e=this.provideData("providePseudoElements","_pseudoElements","mergePseudoElements");return this.i18nTranslate(e),e}getMargeInfo(e,r){for(let s=0;s<r.length;s++){if(r[s].name===e)return{needMarge:!0,index:s}}return{needMarge:!1,index:0}}mergeArray(e=[],r=[]){return Array.from(new Set([...e,...r]))}mergeReferences(e=[],r=[]){return[...e,...r]}mergeValues(e=[],r=[]){return r.forEach((r=>{var s,t,i;const n=e.findIndex((e=>e.name===r.name));if(-1!==n){const o=e[n];o.description=null!==(s=r.description)&&void 0!==s?s:o.description,o.status=null!==(t=r.status)&&void 0!==t?t:o.status,o.browsers=this.mergeArray(o.browsers,r.browsers),0===o.browsers.length&&delete o.browsers,o.references=this.mergeReferences(o.references,r.references),0===o.references.length&&delete o.references,o.uniPlatform=null!==(i=r.uniPlatform)&&void 0!==i?i:o.uniPlatform}else e.push(r)})),e}mergeProperties(e,r){var s,t,i,n,o;return e.description=null!==(s=r.description)&&void 0!==s?s:e.description,e.relevance=null!==(t=r.relevance)&&void 0!==t?t:e.relevance,e.status=null!==(i=r.status)&&void 0!==i?i:e.status,e.syntax=null!==(n=r.syntax)&&void 0!==n?n:e.syntax,e.uniPlatform=null!==(o=r.uniPlatform)&&void 0!==o?o:e.uniPlatform,e.browsers=this.mergeArray(e.browsers,r.browsers),0===e.browsers.length&&delete e.browsers,e.restrictions=this.mergeArray(e.restrictions,r.restrictions),0===e.restrictions.length&&delete e.restrictions,e.references=this.mergeReferences(e.references,r.references),0===e.references.length&&delete e.references,e.values=this.mergeValues(e.values,r.values),0===e.values.length&&delete e.values,e}mergeAtDirectives(e,r){var s,t;return e.description=null!==(s=r.description)&&void 0!==s?s:e.description,e.status=null!==(t=r.status)&&void 0!==t?t:e.status,e.browsers=this.mergeArray(e.browsers,r.browsers),e.references=this.mergeReferences(e.references,r.references),e}mergePseudoClasses(e,r){var s,t;return e.description=null!==(s=r.description)&&void 0!==s?s:e.description,e.status=null!==(t=r.status)&&void 0!==t?t:e.status,e.browsers=this.mergeArray(e.browsers,r.browsers),e.references=this.mergeReferences(e.references,r.references),e}mergePseudoElements(e,r){var s,t;return e.description=null!==(s=r.description)&&void 0!==s?s:e.description,e.status=null!==(t=r.status)&&void 0!==t?t:e.status,e.browsers=this.mergeArray(e.browsers,r.browsers),e.references=this.mergeReferences(e.references,r.references),e}mergeData(e,r,s){const t=this._providers,i=this[r],n=this[s].bind(this),o=this.getMargeInfo.bind(this);for(const r of t){const s=r.data[e]();if(0===s.length)return;for(const e of s){const r=o(e.name,i);r.needMarge?i[r.index]=n(i[r.index],e):i.push(e)}}}}exports.MergeDataProvider=MergeDataProvider;