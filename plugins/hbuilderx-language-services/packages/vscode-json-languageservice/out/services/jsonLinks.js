"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findLinks=void 0;const jsonLanguageTypes_1=require("../jsonLanguageTypes");function findLinks(e,n){const t=[];return n.visit((r=>{var o;if("property"===r.type&&"$ref"===r.keyNode.value&&"string"===(null===(o=r.valueNode)||void 0===o?void 0:o.type)){const o=r.valueNode.value,i=findTargetNode(n,o);if(i){const n=e.positionAt(i.offset);t.push({target:`${e.uri}#${n.line+1},${n.character+1}`,range:createRange(e,r.valueNode)})}}return!0})),Promise.resolve(t)}function createRange(e,n){return jsonLanguageTypes_1.Range.create(e.positionAt(n.offset+1),e.positionAt(n.offset+n.length-1))}function findTargetNode(e,n){const t=parseJSONPointer(n);return t?findNode(t,e.root):null}function findNode(e,n){if(!n)return null;if(0===e.length)return n;const t=e.shift();if(n&&"object"===n.type){const r=n.properties.find((e=>e.keyNode.value===t));return r?findNode(e,r.valueNode):null}if(n&&"array"===n.type&&t.match(/^(0|[1-9][0-9]*)$/)){const r=Number.parseInt(t),o=n.items[r];return o?findNode(e,o):null}return null}function parseJSONPointer(e){return"#"===e?[]:"#"!==e[0]||"/"!==e[1]?null:e.substring(2).split(/\//).map(unescape)}function unescape(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}exports.findLinks=findLinks;