"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createRefFileRefData=void 0;const fs=__importStar(require("fs")),path=__importStar(require("path")),tsserverlibrary_1=__importDefault(require("typescript/lib/tsserverlibrary")),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../../core");function normalizeRefUri(e){if(!e.includes(".")){let t=e+".vue";fs.existsSync(t)&&(e=t),t=e+".nvue",fs.existsSync(t)&&(e=t),t=e+".uvue",fs.existsSync(t)&&(e=t)}if(e.match(/(.*)\.(.+)\?(.*)/)){const t=e.indexOf("?");e=e.substring(0,t)}return e}function createdRefIndexValue(e,t,r,i,o,n,s){var a;const u=(0,core_1.noTsToNormalizedPath)(s);if(!u)return;let c="";const l=path.dirname(u);if(n.startsWith("@/")){let t=vscode_uri_1.URI.parse(e).fsPath;const r=path.resolve(t,"src");fs.existsSync(r)&&(t=r),c=n.replace("@",t)}else c=path.isAbsolute(n)?n:path.resolve(l,n);if(c=c.replace(/\\/g,"/"),c=normalizeRefUri(c),!fs.existsSync(c))return;const f=t.positionAt(i.pos),_=t.positionAt(i.end),d=vscode_languageserver_protocol_1.Range.create(f,_),p=(0,core_1.getContextLineText)(t,d),v=o.importClause,g=null===(a=null==v?void 0:v.name)||void 0===a?void 0:a.escapedText,h=core_1.targetUtils.indexGetTarget(t,d,r);return{value:c,lineText:p,kind:core_1.IndexItemType.REF,range:d,context:n,describe:g,platforms:h}}function createRefFileRefData(e,t,r,i,o){const n=tsserverlibrary_1.default.isStringLiteral(i),s=tsserverlibrary_1.default.isImportDeclaration(o);if(!n||!s)return;const a=i.text;let u=r.sourceDocument;u||(u=t);const c=createdRefIndexValue(e,t,r,i,o,a,u.uri);if(!c)return;const l=[];return l.push(c),l}exports.createRefFileRefData=createRefFileRefData;