"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createVuePageJumpData=void 0;const fs=__importStar(require("fs")),path=__importStar(require("path")),tsserverlibrary_1=__importDefault(require("typescript/lib/tsserverlibrary")),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../../core");function getAbsolutePath(e,t){const r=t.split("?")[0],a=(0,core_1.noTsToNormalizedPath)(e);if(!a)return;let n="";if(r.startsWith("@/")){let t=vscode_uri_1.URI.parse(e).fsPath;const a=path.resolve(t,"src");fs.existsSync(a)&&(t=a),n=r.replace("@",t)}else path.isAbsolute(r)&&r.startsWith("/")&&(n=a+r);n=n.replace(/\\/g,"/");const i=[];return["vue","nvue","uvue"].forEach((e=>{const t=`${n}.${e}`;fs.existsSync(t)&&i.push(t)})),i}function createdVuexIndexValue(e,t,r,a,n){const i=a.name;if(!tsserverlibrary_1.default.isIdentifier(i))return;if("url"!==i.escapedText)return;const u=a.initializer;if(!tsserverlibrary_1.default.isStringLiteral(u))return;const s=u,o=getAbsolutePath(e,s.text);if(!o||0===o.length)return;const c=t.positionAt(s.pos),l=t.positionAt(s.end),p=vscode_languageserver_protocol_1.Range.create(c,l),f=(0,core_1.getContextLineText)(t,p),d=core_1.targetUtils.indexGetTarget(t,p,r),_=[];return o.forEach((e=>{const t={value:e,lineText:f,kind:core_1.IndexItemType.DEF,range:p,context:n,platforms:d};_.push(t)})),_}function createVuexFunctionData(e,t,r,a,n,i,u){const s=tsserverlibrary_1.default.isPropertyAccessExpression(a),o=tsserverlibrary_1.default.isCallExpression(n);if(!s||!o)return;const c=a,l=n;if(!tsserverlibrary_1.default.isPropertyAccessExpression(l.expression))return;const p=l.expression,f=c.name.escapedText,d=p.name.escapedText;if(f!==i)return;if(d!==i)return;if(1!==l.arguments.length)return;const _=l.arguments[0];if(!tsserverlibrary_1.default.isObjectLiteralExpression(_))return;const g=[];return _.properties.forEach((a=>{if(!tsserverlibrary_1.default.isPropertyAssignment(a))return;const n=createdVuexIndexValue(e,t,r,a,u);n&&g.push(...n)})),g}function createNavigateToData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"navigateTo","navigateTo")}function createRedirectToData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"redirectTo","redirectTo")}function createReLaunchData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"reLaunch","reLaunch")}function createSwitchTabData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"switchTab","switchTab")}function createPreloadPageData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"preloadPage","preloadPage")}function createUnPreloadPageData(e,t,r,a,n){return createVuexFunctionData(e,t,r,a,n,"unPreloadPage","unPreloadPage")}function createVuePageJumpData(e,t,r,a,n){const i=createNavigateToData(e,t,r,a,n),u=createRedirectToData(e,t,r,a,n),s=createReLaunchData(e,t,r,a,n),o=createSwitchTabData(e,t,r,a,n),c=createPreloadPageData(e,t,r,a,n),l=createUnPreloadPageData(e,t,r,a,n),p=[];return i&&p.push(...i),u&&p.push(...u),s&&p.push(...s),o&&p.push(...o),c&&p.push(...c),l&&p.push(...l),p}exports.createVuePageJumpData=createVuePageJumpData;