"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const core_1=require("../../../../core"),handlerType_1=require("../handlerType"),URIHandler_1=require("./URIHandler"),URIType_1=require("./URIType");class MarkdownHandler extends URIHandler_1.default{constructor(e,t){super(e,t)}async doCompleteAsync(e,t,r,n,o){let a=r.project.fsPath,l=r.project.sourceRoot,i=(0,core_1.getContextData)(e,e.offsetAt(t),"\r\n");if(!new RegExp(/\[[\s\S]*\]\(/g).test(i.context))return[];const s=i.leftText.indexOf("(")+1,c=i.leftText.slice(s,i.leftText.length),d={range:{start:{line:i.contextRange.start.line,character:s},end:{line:i.contextRange.end.line,character:i.leftText.length-1}},kind:handlerType_1.StringLocationInfoKind.IN_JSON_LIKE,ast:void 0,project:r.project};if(n.get(handlerType_1.LanguageServiceType.TS)&&(o=(0,URIHandler_1.sortProcessing)(o,i.contextRange)),d.project.kind!==core_1.HXProjectKind.UniApp&&d.project.kind!==core_1.HXProjectKind.UniApp_Cli&&i.context.startsWith("@"))return o;const f=Number(i.leftText.indexOf("!")),p=Number(i.leftText.indexOf("["));this._exts=f>=0&&f+1===p?URIType_1.ImageURIString:URIType_1.MarkdownFileURIString;let x={extSuffixFilterList:this._exts,prefixPath:c,enableShowFolders:this._enableShowFolders},_=d.range;if(this._enableShowFolders){let r=e.offsetAt(t)-e.offsetAt(i.leftRange.start);(0,core_1.getFragmentString)(i.context,r,"\\/")===(0,core_1.getContextData)(e,e.offsetAt(t),"\\/").context&&(x.onlyFolders=!1,x.onlyCurrentLevel=!0,_.end.character+=1)}let g=(0,URIHandler_1.getCompletionPathListSync)(a,l,x,e.uri),h=i.context.startsWith("@"),u=(0,URIHandler_1.getPathCompletionItem)(g,e,_,d,!1,h);return o.push(...u),o}}exports.default=MarkdownHandler;