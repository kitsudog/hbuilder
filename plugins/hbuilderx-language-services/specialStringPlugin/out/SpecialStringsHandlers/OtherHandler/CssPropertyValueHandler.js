"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),core_1=require("../../../../core"),vscode_css_languageservice_1=require("../../../../packages/vscode-css-languageservice"),type_resolve_1=require("../../common/type-resolve"),htmlDataUtils_1=require("../../tool/htmlDataUtils"),handlerType_1=require("../handlerType"),BaseHandler_1=require("./BaseHandler"),dataProvider=(0,htmlDataUtils_1.cssDataProvider)();function getColorProposals(e,o){var t;for(const t in vscode_css_languageservice_1.colors)e.push({label:t,detail:vscode_css_languageservice_1.colors[t].detail,documentation:vscode_css_languageservice_1.colors[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Color});for(const t in vscode_css_languageservice_1.colorKeywords){const s=vscode_css_languageservice_1.colorKeywords[t];e.push({label:t,documentation:s.documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value})}for(const s in vscode_css_languageservice_1.colorFunctions){const r=vscode_css_languageservice_1.colorFunctions[s];e.push({label:r.label,detail:r.detail,documentation:r.documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,null!==(t=r.insertText)&&void 0!==t?t:r.label):void 0,insertTextFormat:vscode_languageserver_protocol_1.InsertTextFormat.Snippet,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function})}return e}function getPositionProposals(e,o){for(const t in vscode_css_languageservice_1.positionKeywords)e.push({label:t,documentation:vscode_css_languageservice_1.positionKeywords[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getRepeatStyleProposals(e,o){for(const t in vscode_css_languageservice_1.repeatStyleKeywords)e.push({label:t,documentation:vscode_css_languageservice_1.repeatStyleKeywords[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getLineStyleProposals(e,o){for(const t in vscode_css_languageservice_1.lineStyleKeywords)e.push({label:t,documentation:vscode_css_languageservice_1.lineStyleKeywords[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getLineWidthProposals(e,o){for(const t in vscode_css_languageservice_1.lineWidthKeywords)e.push({label:t,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getGeometryBoxProposals(e,o){for(const t in vscode_css_languageservice_1.geometryBoxKeywords)e.push({label:t,documentation:vscode_css_languageservice_1.geometryBoxKeywords[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getBoxProposals(e,o){for(const t in vscode_css_languageservice_1.boxKeywords)e.push({label:t,documentation:vscode_css_languageservice_1.boxKeywords[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function moveCursorInsideParenthesis(e){return e.replace(/\(\)$/,"($1)")}function getImageProposals(e,o){for(const t in vscode_css_languageservice_1.imageFunctions){const s=moveCursorInsideParenthesis(t);e.push({label:t,documentation:vscode_css_languageservice_1.imageFunctions[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,s):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==s?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}function getBasicShapeProposals(e,o){for(const t in vscode_css_languageservice_1.basicShapeFunctions){const s=moveCursorInsideParenthesis(t);e.push({label:t,documentation:vscode_css_languageservice_1.basicShapeFunctions[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,s):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==s?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}function getTimingFunctionProposals(e,o){for(const t in vscode_css_languageservice_1.transitionTimingFunctions){const s=moveCursorInsideParenthesis(t);e.push({label:t,documentation:vscode_css_languageservice_1.transitionTimingFunctions[t].documentation,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,s):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==s?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}class CssPropertyValueHandler extends BaseHandler_1.BaseHandler{async doCompleteAsync(e,o,t,s,r){var n,a;let i=t.ast,c=e.offsetAt(o),l=(0,type_resolve_1.getTokenAtPosition)(i,c);if(!l)return[];let d="",_=l.parent,u=s.get(handlerType_1.LanguageServiceType.TS);if(_&&_.kind==u.SyntaxKind.CallExpression){let e=_.arguments,o=-1;for(let t=0;t<e.length;t++){let s=e[t];if(c>=s.getStart()&&c<=s.getEnd()){o=t-1;break}}if(o>=0){let t=e[o];t.kind==u.SyntaxKind.StringLiteral&&(d=t.getText(),"'"!==d[0]&&'"'!=d[0]||(d=d.slice(1,-1)))}}if(d){let e=dataProvider.provideProperties().find((e=>e.name==d));const o=t.range;if(e){let t=[];null===(n=e.values)||void 0===n||n.forEach((e=>{t.push({label:e.name,documentation:e.description,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,e.name):void 0,data:{hxKind:core_1.HxIconKind.ATTRIBUTE}})}));e.restrictions;return null===(a=e.restrictions)||void 0===a||a.forEach((e=>{let s=[];switch(e){case"color":getColorProposals(s,o);break;case"position":getPositionProposals(s,o);break;case"repeat":getRepeatStyleProposals(s,o);break;case"line-style":getLineStyleProposals(s,o);break;case"line-width":getLineWidthProposals(s,o);break;case"geometry-box":getGeometryBoxProposals(s,o);break;case"box":getBoxProposals(s,o);break;case"image":getImageProposals(s,o);break;case"timing-function":getTimingFunctionProposals(s,o);break;case"shape":getBasicShapeProposals(s,o)}t.push(...s)})),t}}return[]}}exports.default=CssPropertyValueHandler;