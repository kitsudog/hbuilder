"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=void 0;const hxproject_1=require("./hxproject"),core_1=require("../../../core"),fs=require("fs"),vscode_uri_1=require("vscode-uri"),languageServiceProxy_1=require("./languageServiceProxy");function createDocumentProvider(e,t,r){if(e&&t)return{get version(){return t.getProjectVersion()},getDefaultLibs:e=>[],compilerOptions:{allowNonTsExtensions:!0,allowJs:!0,lib:["lib.esnext.d.ts"],target:core_1.ts.ScriptTarget.Latest,moduleResolution:core_1.ts.ModuleResolutionKind.Node10,experimentalDecorators:!1},get documents(){let o=[].concat(r);return t.getScriptFileNames().forEach((t=>{e.isProjectOf(t)&&o.push(t)})),o},getDocumentSnapshot(e){let o=vscode_uri_1.URI.parse(e);if(r.indexOf(o.fsPath)>=0){let e=fs.readFileSync(o.fsPath).toString();return{getText:(t,r)=>e.substring(t,r),getLength:()=>e.length,getChangeRange:()=>{}}}return t.getScriptSnapshot(o.fsPath)},hasDocument(e){let o=vscode_uri_1.URI.parse(e);return r.indexOf(o.fsPath)>=0||t.fileExists(o.fsPath)},getDocumentVersion(e){let o=vscode_uri_1.URI.parse(e);return r.indexOf(o.fsPath)>=0?"1":t.getScriptVersion(o.fsPath)}}}function create(e){let t=e.project;if(t){let r;if(t&&(t.kind==hxproject_1.hx.HXProjectKind.UniApp||t.kind==hxproject_1.hx.HXProjectKind.UniApp_Cli)){let o=hxproject_1.hx.getUnicloudServerLibs();const i=createDocumentProvider(t,e.languageServiceHost,o);r=t.createTSLanguageService(i)}return(0,languageServiceProxy_1.createTSLanguageServiceProxy)(e.languageService,t,r)}return e.languageService}exports.create=create,exports.default={create:create};