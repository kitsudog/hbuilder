"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTokenAtPosition=exports.getRelevantTokens=exports.isInString=exports.getArgumentsSpecialStringType=void 0;const ts=require("typescript/lib/tsserverlibrary");function getArgumentsSpecialStringType(e,n,t){var i;let o=t.languageService.getSignatureHelpItems(e,n,void 0);if(o){let e=o.items;if(e.length>0){let n=e[0],t=o.argumentIndex;if((null==n?void 0:n.parameters)&&(null===(i=null==n?void 0:n.parameters)||void 0===i?void 0:i.length)>t){let e=n.parameters[t],i="";null==e||e.displayParts.forEach((e=>{i+=e.text}));let o=i.split(":");if(2===o.length){return o[1].split("|")}}}}return[]}function getTokenAtPosition(e,n){return getTokenAtPositionWorker(e,n,!0,void 0,!1)}function getTokenAtPositionWorker(e,n,t,i,o){let r=e;e:for(;;){for(const s of r.getChildren(e)){if((t?s.getFullStart():s.getStart(e,!0))>n)break;const l=s.getEnd();if(n<l||n===l&&(s.kind===ts.SyntaxKind.EndOfFileToken||o)){r=s;continue e}if(i&&l===n){const t=findPrecedingToken(n,e,s);if(t&&i(t))return t}}return r}}function isNonWhitespaceToken(e){return ts.isToken(e)}function some(e,n){if(e){if(!n)return e.length>0;for(const t of e)if(n(t))return!0}return!1}function binarySearchKey(e,n,t,i,o){if(!some(e))return-1;let r=o||0,s=e.length-1;for(;r<=s;){const o=r+(s-r>>1);switch(i(t(e[o],o),n)){case-1:r=o+1;break;case 0:return o;case 1:s=o-1}}return~r}function nodeHasTokens(e,n){return e.kind!==ts.SyntaxKind.EndOfFileToken&&0!==e.getWidth(n)}function findRightmostChildNodeWithTokens(e,n,t){for(let i=n-1;i>=0;i--){e[i];if(nodeHasTokens(e[i],t))return e[i]}}function findRightmostToken(e,n){if(isNonWhitespaceToken(e))return e;const t=e.getChildren(n);if(0===t.length)return e;const i=findRightmostChildNodeWithTokens(t,t.length,n);return i&&findRightmostToken(i,n)}function findPrecedingToken(e,n,t,i){const o=function t(o){if(isNonWhitespaceToken(o)&&o.kind!==ts.SyntaxKind.EndOfFileToken)return o;const r=o.getChildren(n),s=binarySearchKey(r,e,((e,n)=>n),((n,t)=>e<r[n].end?!r[n-1]||e>=r[n-1].end?0:1:-1));if(s>=0&&r[s]){const o=r[s];if(e<o.end){const l=o.getStart(n,!i);if(l>=e||!nodeHasTokens(o,n)){const e=findRightmostChildNodeWithTokens(r,s,n);return e&&findRightmostToken(e,n)}return t(o)}}const l=findRightmostChildNodeWithTokens(r,r.length,n);return l&&findRightmostToken(l,n)}(t||n);return o}function getRelevantTokens(e,n){console.log(`getRelevantTokens params: ${e}`);const t=findPrecedingToken(e,n);if(console.log(`previous token pos: ${null==t?void 0:t.pos}`),console.log(`previous token end: ${null==t?void 0:t.end}`),console.log(`previous token kind: ${null==t?void 0:t.kind}`),t&&e<=t.end&&(isMemberName(t)||isKeyword(t.kind))){console.log("getRelevatTokens enter if");const e=findPrecedingToken(t.getFullStart(),n,void 0);return console.log(`context token pos: ${null==e?void 0:e.pos}`),console.log(`context token end: ${null==e?void 0:e.end}`),{contextToken:e,previousToken:t}}return{contextToken:t,previousToken:t}}function isMemberName(e){return e.kind===ts.SyntaxKind.Identifier}function isKeyword(e){return ts.SyntaxKind.FirstKeyword<=e&&e<=ts.SyntaxKind.LastKeyword}function getTouchingPropertyName(e,n){return getTouchingToken(e,n,(e=>isPropertyNameLiteral(e)||isKeyword(e.kind)))}function getTouchingToken(e,n,t){return getTokenAtPositionWorker(e,n,!1,t,!1)}function isPropertyNameLiteral(e){switch(e.kind){case ts.SyntaxKind.Identifier:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:case ts.SyntaxKind.NumericLiteral:return!0;default:return!1}}function getLeftmostAccessExpression(e){for(;isAccessExpression(e);)e=e.expression;return e}function isAccessExpression(e){return e.kind===ts.SyntaxKind.PropertyAccessExpression||e.kind===ts.SyntaxKind.ElementAccessExpression}function nodeIsMissing(e){return void 0===e||e.pos===e.end&&e.pos>=0&&e.kind!==ts.SyntaxKind.EndOfFileToken}function isCallExpression(e){return e.kind===ts.SyntaxKind.CallExpression}function last(e){return e[e.length-1]}function isLiteralImportTypeNode(e){return ts.isImportTypeNode(e)&&ts.isLiteralTypeNode(e.argument)&&ts.isStringLiteral(e.argument.literal)}function isInRightSideOfInternalImportEqualsDeclaration(e){for(;e.parent.kind===ts.SyntaxKind.QualifiedName;)e=e.parent;return isInternalModuleImportEqualsDeclaration(e.parent)}function isInternalModuleImportEqualsDeclaration(e){return e.kind===ts.SyntaxKind.ImportEqualsDeclaration&&e.moduleReference.kind!==ts.SyntaxKind.ExternalModuleReference}function skipAlias(e,n){return e.flags&ts.SymbolFlags.Alias?n.getAliasedSymbol(e):e}function symbolCanBeReferencedAtTypeLocation(e,n,t=new Map){const i=e;return!!(i.flags&ts.SymbolFlags.Type)||n.isUnknownSymbol(i)||!!(i.flags&ts.SymbolFlags.Module)&&n.getExportsOfModule(i).some((e=>symbolCanBeReferencedAtTypeLocation(e,n,t)))}function isInString(e,n,t=findPrecedingToken(n,e)){if(t&&isStringTextContainingNode(t)){const i=t.getStart(e),o=t.getEnd();if(i<n&&n<o)return!0;if(n===o)return!!t.isUnterminated}return!1}function isStringTextContainingNode(e){return e.kind===ts.SyntaxKind.StringLiteral||isTemplateLiteralKind(e.kind)}function isTemplateLiteralKind(e){return ts.SyntaxKind.FirstTemplateToken<=e&&e<=ts.SyntaxKind.LastTemplateToken}exports.getArgumentsSpecialStringType=getArgumentsSpecialStringType,exports.getTokenAtPosition=getTokenAtPosition,exports.getRelevantTokens=getRelevantTokens,exports.isInString=isInString;