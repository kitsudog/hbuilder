"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TsServerStylePlugin=void 0;const core_1=require("../../core"),styleExtraPlugin_1=require("./modes/plugin/styleExtraPlugin"),styleMode_1=require("./modes/styleMode"),plugins_1=require("./plugins"),serviceTypes_1=require("./serviceTypes"),styleScriptCache_1=require("./styleScriptCache");function isStyleFile(e){return core_1.fileTypesTool.isStyleType(e)}function initialize(e){let t=e.languageServiceHost;const n=t.getScriptVersion.bind(t),i=t.getScriptSnapshot.bind(t),o=t.getScriptFileNames.bind(t);t.getScriptFileNames=function(){let e=[];return e=o().filter((e=>!isStyleFile(e))),e};let r=new Map;r.set("css",(0,serviceTypes_1.getCSSLanguageService)()),r.set("scss",(0,serviceTypes_1.getSCSSLanguageService)()),r.set("less",(0,serviceTypes_1.getLESSLanguageService)());const c={data:serviceTypes_1.webCssDataProvider,enable:function(e){return!(0,core_1.isUniAppXProject)(e)}},s={data:serviceTypes_1.uniappxCssDataProvider,enable:function(e){return(0,core_1.isUniAppXProject)(e)}},a=[new serviceTypes_1.MergeDataProvider(e.project,serviceTypes_1.styleI18nData,[c,s])],u=new Map;r.forEach(((e,t)=>{e.setDataProviders(!1,a),u.set(t,a)}));let l=(0,plugins_1.styleServerListEnablePluginProxy)({styleLanguageServiceList:r,project:e.project});l=new styleExtraPlugin_1.StyleExtraPluginModule(e,u,[]).create({styleLanguageServiceList:l,project:e.project});const g={getScriptVersion:n,getScriptSnapshot:i},f=new styleScriptCache_1.StyleScriptCache(e.ts,g);return{styleScriptCache:f,styleLanguageServiceModes:new styleMode_1.StyleMode(e,f,l,u)}}function create(e){const t=Object.create(null),{styleScriptCache:n,styleLanguageServiceModes:i}=initialize(e);return t.isEnabled=function(e,t){return isStyleFile(e)},t.cleanupSemanticCache=function(){},t.getCompilerOptionsDiagnostics=function(){return[]},t.getSyntacticClassifications=function(e,t){return[]},t.getSemanticClassifications=function(e,t){return[]},t.getEncodedSyntacticClassifications=function(e,t){throw new Error("[StyleService] method not implemented")},t.getEncodedSemanticClassifications=function(e,t,n){throw new Error("[StyleService] method not implemented")},t.getCompletionEntrySymbol=function(e,t,n,i){},t.getNameOrDottedNameSpan=function(e,t,n){},t.getBreakpointStatementAtPosition=function(e,t){},t.getSignatureHelpItems=function(e,t,n){},t.getRenameInfo=function(e,t,n){throw new Error("[StyleService] method not implemented")},t.findRenameLocations=function(e,t,n,i,o){},t.getSmartSelectionRange=function(e,t){throw new Error("[StyleService] method not implemented")},t.getDefinitionAtPosition=function(e,t){},t.getTypeDefinitionAtPosition=function(e,t){},t.getImplementationAtPosition=function(e,t){},t.getReferencesAtPosition=function(e,t){},t.getDocumentHighlights=function(e,t,n){},t.getNavigateToItems=function(e,t,n,i){return[]},t.getNavigationBarItems=function(e){return[]},t.prepareCallHierarchy=function(e,t){},t.provideCallHierarchyIncomingCalls=function(e,t){return[]},t.provideCallHierarchyOutgoingCalls=function(e,t){return[]},t.provideInlayHints=function(e,t,n){return[]},t.getOutliningSpans=function(e){return[]},t.getTodoComments=function(e,t){return[]},t.getBraceMatchingAtPosition=function(e,t){return[]},t.getIndentationAtPosition=function(e,t,n){throw new Error("[StyleService] method not implemented")},t.getFormattingEditsForRange=function(e,t,n,i){return[]},t.getFormattingEditsForDocument=function(e,t){return[]},t.getFormattingEditsAfterKeystroke=function(e,t,n,i){return[]},t.getDocCommentTemplateAtPosition=function(e,t,n){},t.isValidBraceCompletionAtPosition=function(e,t,n){throw new Error("[StyleService] method not implemented")},t.getJsxClosingTagAtPosition=function(e,t){},t.getSpanOfEnclosingComment=function(e,t,n){},t.getCodeFixesAtPosition=function(e,t,n,i,o,r){return[]},t.getCombinedCodeFix=function(e,t,n,i){throw new Error("[StyleService] method not implemented")},t.getApplicableRefactors=function(e,t,n,i,o){return[]},t.getEditsForRefactor=function(e,t,n,i,o,r){},t.organizeImports=function(e,t,n){return[]},t.getEditsForFileRename=function(e,t,n,i){return[]},t.getEmitOutput=function(e,t,n){throw new Error("[StyleService] method not implemented")},t.getProgram=function(){throw new Error("[StyleService] method not implemented")},t.toggleLineComment=function(e,t){return[]},t.toggleMultilineComment=function(e,t){return[]},t.commentSelection=function(e,t){return[]},t.uncommentSelection=function(e,t){return[]},t.dispose=function(){},t.getCompletionsAtPositionAsync=async function(e,t,n){let o=await i.getCompletionsAtPositionAsync(e,t,n);return(null==o?void 0:o.isIncomplete)&&(o.metadata={isIncomplete:!0}),o},t.getCompletionEntryDetails=function(e,t,n,o,r,c,s){return i.getCompletionEntryDetails(e,t,n,o,r,c,s)},t.getQuickInfoAtPositionAsync=async function(e,t){return i.getQuickInfoAtPositionAsync(e,t)},t.getDefinitionAndBoundSpanAsync=async function(e,t){return i.getDefinitionAndBoundSpanAsync(e,t)},t.findReferencesAsync=async function(e,t){return i.findReferencesAsync(e,t)},t.getNavigationTree=function(t){let n={text:"",kind:e.ts.ScriptElementKind.alias,kindModifiers:"",spans:[],nameSpan:void 0},o=i.getNavigationTree(t);return o||n},t.toLineColumnOffset=function(e,t){let i=n.getUpToDateInfo(e);if(i){let e=i.styleDocument.positionAt(t);return{line:e.line,character:e.character}}throw new Error("[StyleService] cacheInfo not found")},t.getSyntacticDiagnosticsAsync=async function(e){return await i.getSyntacticDiagnosticsAsync(e)||[]},t.getSemanticDiagnosticsAsync=async function(e){return await i.getSemanticDiagnosticsAsync(e)||[]},t.getSuggestionDiagnosticsAsync=async function(e){return await i.getSuggestionDiagnosticsAsync(e)||[]},t}const TsServerStylePlugin={create:e=>e.languageService,createExtService:e=>create(e)};exports.TsServerStylePlugin=TsServerStylePlugin;