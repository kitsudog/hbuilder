"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.styleIsRightCompletionType=exports.styleGetNodeAtOffset=exports.normalizedData=exports.locationToLocationLink=exports.locationToExtLocationLink=exports.isErrorAstNode=exports.getLocationFromText=exports.getLocationFromPosition=exports.getAstNodeTypeFromPosition=void 0;const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),serviceTypes_1=require("../../../../serviceTypes");function styleGetNodeAtOffset(e,t){let o=null;return!e||t<e.offset||t>e.end?null:(e.accept((e=>-1===e.offset&&-1===e.length||e.offset<=t&&e.end>=t&&(o?e.length<=o.length&&(o=e):o=e,!0))),o)}function styleIsRightCompletionType(e,t,o,n,r){if(!e)return!1;if(e.isNode){if(t)for(const o of t){if(e.type===o)return!0;if(e.parentType===o)return!0}if(o)for(const t of o){if(e.nodeType===t)return!0;if(e.parentNodeType===t)return!0}}else{if(n&&e.nodeType===n)return!0;if(r&&e.context===r)return!0}return!1}function getLocationFromPosition(e,t,o){const n=styleGetNodeAtOffset(t,e.offsetAt(o));if(!n)return;const r=e.positionAt(n.offset),i=e.positionAt(n.end),s=vscode_languageserver_protocol_1.Range.create(r,i);return{uri:e.uri,range:s}}function getLocationFromText(e,t,o,n){let r=[];return t.accept((t=>{if(t.type===o){if(t.getText()===n){let o=e.positionAt(t.offset),n=e.positionAt(t.end),i=vscode_languageserver_protocol_1.Range.create(o,n);r.push({uri:e.uri,range:i})}return!1}return!0})),r}function locationToLocationLink(e,t){if(e.length<=0)return[];let o=[];for(const n of e)o.push(vscode_languageserver_protocol_1.LocationLink.create(n.uri,n.range,n.range,t));return o}function locationToExtLocationLink(e,t){if(e.length<=0)return[];let o=[];for(const n of e){const e=vscode_languageserver_protocol_1.LocationLink.create(n.uri,n.range,n.range,t),r=e.targetRange,i={extRefItems:{range:{start:{line:r.start.line,offset:r.start.character},end:{line:r.end.line,offset:r.end.character}},name:"",lineText:"",isIndex:!0,display:""},targetUri:e.targetUri,targetRange:e.targetRange,targetSelectionRange:e.targetSelectionRange};o.push(i)}return o}function isErrorAstNode(e,t,o){const n=e.offsetAt(t),r=serviceTypes_1.ParseErrorCollector.entries(o);for(const e of r){const t=e;if(t.offset+t.length<n)return!0}return!1}function getAstNodeTypeFromPosition(e,t,o){var n,r;const i=styleGetNodeAtOffset(o,e.offsetAt(t));return{type:null==i?void 0:i.type,parentType:null===(n=null==i?void 0:i.parent)||void 0===n?void 0:n.type,nodeType:null==i?void 0:i.nodeType,parentNodeType:null===(r=null==i?void 0:i.parent)||void 0===r?void 0:r.nodeType,isNode:!0}}function normalizedData(e,t,o){let n=t.value;if("ID"===e&&(t.value.startsWith("#")||(n="#"+t.value)),"CLASS"===e&&(t.value.startsWith(".")||(n="."+t.value)),!o||n===o)return n}exports.styleGetNodeAtOffset=styleGetNodeAtOffset,exports.styleIsRightCompletionType=styleIsRightCompletionType,exports.getLocationFromPosition=getLocationFromPosition,exports.getLocationFromText=getLocationFromText,exports.locationToLocationLink=locationToLocationLink,exports.locationToExtLocationLink=locationToExtLocationLink,exports.isErrorAstNode=isErrorAstNode,exports.getAstNodeTypeFromPosition=getAstNodeTypeFromPosition,exports.normalizedData=normalizedData;