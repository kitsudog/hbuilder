"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LessCompletionProcessor=void 0;const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../../../../core"),node_1=require("../../../../../../htmlservice/entry/out/node"),serviceTypes_1=require("../../../../serviceTypes"),contextCompletionProcessor_1=require("../context/contextCompletionProcessor"),extraProcessor_1=require("../grammar/extraProcessor"),util_1=require("../utils/util"),baseCompletionProcessor_1=require("./baseCompletionProcessor");class LessCompletionProcessor extends baseCompletionProcessor_1.BaseCompletionProcessor{constructor(){super(...arguments),this.baseCompletionProcessor=new baseCompletionProcessor_1.BaseCompletionProcessor}getTagCompletionData(e,t,o,s,r){if(!(0,util_1.styleIsRightCompletionType)(s,[serviceTypes_1.NodeType.Media,serviceTypes_1.NodeType.MediaQuery],void 0,serviceTypes_1.NodeType.Media))return r;const i=t.offsetAt(o),a=(0,core_1.getContextData)(t,i,void 0).leftText;let n={uri:vscode_uri_1.URI.parse(e.sourceRoot).toString(),name:e.sourceRoot},l=(0,node_1.getHtmlTags)(n),c=vscode_languageserver_protocol_1.Position.create(o.line,o.character-a.length);for(const e of l)r.items.push({label:e,textEdit:vscode_languageserver_protocol_1.TextEdit.replace(vscode_languageserver_protocol_1.Range.create(c,o),e),kind:vscode_languageserver_protocol_1.CompletionItemKind.Keyword,data:{hxKind:core_1.HxIconKind.ELEMENT}});return r}getScopedFunctionsCompletionData(e,t,o,s,r){if(!s)return r;const i=t.offsetAt(o),a=(0,core_1.getContextData)(t,i,' \t\n\r":{[()]},*>+;');if(""===a.context){if(!(0,util_1.styleIsRightCompletionType)(s,[serviceTypes_1.NodeType.Declarations,serviceTypes_1.NodeType.Ruleset],void 0,serviceTypes_1.NodeType.Value))return r}else{const e=(0,util_1.styleIsRightCompletionType)(s,[serviceTypes_1.NodeType.Identifier,serviceTypes_1.NodeType.Term],void 0,serviceTypes_1.NodeType.Value);if(s.parentType===serviceTypes_1.NodeType.MixinReference)return r;if(!e)return r}let n=vscode_uri_1.URI.parse(t.uri).fsPath;if(n.includes(".nvue.")||n.includes(".vue.")||n.includes(".uvue."))for(const e of extraProcessor_1.vueStyleScopedFunction)r.items.push({label:e.label,textEdit:vscode_languageserver_protocol_1.TextEdit.replace(a.contextRange,e.insertText),kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,data:{hxKind:core_1.HxIconKind.FUNCTION}});return r}getExtraCompletionData(e,t,o,s,r){return r=this.baseCompletionProcessor.getExtraCompletionData(e,t,o,s,r),r=this.getTagCompletionData(e,t,o,s,r),r=this.getScopedFunctionsCompletionData(e,t,o,s,r)}async doExtraCompletion(e,t,o,s,r,i,a,n,l){this._tokenList=(0,contextCompletionProcessor_1.getTokenList)(t);const c=(0,util_1.isErrorAstNode)(t,o,s);let p=(0,util_1.getAstNodeTypeFromPosition)(t,o,s);return(c||0===r.items.length)&&(p=this.getCompletionTypeFromScanner(t,o,this._tokenList),r=this.getCompletionDataFromScanner(t,o,p,a)),r.items&&(r.items=r.items.map((e=>(e=this.initData(e),e=this.kindConverted(e),e=this.addReplace(t,o,e))))),r=this.getUniPlatformCompletionData(r,e,l),r=this.getDeprecatedCompletionData(t,o,p,r),r=this.filterCalcFunction(t,o,r,a),r=this.getMediaCompletionData(t,o,p,r),r=this.getCharsetCompletionData(t,o,p,r),r=await this.getPathCompletionData(e,t,o,p,r,a),r=this.getPropertySelectorCompletionData(e,t,o,p,r),r=this.getExtraCompletionData(e,t,o,p,r),r=this.getSelfIdSelectorCompletionData(t,o,p,r),r=await this.getIndexIdSelectorsCompletionData(e,t,o,p,r),r=await this.getIndexClassSelectorsCompletionData(e,t,o,p,r),r=this.getGrammarCompletionData(e,t,o,p,r),r=this.getPxConversionCompletionData(e,t,o,p,r,i),r=this.getDeduplicationData(r),r=this.getFiltrationPseudoData(t,o,p,r),r=this.retrieveRange(t,o,p,r),r=this.getMoveCursorData(t,o,p,r),r=this.getAltMode(t,o,p,r),r=this.setData(r)}}exports.LessCompletionProcessor=LessCompletionProcessor;