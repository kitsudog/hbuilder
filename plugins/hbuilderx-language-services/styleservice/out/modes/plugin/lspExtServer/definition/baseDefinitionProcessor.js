"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseDefinitionProcessor=void 0;const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),core_1=require("../../../../../../core"),specialStringPlugin_1=require("../../../../../../specialStringPlugin"),serviceTypes_1=require("../../../../serviceTypes"),contextCompletionProcessor_1=require("../context/contextCompletionProcessor"),util_1=require("../utils/util");class BaseDefinitionProcessor{async doExtraDefinitionAsync(e,t,n,i,r){const o=(0,contextCompletionProcessor_1.getTokenList)(t),s=i,a=(0,util_1.isErrorAstNode)(t,n,s);let c=(0,util_1.getAstNodeTypeFromPosition)(t,n,s);a&&(c=(0,contextCompletionProcessor_1.getCompletionTypeFromScanner)(t,n,o));const l=t.offsetAt(n),g=(0,core_1.getContextData)(t,l,void 0);if(!c)return r&&r.map((e=>(e.originSelectionRange=g.contextRange,e))),r;let p=t.uri;t.uri.startsWith("file://")||(p=(0,core_1.pathToUri)(p));let d=r;return d=await this.findIdDataFromIndex(e,t,n,g,c,d),d=await this.findClassDataFromIndex(e,t,n,g,c,d),d}async findIdDataFromIndex(e,t,n,i,r,o){if(!(0,util_1.styleIsRightCompletionType)(r,void 0,[serviceTypes_1.NodeType.IdentifierSelector],serviceTypes_1.NodeType.Selector))return o;if(!r.isNode&&!i.context.startsWith("#"))return o;const s={range:vscode_languageserver_protocol_1.Range.create(i.contextRange.start.line,i.contextRange.start.character,i.contextRange.end.line,i.contextRange.end.character),kind:specialStringPlugin_1.StringLocationInfoKind.IN_CSS_LIKE,ast:void 0,project:e};let a=new Map;const c=specialStringPlugin_1.StringServicesContainer.create(a);let l=await(0,specialStringPlugin_1.specialStringDoDefinition)(["HBuilderX.IDString"],t,n,s,c,[]);return l.map((e=>(e.originSelectionRange=i.contextRange,e))),o||(o=[]),o.unshift(...l),o}async findClassDataFromIndex(e,t,n,i,r,o){if(!(0,util_1.styleIsRightCompletionType)(r,void 0,[serviceTypes_1.NodeType.ClassSelector],serviceTypes_1.NodeType.Selector))return o;if(!r.isNode&&!i.context.startsWith("."))return o;const s={range:vscode_languageserver_protocol_1.Range.create(i.contextRange.start.line,i.contextRange.start.character,i.contextRange.end.line,i.contextRange.end.character),kind:specialStringPlugin_1.StringLocationInfoKind.IN_CSS_LIKE,ast:void 0,project:e};let a=new Map;const c=specialStringPlugin_1.StringServicesContainer.create(a);let l=await(0,specialStringPlugin_1.specialStringDoDefinition)(["HBuilderX.ClassString"],t,n,s,c,[]);return l.map((e=>(e.originSelectionRange=i.contextRange,e))),o||(o=[]),o.unshift(...l),o}}exports.BaseDefinitionProcessor=BaseDefinitionProcessor;