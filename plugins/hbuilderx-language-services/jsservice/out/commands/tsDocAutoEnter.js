"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TsDocOnEnterRules=void 0;const vscode=require("vscode"),ts=require("typescript/lib/tsserverlibrary"),os=require("os"),lineSeparator=os.EOL;function getTextFromOffsets(t,e,n){const r=t.positionAt(e),s=t.positionAt(n),o=new vscode.Range(r,s);return t.getText(o)}function getFunctionInfo(t,e,n,r){const s={isFuncDefine:!1,start:n.offsetAt(e.start),end:n.offsetAt(e.end)},o=e.start.line+1;return ts.forEachChildRecursively(t,(function(t,e){if(t.pos<r)return;if(n.positionAt(t.pos).line>o)return;e.kind===ts.SyntaxKind.FunctionDeclaration&&(s.isFuncDefine=!0,s.start=e.pos,s.end=e.end)})),s}function getCompleteData(t,e,n,r){let s=lineSeparator+r+" * ";const o=t.offsetAt(n.start),i=ts.createSourceFile("index.ts",e,ts.ScriptTarget.ESNext,!1,ts.ScriptKind.TS),a=getFunctionInfo(i,n,t,o);if(!a.isFuncDefine)return;const c=a.start,u=a.end,l=[];return ts.forEachChildRecursively(i,(function(e,n){if(e.pos<c||e.pos>u)return;if(e.kind===ts.SyntaxKind.Parameter&&n.kind===ts.SyntaxKind.FunctionDeclaration){const r=ts.isParameter(e),s=ts.isFunctionDeclaration(n);if(!r||!s)return;const o=e,i=getTextFromOffsets(t,o.name.pos,o.name.end);let a="any";e.type&&(a=getTextFromOffsets(t,e.type.pos,e.type.end)),l.push({parameter:i,type:a})}})),l.forEach((t=>{s=s+lineSeparator+`${r} * @param {${t.type.trim()}} ${t.parameter.trim()} `})),s=s+lineSeparator+r+" * @return ",s}function getEditorData(){const t=vscode.window.activeTextEditor;if(!t)return;const e=t.selection,n=t.document,r=n.lineAt(e.start.line).text,s=new vscode.Position(e.start.line,0),o=new vscode.Range(s,e.start),i=n.getText(o),a=new vscode.Position(e.start.line,r.length),c=new vscode.Range(e.start,a),u=n.getText(c),l=RegExp(/^([\s]*)\S/g).exec(i);let d="";l&&l.length>1&&(d=l[1]);return{document:n,selection:e,indentText:d,leftText:i,rightText:u}}async function hasEndAsterisk(){const t=getEditorData();if(!t)return;let e="";const n=t.document,r=t.selection,s=t.indentText,o=t.rightText;if(!/^\s*\*\/\s*$/.test(o))e=lineSeparator;else{const t=n.getText();if(e=getCompleteData(n,t,r,s),!e)return;e=e+lineSeparator+s}return e}async function notEndAsterisk(){const t=getEditorData();if(!t)return;let e="";const n=t.document,r=t.selection,s=t.indentText,o=n.getText(),i=n.lineAt(r.start.line).range,a=n.offsetAt(i.start),c=n.offsetAt(i.end),u=" ".repeat(c-a);return e=getCompleteData(n,o.substring(0,a)+u+o.substring(c),r,s),e?(e=e+lineSeparator+s+" */ ",e):void 0}const hasEndOnEnterRule={beforeText:"^\\s*/\\*\\*(?!/)([^\\*]|\\*(?!/))*$",afterText:"^\\s*\\*/$",onEnter:hasEndAsterisk},notEndOnEnterRule={beforeText:"^\\s*/\\*\\*(?!/)([^\\*]|\\*(?!/))*$",onEnter:notEndAsterisk},TsDocOnEnterRules={onEnterRules:[hasEndOnEnterRule,notEndOnEnterRule]};exports.TsDocOnEnterRules=TsDocOnEnterRules;