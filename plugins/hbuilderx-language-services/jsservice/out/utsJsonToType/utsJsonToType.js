"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UtsJsonToType=void 0;const hx=require("hbuilderx"),vscode=require("vscode"),JSONtoTS_1=require("./components/JSONtoTS"),util_1=require("./components/util");class UtsJsonToType{async openNewWindow(e,t){try{await hx.commands.executeCommand("workbench.action.split2e")}catch(e){return`Command 'workbench.action.split2e' failed. Error: ${JSON.stringify(e)}`}let o;try{o=await hx.window.getActiveTextEditor()}catch(e){return`API 'hx.window.getActiveTextEditor' failed. Error: ${JSON.stringify(e)}`}const r=o.document.fileName,n=o.document.version;if(""!==r||0!==n)try{await hx.commands.executeCommand("workbench.action.nextpane")}catch(e){return`Command 'workbench.action.nextpane' failed. Error: ${JSON.stringify(e)}`}try{await hx.request("workspace.openRemoteDocument",{uri:`virtual://temp/jsonToType_${(new Date).getTime()}.ts`,context:e,preview:!0})}catch(e){return`request 'workspace.openRemoteDocument' failed. Error: ${JSON.stringify(e)}`}}async getSelectedText(){let e;try{e=await hx.window.getActiveTextEditor()}catch(e){const t=`API 'hx.window.getActiveTextEditor' failed. Error: ${JSON.stringify(e)}`;return vscode.window.showErrorMessage(t),{text:"",hasError:!0}}const t=e.selection;return{text:e.document.getText(t).trim(),hasError:!1}}async convertJSONToType(){let e=await this.getSelectedText();if(e.hasError)return;let t=e.text;if(""===t)return void vscode.window.showErrorMessage("Text shouldn't be empty!");let o=(0,JSONtoTS_1.convertJsonToTs)(t);if(o.result===util_1.Result.error)return void vscode.window.showErrorMessage(o.errorMessage);o.output=o.output.replace(/export interface/g,"type"),o.output=o.output.replace(/type IRootInterface/g,"type IRootType"),o.output=o.output.replace(/{/g,"= {"),o.output=o.output.replace(/(?=\?).*?(?=;)/g,(e=>e.slice(1)+" | null")),o.output=o.output.replace(/(?<=[{|;]\s\t)(.*?)(?=:)/g,(e=>e.includes("@")||e.includes("/")||e.includes("-")||e.includes(".")?`'${e}'`:e));const r=await this.openNewWindow(o.output,"jsonUtility.ts");r&&vscode.window.showErrorMessage(r)}}exports.UtsJsonToType=UtsJsonToType;