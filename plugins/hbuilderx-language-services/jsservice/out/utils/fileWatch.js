"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.creatFileWatch=void 0;const vscode=require("vscode");class fileWatch{constructor(e){this.allWatch=new Map,this._client=e}creat(e,t,a){this.allWatch.set(e,a),this._watch(e)}close(e){let t=this.allWatch.get(e);null==t||t.dispose(),this.allWatch.delete(e)}_watch(e){let t=this.allWatch.get(e);null==t||t.onDidChange((t=>{let a=this.allWatch.has(e)?"change":"rename";this._client.executeWithoutWaitingForResponse("fileWatchSys",{watchId:e,fileName:t.path,eventName:a})})),null==t||t.onDidDelete((t=>{this._client.executeWithoutWaitingForResponse("fileWatchSys",{watchId:e,fileName:t.path,eventName:"rename"})}))}}function creatFileWatch(e){const t=e.value.serviceClient,a=new fileWatch(t);t.onFileWatch((e=>{let t=e.body.fileName,c=e.body.eventType,l=e.body.watchId;if("watch"===c){let e=vscode.workspace.createFileSystemWatcher(t,!1,!1);a.creat(l,t,e)}else a.close(l)}))}exports.creatFileWatch=creatFileWatch;