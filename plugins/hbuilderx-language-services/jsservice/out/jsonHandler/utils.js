"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sortDefValue=exports.parseExtData=exports.findClosestNumberObject=exports.convertLocationLink=exports.convertCompletion=void 0;const vscode=require("vscode"),vscode_uri_1=require("vscode-uri"),specialStringPlugin_1=require("../../../specialStringPlugin"),unixVersionCompatibilityResolver_1=require("../languageFeatures/unixVersionCompatibilityResolver");function findClosestNumberObject(e,t){let n,r=Number.MAX_SAFE_INTEGER;for(const i of e){const e=Math.abs(i.node.offset-t);e<r&&(r=e,n=i)}return n}function sortDefValue(e){e.items&&e.items.map((e=>{let t="z";e.detail&&e.detail.includes("Default value")&&(t="a");const n=e.label;e.sortText=`${t}_${n}`}))}function generatorSnippetString(e){if(!e)return"";e.includes("{$1},")&&(e=e.replace("{$1},","{\n\t$1\n},")),e.includes("{$1}")&&(e=e.replace("{$1}","{\n\t$0\n}")),e.includes("[$1],")&&(e=e.replace("[$1],","[\n\t$1\n],")),e.includes("[$1]")&&(e=e.replace("[$1]","[\n\t$0\n],"));const t=(0,specialStringPlugin_1.getSpecialTypes)();for(let n of t)if(e.includes(n))return e=e.replace(n,"");return e}function convertCompletion(e,t){let n=[];if(!e||!e.items||0===e.items.length)return n;const r=e.items;for(let e=0;e<r.length;e++){const i=r[e];let o,a,s,l="";if("string"==typeof i.documentation?l=i.documentation:i.documentation&&(l=i.documentation.value),i.textEdit){if(o=i.textEdit.newText,i.textEdit.range){const e=i.textEdit.range;a=new vscode.Range(e.start.line,e.start.character,e.end.line,e.end.character)}if(o&&-1!=o.search("1")){s={title:"Suggest",command:"editor.action.triggerSuggest"};const e=generatorSnippetString(o);o=new vscode.SnippetString(e)}}let c=i.detail;if(i.uniPlatform){const e=i.uniPlatform,t=getUniPlatformedHtml(JSON.stringify(e));t&&""!==t&&(l=l+"  \n"+t)}n.push({kind:i.kind,label:i.label,detail:c,documentation:l,insertText:o,sortText:i.sortText,range:a,filterText:t?`"${i.label}"`:i.label,command:s})}return n}function convertLocationLink(e){const t=[];if(!e||0===e.length)return t;for(let n=0;n<e.length;n++){const r=e[n],i=r.originSelectionRange;if(!i)continue;const o=r.targetRange,a=new vscode.Range(i.start.line,i.start.character,i.end.line,i.end.character),s=new vscode.Range(o.start.line,o.start.character,o.end.line,o.end.character),l=vscode_uri_1.URI.file(r.targetUri);t.push({originSelectionRange:a,targetRange:s,targetUri:l,targetSelectionRange:s})}return t}function getUniPlatformedHtml(e){if(!e)return"";return new unixVersionCompatibilityResolver_1.UnixVersionCompatibilityResolver(e).getHtml()}function parseExtData(e,t){const n=[];if(e.detail&&""!==e.detail){const t=new vscode.MarkdownString(e.detail);t.language="typescript",n.push(t)}t&&n.push(t);const r=getUniPlatformedHtml(JSON.stringify(e.uniPlatform));return r&&""!==r&&n.push(new vscode.MarkdownString(r)),n}exports.findClosestNumberObject=findClosestNumberObject,exports.sortDefValue=sortDefValue,exports.convertCompletion=convertCompletion,exports.convertLocationLink=convertLocationLink,exports.parseExtData=parseExtData;