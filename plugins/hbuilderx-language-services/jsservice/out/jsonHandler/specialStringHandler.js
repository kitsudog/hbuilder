"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSpecialStringHover=exports.getSpecialStringDefinition=exports.getSpecialStringCompletionItems=exports.filterI18nType=void 0;const vscode=require("vscode"),specialStringPlugin_1=require("../../../specialStringPlugin"),utils_1=require("./utils");function getSpecialStringParameter(e,t,i,n,r){if("string"==typeof e)e=[e];else if(void 0===e)return;const o=t.offsetAt(i),c=n.getNodeFromOffset(o);if(!c)return;const s=c.offset,a={...t.positionAt(s)};a.character+=1;const l={...a};l.character+=c.length-2;return{loc:{range:{start:a,end:l},kind:specialStringPlugin_1.StringLocationInfoKind.IN_JSON_LIKE,ast:n,project:r},types:e}}function filterI18nType(e){let t=!1;for(let i=0;i<e.length;i++){e[i].includes("VueI18NKeyString")&&(t=!0)}let i=e;return t&&(i=e.filter((e=>!e.includes("VueI18NKeyString")))),{hasI18n:t,newTypes:i}}async function getI18nCompletionItems(e,t,i){const n={isIncomplete:!1,items:[]};let r=await(0,specialStringPlugin_1.specialStringDoCompleteAsync)(["HBuilderX.VueI18NKeyString"],e,t,i,specialStringPlugin_1.StringServicesContainer.create(void 0),[]);r.items.map((e=>(e.label="%"+e.label+"%",e.kind=12,e.textEdit&&(e.textEdit.newText="%"+e.textEdit.newText+"%"),e)));const o=(0,utils_1.convertCompletion)(r,!1);return n.isIncomplete=r.isIncomplete,n.items.push(...o),n}async function getSpecialStringCompletionItems(e,t,i,n,r){const o={isIncomplete:!1,items:[]},c=getSpecialStringParameter(e,t,i,n,r);if(!c)return o;const{hasI18n:s,newTypes:a}=filterI18nType(c.types);if(s){const e=await getI18nCompletionItems(t,i,c.loc);o.isIncomplete=e.isIncomplete,o.items.push(...e.items)}let l=await(0,specialStringPlugin_1.specialStringDoCompleteAsync)(a,t,i,c.loc,specialStringPlugin_1.StringServicesContainer.create(void 0),[]);const g=(0,utils_1.convertCompletion)(l,!1);return o.isIncomplete=l.isIncomplete,o.items.push(...g),o}async function getI18nDefinition(e,t,i){const n=[];i.range.start.character+=1,i.range.end.character-=1;let r=await(0,specialStringPlugin_1.specialStringDoDefinition)(["HBuilderX.VueI18NKeyString"],e,t,i,specialStringPlugin_1.StringServicesContainer.create(void 0),[]);const o=(0,utils_1.convertLocationLink)(r);return n.unshift(...o),n}async function getSpecialStringDefinition(e,t,i,n,r){const o=[],c=getSpecialStringParameter(e,t,i,n,r);if(!c)return o;const{hasI18n:s,newTypes:a}=filterI18nType(c.types);if(s){const e=await getI18nDefinition(t,i,c.loc);o.unshift(...e)}let l=await(0,specialStringPlugin_1.specialStringDoDefinition)(a,t,i,c.loc,specialStringPlugin_1.StringServicesContainer.create(void 0),[]);const g=(0,utils_1.convertLocationLink)(l);return o.unshift(...g),o}async function getI18nHover(e,t,i){i.range.start.character+=1,i.range.end.character-=1;let n=await(0,specialStringPlugin_1.specialStringDoHover)(["HBuilderX.VueI18NKeyString"],e,t,i,specialStringPlugin_1.StringServicesContainer.create(void 0));if(!n)return;return new vscode.Hover(new vscode.MarkdownString(n.contents.toString()))}async function getSpecialStringHover(e,t,i,n,r){let o;const c=getSpecialStringParameter(e,t,i,n,r);if(!c)return o;const{hasI18n:s,newTypes:a}=filterI18nType(c.types);if(s){const e=await getI18nHover(t,i,c.loc);if(e)return e}const l=await(0,specialStringPlugin_1.specialStringDoHover)(a,t,i,c.loc,specialStringPlugin_1.StringServicesContainer.create(void 0));if(l){return new vscode.Hover(new vscode.MarkdownString(l.contents.toString()))}return o}exports.filterI18nType=filterI18nType,exports.getSpecialStringCompletionItems=getSpecialStringCompletionItems,exports.getSpecialStringDefinition=getSpecialStringDefinition,exports.getSpecialStringHover=getSpecialStringHover;