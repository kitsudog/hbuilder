"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MarkdownMode=void 0;const vscode_languageserver_textdocument_1=require("vscode-languageserver-textdocument"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../core"),specialStringPlugin_1=require("../../../specialStringPlugin"),completion_1=require("./completion/completion");class MarkdownMode{constructor(e,t){this._completion=new completion_1.Completion,this.info=e,this.markdownScriptCache=t}initialize(e,t){this.info;const o=this.markdownScriptCache.getUpToDateInfo(e);if(!o)return;const i=vscode_uri_1.URI.file(e).toString(),n=vscode_languageserver_textdocument_1.TextDocument.create(i,"markdown",0,o.markdownDocument.getText()),r=n.positionAt(t);return{markdownDocument:n,position:r}}async getCompletionsAtPositionAsync(e,t,o){const i=this.info;let n=this.initialize(e,t);if(!n)return;const r=n.markdownDocument,c=n.position,s={range:{start:c,end:c},kind:specialStringPlugin_1.StringLocationInfoKind.IN_JSON_LIKE,ast:void 0,project:i.project},a=new Map,l=specialStringPlugin_1.StringServicesContainer.create(a);let d=[];d=await(0,specialStringPlugin_1.specialStringDoCompleteAsync)(["HBuilderX.MarkdownURIString"],r,c,s,l,[]),d=this._completion.doExtraComplete(r,c,d);return(0,core_1.fromLspCompletions)(d,r,i.ts)}}exports.MarkdownMode=MarkdownMode;