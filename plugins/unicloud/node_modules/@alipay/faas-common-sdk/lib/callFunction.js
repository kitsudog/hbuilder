"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(o){for(var c,r=1,a=arguments.length;r<a;r++){c=arguments[r];for(var n in c)if(Object.prototype.hasOwnProperty.call(c,n))o[n]=c[n]}return o};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(o,c,r,a){function n(t){return t instanceof r?t:new r(function(s){s(t)})}return new(r||(r=Promise))(function(t,s){function u(i){try{e(a.next(i))}catch(f){s(f)}}function l(i){try{e(a["throw"](i))}catch(f){s(f)}}function e(i){i.done?t(i.value):n(i.value).then(u,l)}e((a=a.apply(o,c||[])).next())})};var __generator=this&&this.__generator||function(o,c){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},a,n,t,s;return s={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(e){return function(i){return l([e,i])}}function l(e){if(a)throw new TypeError("Generator is already executing.");while(s&&(s=0,e[0]&&(r=0)),r)try{if(a=1,n&&(t=e[0]&2?n["return"]:e[0]?n["throw"]||((t=n["return"])&&t.call(n),0):n.next)&&!(t=t.call(n,e[1])).done)return t;if(n=0,t)e=[e[0]&2,t.value];switch(e[0]){case 0:case 1:t=e;break;case 4:r.label++;return{value:e[1],done:false};case 5:r.label++;n=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(t=r.trys,t=t.length>0&&t[t.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!t||e[1]>t[0]&&e[1]<t[3])){r.label=e[1];break}if(e[0]===6&&r.label<t[1]){r.label=t[1];t=e;break}if(t&&r.label<t[2]){r.label=t[2];r.ops.push(e);break}if(t[2])r.ops.pop();r.trys.pop();continue}e=c.call(o,r)}catch(i){e=[6,i];n=0}finally{a=t=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.createCallFunction=void 0;var error_1=require("./error");var utils_1=require("./utils");var createCallFunction=function(o){var c=o.httpclient;var r=function(a){return __awaiter(void 0,void 0,void 0,function(){var n,t,s,u,l,e,i;return __generator(this,function(f){switch(f.label){case 0:if(!a.name){throw error_1.FaasError.INVALID_PARAM_ERR("name","\u7F3A\u5931")}n=__assign(__assign({},a.headers),{"x-to-function-name":a.name,"x-alipay-cloud-mode":"function"});if(a.async){n["x-function-invoke-type"]="async"}t="POST";s="/functions/invokeFunction";return[4,c.request({method:t,path:s,data:a.data,headers:n,responseDataType:a.resultDataType,timeout:a.timeout})];case 1:u=f.sent();if(u.status!==200){l=-1;e="";i=u.data;if(i){l=i.errCode,e=i.errMsg;if(i.errDetail){e+="\uFF0C\u8BE6\u60C5\uFF1A".concat(i.errDetail)}}throw error_1.FaasError.SERVER_ERR(l,e,u.requestID,u.status)}return[2,{requestID:u.requestID,result:u.data,headers:u.headers}]}})})};return(0,utils_1.wrapCallback)(r)};exports.createCallFunction=createCallFunction;