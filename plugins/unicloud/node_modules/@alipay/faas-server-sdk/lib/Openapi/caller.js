"use strict";var __importDefault=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OpenapiCaller=void 0;const faas_common_sdk_1=require("@alipay/faas-common-sdk"),snakecase_keys_1=__importDefault(require("snakecase-keys")),constant_1=require("../constant"),errors_1=require("../errors"),requester_1=require("../requester");class OpenapiCaller{#t;#s;#e;constructor({config:t,version:r,sandbox:n}){this.#t=r||constant_1.OPENAPI_VERSION,this.#s=!!n,this.#e=requester_1.Httpclient.createOpenapiHttpclient(t)}async requestRaw(t,r,n,o){const{res:i}=await this.#e.requestRaw({method:t,path:r,data:n,headers:o});return i}async request(t,r){const n="POST",o="/functions/invokeOpenapi",{callbackFunction:i,...p}=r||{},a=(0,snakecase_keys_1.default)(Object.assign({},p),{deep:!0});a.biz_content&&typeof a.biz_content!="string"&&(a.biz_content=JSON.stringify(a.biz_content));const u={"x-openapi":t,"x-openapi-version":this.#t,"x-openapi-env":this.#s?"sandbox":"","x-openapi-callback-function":i},e=await this.#e.request({method:n,path:o,data:a,headers:u});if(e.status!==200){const{code:l,message:d,errCode:h,errMsg:f}=e.data;throw faas_common_sdk_1.FaasError.SERVER_ERR(l||h,d||f,e.requestID,e.status)}const _=`${t.replace(/\./g,"_")}_response`,c=e.data?.[_];if(!c)throw errors_1.errors.INVALID_OPENAPI_RESPONSE_ERR(e.requestID,e.data||"");return c}}exports.OpenapiCaller=OpenapiCaller;