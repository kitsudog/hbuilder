"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Collection=void 0;const faas_db_builder_1=require("@alipay/faas-db-builder"),faas_server_utils_1=require("@alipay/faas-server-utils"),faas_common_sdk_1=require("@alipay/faas-common-sdk");class Collection{#e;#a;#s;#n;#t;constructor(t,e,a){this.#e=t,this.#a=e,this.#n=a,this.#s=new faas_db_builder_1.CollectionBuilder(e,{maxAddCount:1e3}),this.#t=new faas_common_sdk_1.Collection(e,{httpclient:a,type:"function",databaseName:t.functionDatabaseName,throwOnNotFound:t.throwOnNotFound})}async add(t){if(Array.isArray(t.data))return this.#r(t);const e=(0,faas_server_utils_1.getAlipayContext)(),{data:a}=t,n={...a,_openid:a._openid||e.OPENID};return this.#t.add({data:n})}async#r(t){const{options:e}=this.#s.add(t),a="POST",n=`${this.#i()}?batchCreate`,r=(0,faas_server_utils_1.getAlipayContext)();e.$create.forEach(s=>{s._openid=s._openid||r.OPENID});const i=await this.#n.request({method:a,path:n,data:e});return{_ids:faas_common_sdk_1.ResponseUtil.handleResponse(i).insertedIds.map(({_id:s})=>s)}}doc(t){return this.#t.doc(t)}limit(t){return this.#t.limit(t)}skip(t){return this.#t.skip(t)}where(t){return this.#t.where(t)}projection(t){return this.#t.projection(t)}field(t){return this.projection(t)}orderBy(t,e){return this.#t.orderBy(t,e)}aggregate(){return this.#t.aggregate()}async update(t){return await this.#t.update(t)}async updateAndReturn(t){return await this.#t.updateAndReturn(t)}async set(t){return await this.#t.set(t)}async remove(){return await this.#t.remove()}async get(){return await this.#t.get()}async count(){return await this.#t.count()}#i(){return`/${this.#e.functionDatabaseName||"faas"}/${this.#a}`}}exports.Collection=Collection;