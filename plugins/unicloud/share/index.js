"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("path"),e=require("fs"),i=require("hjson"),a=require("vm");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t),s=n(e),p=n(i),l=n(a);class r extends Error{constructor(t){const{message:e,code:i}=t||{};super(e),this.code=i}}const c=-32603,m="JSON_RPC_MESSAGE_CALL",d="JSON_RPC_MESSAGE_RESPONSE";class u{constructor(t){const{bridge:e,timeout:i=3e4}=t||{};this._timeout=i,this._bridge=e,this._methodMap=new Map,this._promiseMap=new Map,this._callMessageId=0,this._messageCallback=t=>{!function(t){return t.type===m}(t)?function(t){return t.type===d&&!!t.result}(t)?this._processResponseSuccessMessage(t):function(t){return t.type===d&&!!t.error}(t)&&this._processResponseFailMessage(t):this._processCallMessage(t)},this._bridge.on("message",this._messageCallback)}_processCallMessage(t){const{id:e,method:i,params:a}=t||{};this._methodMap.has(i)||this._fail(e,-32601,`method[${i}] not found`);const o=this._methodMap.get(i);try{const t=o(a);t&&"function"==typeof t.then?t.then((t=>{this._success(e,t||{})})).catch((t=>{this._fail(e,c,t.message)})):this._success(e,t||{})}catch(t){this._fail(e,c,t.message)}}_processResponseSuccessMessage(t){const{id:e,result:i}=t||{};if(!this._promiseMap.has(e))return;const{resolve:a}=this._promiseMap.get(e);this._promiseMap.delete(e),a(i)}_processResponseFailMessage(t){const{id:e,error:i}=t||{};if(!this._promiseMap.has(e))return;const{reject:a}=this._promiseMap.get(e);this._promiseMap.delete(e),a(new r({code:i.code,message:i.message}))}_send(t){this._bridge.send(t)}_success(t,e){this._send({id:t,type:d,result:e})}_fail(t,e,i){this._send({type:d,id:t,error:{code:e,message:i}})}call(t,e){return new Promise(((i,a)=>{const o=++this._callMessageId;this._send({type:m,id:o,method:t,params:e||{}}),this._promiseMap.set(o,{resolve:i,reject:a}),setTimeout((()=>{this._promiseMap.delete(o),a(new r({code:-32e3,message:"Invoke method timeout"}))}),this._timeout)}))}expose(t,e){this._methodMap.set(t,e)}close(){this._bridge.off&&this._bridge.off("message",this._messageCallback)}}class f extends u{constructor({bridgeProcess:t}){super({bridge:t})}}const x=process.env.UNICLOUD_DEBUGGER_PATH||o.default.resolve(__dirname,"../");class h extends Error{constructor(t,e){super(t),this.code=e}}function g(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function y(t){try{return s.default.statSync(t).isDirectory()}catch(t){return!1}}function b(t){return p.default.parse(t.replace("\r\n","\n").replace("\r","\n"))}function v(t){let e=s.default.readFileSync(t);return 239===e[0]&&187===e[1]&&191===e[2]&&(e=e.slice(3)),e.toString("utf-8")}function j(t){return b(v(t))}function _(t){const e=new l.default.Script(t),i=l.default.createContext({Date:Date,RegExp:RegExp});return e.runInContext(i)}function w(t){return[o.default.resolve(t,"src","manifest.json"),o.default.resolve(t,"src","pages.json")].every((t=>s.default.existsSync(t)))}function C(t){return s.default.existsSync(o.default.resolve(t,"encrypt"))}class k{constructor({parent:t,type:e,start:i,end:a,startIndex:o,endIndex:n}={}){this.parent=t,this.type=e,this.start=i,this.end=a,this.startIndex=o,this.endIndex=n}}const S=[{start:"(",end:")",type:"bracket"},{start:"{",end:"}",type:"bracket"},{start:"'",end:"'",type:"string"},{start:'"',end:'"',type:"string"},{start:"`",end:"`",type:"string"},{start:"//",end:"\n",type:"comment"},{start:"/*",end:"*/",type:"comment"}],M={root:["comment","bracket","string"],bracket:["comment","bracket","string"],comment:[],string:[]};function O({content:t,index:e,lastRealm:i,currentRealm:a}={}){const o=i&&i.endIndex||0;for(let i=0;i<S.length;i++){const{start:n,end:s,type:p}=S[i];if(s===t.substring(e+1-s.length,e+1)&&a.end===s)return{start:n,end:s,type:p,matchType:"end"};if(e+1-o>=n.length&&n===t.substring(e+1-n.length,e+1))return{start:n,end:s,type:p,matchType:"start"}}}function I(t,e={}){let i=new k({parent:null,type:"root",start:"root",end:"root",startIndex:0}),a=i;function o(t){i.endIndex=t+1,e.onRealmClosed&&e.onRealmClosed(i),a=i,i=i.parent}function n(t,{type:e,start:a,end:o}={}){i=new k({parent:i,type:e,start:a,end:o,startIndex:t})}for(let e=0;e<t.length;e++){const s=O({content:t,index:e,lastRealm:a,currentRealm:i});if(!s)continue;const{start:p,end:l,type:r,matchType:c}=s;"start"===c?M[i.type].includes(r)&&n(e+1-p.length,s):"end"===c&&i.end===l&&o(e)}for(;i;)o(t.length-1)}function P(t){const e=o.default.resolve(t,w(t)?"src":"","uni_modules");return y(e)?s.default.readdirSync(e).filter((t=>!!y(o.default.resolve(e,t)))):[]}function L(t,e){s.default.existsSync(e)&&t.push(e)}function F(t,e,i){const a=[],n=o.default.resolve(t,`uniCloud-${e}`);L(a,o.default.resolve(n,i));const s=P(t);if(!s||0===s.length)return a;const p=function(t){let e={};try{e=j(o.default.resolve(t,w(t)?"src":"","uni-modules.config.json"))}catch(t){}let i=e&&e.uni_modules;return i&&"object"===g(i)||(i={}),i}(t);for(let n=0;n<s.length;n++){const l=s[n];let r=p[l];r&&"array"===g(r)||(r=[e]),r.indexOf(e)>-1&&L(a,o.default.resolve(t,w(t)?"src":"",`uni_modules/${l}/uniCloud`,i))}return a}function D(t,e){return F(t,e,"cloudfunctions")}function E(t){const e=["common","uni-clientDB-actions"];let i=[];try{i=s.default.readdirSync(t).filter((t=>-1===e.indexOf(t))).map((e=>o.default.resolve(t,e)))}catch(t){}return i}function N(t){let e=[];const i=o.default.resolve(t,"common");try{e=s.default.readdirSync(i).map((t=>o.default.resolve(i,t))).filter((t=>y(t)))}catch(t){}return e}function B(t,e,i){const a=function(t,e,i){return F(t,e,`cloudfunctions/${i}`)}(t,e,i);if(0===a.length)throw new h(`未匹配到云函数[${i}]`,"NOT_FOUND");if(a.length>1)throw console.error(`云函数[${i}]存在名称冲突，请解决冲突后再试。产生冲突的路径如下：`),a.forEach((t=>{console.error(t)})),new h("云函数名称冲突，请解决后再试","CONFLICT_NAME");return a[0]}function $(t){const e=s.default.existsSync(o.default.resolve(t,"index.js")),i=s.default.existsSync(o.default.resolve(t,"index.obj.js"));if(e){if(i)throw new Error("云函数目录下index.js和index.obj.js不可同时存在");return"function"}if(i)return"object";throw new Error("未找到云函数入口")}function R(t,e,i){const a=function(t,e,i){return F(t,e,`cloudfunctions/common/${i}`)}(t,e,i);if(0===a.length)throw new h(`未找到公共模块[${i}]`,"NOT_FOUND");if(a.length>1)throw console.error(`公共模块[${i}]存在名称冲突，请解决冲突后再试。产生冲突的路径如下：`),a.forEach((t=>{console.error(t)})),new h(`公共模块[${i}]名称冲突，请解决后再试', 'CONFLICT_NAME`);return a[0]}function T(t,e){const i=D(t,e),a=[];for(let t=0;t<i.length;t++){const e=E(i[t]);a.push(...e)}return a}function q(t){const e=(t=t.replace(/\\/g,"/")).match(/uni_modules\/(.*?)\//);return e&&e[1]||""}function U(t){const e=q(t),i=N(t),a=[];for(let t=0;t<i.length;t++){const o=i[t],n=o.replace(/\\/g,"/").split("/").pop();a.push({name:n,path:o,uniModuleId:e})}return a}function A(t){return t.replace(/\\/g,"/").split("/").pop()}function z(t){const e=A(t),i=o.default.resolve(t,`${e}.param.json`);return s.default.existsSync(i)?j(i):{}}function J(t){const e=(t=function(t){const e=[];I(t,{onRealmClosed:function(t){"comment"===t.type&&e.push(t)}});const i=t.split("");for(let t=e.length-1;t>=0;t--){const a=e[t];i.splice(a.startIndex,a.endIndex-a.startIndex)}return i.join("")}(t=t.replace(/\r\n/g,"\n"))).match(/(?:const\s+clientInfo[\s\n]*=[\s\n]*({[\s\S]+?});?)?[\s\n]*([a-zA-Z0-9_]+)[\s\n]*(\([\s\S]*\))/);if(!e)return{};let i;try{i=JSON.parse(JSON.stringify(e[1]?_("a = "+e[1]):{}))}catch(t){throw console.error("解析clientInfo出错，clientInfo："+e[1]),t}const a=e[2]?e[2]:"";let o;if(e[3])try{o=JSON.parse(JSON.stringify(_(function(t){let e;return I(t,{onRealmClosed:function(t){"("===t.start&&0===t.startIndex&&(e=t)}}),e?"["+t.substring(e.startIndex+1,e.endIndex-1)+"]":"[]"}(e[3]))))}catch(t){throw console.error("解析云对象参数出错，params："+e[3]),t}else o=[];return{method:a,params:o,clientInfo:i}}const G={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4","mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]},W=new Map;for(let[t,e]of Object.entries(G)){t=t.toLowerCase(),e=e.map((t=>t.toLowerCase()));for(const i of e)W.set(i,t)}exports.ErrorWithCode=h,exports.FormData=class{constructor(){this._shouldUseCache=!1,this._cachedBuffer=null,this._lineBreak="\r\n",this._boundary="------FormDataBaseBoundary"+Math.random().toString(36).substring(2),this.dataList=[]}_addData(t){if(this._shouldUseCache=!1,0===this.dataList.length)return void this.dataList.push(t);const e=this.dataList[this.dataList.length-1];switch(`${Buffer.isBuffer(e)?"buffer":"other"}_${Buffer.isBuffer(t)?"buffer":"other"}`){case"buffer_buffer":this.dataList.push(this._lineBreak),this.dataList.push(t);break;case"buffer_other":this.dataList.push(this._lineBreak+t);break;case"other_buffer":this.dataList[this.dataList.length-1]=e+"\r\n",this.dataList.push(t);break;case"other_other":this.dataList[this.dataList.length-1]=e+"\r\n"+t}}append(t,e,i){this._addData("--"+this._boundary);let a=`Content-Disposition: form-data; name="${encodeURIComponent(t)}"`;if(Buffer.isBuffer(e)){if(!i.filename||!i.contentType)throw new Error("filename and contentType required");a+=`; filename="${encodeURIComponent(i.filename)}"`,this._addData(a),this._addData(`Content-Type: ${i.contentType}`),this._addData(""),this._addData(e)}else this._addData(a),this._addData(""),this._addData(e)}getHeaders(t){const e={"Content-Type":"multipart/form-data; boundary="+this._boundary};return Object.assign(e,t)}getBuffer(){if(this._shouldUseCache)return this._cachedBuffer;this._shouldUseCache=!0;let t=Buffer.alloc(0);return this.dataList.forEach((e=>{t=Buffer.isBuffer(e)?Buffer.concat([t,e]):Buffer.concat([t,Buffer.from(""+e)])})),t=Buffer.concat([t,Buffer.from(`${this._lineBreak}--${this._boundary}--`)]),this._cachedBuffer=t,t}},exports.JsonRpcClient=f,exports.JsonRpcServer=class extends u{constructor({bridgeProcess:t}){super({bridge:t})}},exports.getActionPath=function(t,e,i){const a=function(t,e,i){return F(t,e,`cloudfunctions/uni-clientDB-actions/${i}.js`)}(t,e,i);if(0===a.length)throw new h(`未找到uni-clientDB-actions[${i}]`,"NOT_FOUND");if(a.length>1)throw console.error(`uni-clientDB-actions[${i}]存在名称冲突，请解决冲突后再试。产生冲突的路径如下：`),a.forEach((t=>{console.error(t)})),new h(`uni-clientDB-actions[${i}]名称冲突，请解决后再试`,"CONFLICT_NAME");return a[0]},exports.getAllFile=function t(e,i){if(!s.default.existsSync(e))return;const a=[],n=s.default.readdirSync(e);for(const p of n){if(i&&i.test(p))continue;const n=o.default.join(e,p),l=s.default.statSync(n);l.isFile()&&a.push(n),l.isDirectory()&&a.push(...t(n,i))}return a},exports.getAllModuleCommonModuleList=function(t,e){const i=D(t,e),a=[];for(let t=0;t<i.length;t++){const e=U(i[t]);a.push(...e)}return a},exports.getAllModuleFunctionPath=T,exports.getAppid=function(t){const e=w(t),i=o.default.resolve(t,e?"src":"","manifest.json");let a={};try{a=j(i)}catch(t){}return a.appid},exports.getCloudPathType=function(t){return/uniCloud(-aliyun|-tcb|-alipay|)\/cloudfunctions\/common\//.test(t)?"module":/uniCloud(-aliyun|-tcb|-alipay|)\/cloudfunctions\/uni-clientDB-actions\//.test(t)?"action":/uniCloud(-aliyun|-tcb|-alipay|)\/cloudfunctions\//.test(t)?"function":""},exports.getCloudfunctionPathList=D,exports.getCloudfunctionsPathFromFilePath=function(t){const e=t.replace(/\\/g,"/").match(/(?:.*)\/uniCloud(?:-aliyun|tcb|alipay){0,1}\/cloudfunctions/);return e&&e[0]},exports.getCollectionListFromAllDbInit=function(t,e){const i=F(t,e,"database/db_init.json"),a=[];for(let e=0;e<i.length;e++){const o=i[e];try{const t=j(o);a.push(...Object.keys(t))}catch(t){}}return a},exports.getCommonModuleList=U,exports.getCommonModulePath=R,exports.getCommonModulePathList=N,exports.getEncryptedFunctionList=function(t,e){return T(t,e).filter((t=>C(t))).map((t=>({name:t.replace(/\\/g,"/").split("/").pop(),functionPath:t})))},exports.getFunctionNameFromFunctionPath=A,exports.getFunctionParam=function(t){switch($(t)){case"function":return z(t);case"object":return function(t){const e=`${A(t)}.param.js`,i=o.default.resolve(t,e);return s.default.existsSync(i)?J(s.default.readFileSync(i).toString("utf8")):z(t)}(t);default:throw new Error("system error")}},exports.getFunctionPath=B,exports.getFunctionPathList=E,exports.getFunctionType=$,exports.getGlobalJsonRpcClient=function(){return global.__jsonRpcClient||(global.__jsonRpcClient=new f({bridgeProcess:process})),global.__jsonRpcClient},exports.getMimeType=function(t){if("string"!=typeof t)return null;const e=t.replace(/^.*[/\\]/,"").toLowerCase(),i=e.replace(/^.*\./,"").toLowerCase(),a=e.length<t.length;return i.length<e.length-1||!a?W.get(i)??"application/octet-stream":null},exports.getModuleList=P,exports.getPossiblePath=F,exports.getProjectManifestContent=function(t){const e=w(t),i=o.default.resolve(t,e?"src":"","manifest.json");let a={};try{a=j(i)}catch(t){}return a},exports.getRealFunctionPath=function(t,e,i){const a=o.default.resolve(x,"internal-functions");return s.default.readdirSync(a).filter((t=>y(o.default.resolve(a,t))&&"common"!==t)).indexOf(i)>-1?o.default.resolve(a,i):B(t,e,i)},exports.getRealWorkspace=function({uniCloudInfo:t,provider:e}){return t.find((t=>t.provider===e)).workspaceFolder},exports.getSchemaPath=function(t,e,i){const a=function(t,e,i){return F(t,e,`database/${i}.schema.json`)}(t,e,i);if(0===a.length)throw new h(`项目database目录下缺少${i}.schema.json。如云端的该表已配置schema，请下载到database目录中`,"NOT_FOUND");if(a.length>1)throw console.error(`${i}表对应的schema存在名称冲突，请解决冲突后再试。产生冲突的路径如下：`),a.forEach((t=>{console.error(t)})),new h(`${i}表对应的schema名称冲突，请解决后再试`,"CONFLICT_NAME");return a[0]},exports.getType=g,exports.getUniCloudClient=function(t){const e=require(o.default.resolve(__dirname,"./ulib"));return t?e.init(t):e.init(function(){const t=JSON.parse(process.env.UNICLOUD_SPACE_LIST).find((t=>t.provider===process.env.UNICLOUD_SPACE_PROVIDER)),e=JSON.parse(JSON.stringify(t));return"tcb"===e.provider?e.provider="tencent":"aliyun"===e.provider&&(e.endpoint=e.endpoint||(e.spaceId.startsWith("mp-")?"https://api.next.bspapp.com":"https://api.bspapp.com")),e}())},exports.getUniIdPath=function(t,e){return R(t,e,"uni-id")},exports.getUniModuleId=q,exports.getValidateFunctionPath=function(t,e,i){const a=function(t,e,i){return F(t,e,`database/validateFunction/${i}.js`)}(t,e,i);if(0===a.length)throw new h(`未找到扩展校验函数[${i}]`,"NOT_FOUND");if(a.length>1)throw console.error(`扩展校验函数[${i}]存在名称冲突，请解决冲突后再试。产生冲突的路径如下：`),a.forEach((t=>{console.error(t)})),new h(`扩展校验函数[${i}]名称冲突，请解决后再试`,"CONFLICT_NAME");return a[0]},exports.getWorkspacePathFromFilePath=function(t){const e=t.replace(/\\/g,"/").match(/(.*?)\/(uniCloud-(?:aliyun|tcb|alipay)|src\/uni_modules|uni_modules)/);return e&&e[1]},exports.isDirectory=y,exports.isFileEncrypted=function(t){let e;try{e=s.default.statSync(t)}catch(t){return!1}const i=s.default.openSync(t),a=Buffer.alloc(Math.min(e.size,512));return s.default.readSync(i,a),s.default.closeSync(i),Array.from(a).some((t=>0===t))},exports.isModuleEncrypted=C,exports.isPlainObject=function(t){if("object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call(t))return!1;const e=Object.getPrototypeOf(t);return null===e||null===Object.getPrototypeOf(e)},exports.isUniAppCli=w,exports.parseJson=b,exports.parseJsonByPath=j,exports.readText=v,exports.safeEval=_,exports.traverseJs=I,exports.uniCloudDebuggerPath=x;